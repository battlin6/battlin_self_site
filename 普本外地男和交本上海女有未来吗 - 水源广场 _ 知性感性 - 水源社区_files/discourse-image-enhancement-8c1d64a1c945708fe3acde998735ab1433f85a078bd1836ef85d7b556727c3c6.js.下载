define("discourse/plugins/discourse-image-enhancement/discourse/components/image-search-advanced-options",["exports","@ember/component","@ember/object","discourse/components/search-advanced-options","discourse/models/topic","discourse-common/lib/debounce","@ember/template-factory"],(function(e,t,s,r,a,n,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const l=(0,i.createTemplateFactory)({id:"ENg9pg32",block:'[[[10,"summary"],[12],[1,"\\n  "],[1,[28,[35,0],["search.advanced.title"],null]],[1,"\\n"],[13],[1,"\\n"],[10,0],[14,0,"search-advanced-filters"],[12],[1,"\\n  "],[10,0],[14,0,"search-advanced-options"],[12],[1,"\\n\\n    "],[10,0],[14,0,"control-group advanced-search-category"],[12],[1,"\\n      "],[10,"label"],[14,0,"control-label"],[12],[1,[28,[35,0],["search.advanced.in_category.label"],null]],[13],[1,"\\n      "],[10,0],[14,0,"controls"],[12],[1,"\\n        "],[8,[39,1],null,[["@id","@value","@onChange"],["search-in-category",[30,0,["searchedTerms","category","id"]],[28,[37,2],[[30,0],"onChangeSearchTermForCategory"],null]]],null],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n\\n"],[41,[30,0,["siteSettings","tagging_enabled"]],[[[1,"      "],[10,0],[14,0,"control-group advanced-search-tags"],[12],[1,"\\n        "],[10,"label"],[14,0,"control-label"],[12],[1,[28,[35,0],["search.advanced.with_tags.label"],null]],[13],[1,"\\n        "],[10,0],[14,0,"controls"],[12],[1,"\\n          "],[8,[39,4],null,[["@id","@tags","@everyTag","@unlimitedTagCount","@onChange","@options"],["search-with-tags",[30,0,["searchedTerms","tags"]],true,true,[28,[37,2],[[30,0],"onChangeSearchTermForTags"],null],[28,[37,5],null,[["allowAny","headerAriaLabel"],[false,[28,[37,0],["search.advanced.with_tags.aria_label"],null]]]]]],null],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"\\n    "],[10,0],[14,0,"control-group advanced-search-topic"],[12],[1,"\\n      "],[10,"label"],[14,0,"control-label"],[12],[1,"\\n        "],[1,[28,[35,0],["search.advanced.in_topic.label"],null]],[1,"\\n      "],[13],[1,"\\n      "],[10,0],[14,0,"controls"],[12],[1,"\\n        "],[8,[39,6],null,[["@id","@value","@content","@onChange","@options"],["search-in-topic",[30,0,["searchedTerms","topic","id"]],[28,[37,7],[[30,0,["searchedTerms","topic"]]],null],[28,[37,2],[[30,0],"onChangeSearchTermForTopic"],null],[28,[37,5],null,[["additionalFilters"],["status:public"]]]]],null],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n\\n    "],[10,0],[14,0,"control-group advanced-search-posted-by"],[12],[1,"\\n      "],[10,"label"],[14,0,"control-label"],[12],[1,"\\n        "],[1,[28,[35,0],["search.advanced.posted_by.label"],null]],[1,"\\n      "],[13],[1,"\\n      "],[10,0],[14,0,"controls"],[12],[1,"\\n        "],[8,[39,8],null,[["@id","@value","@onChange","@options"],["search-posted-by",[30,0,["searchedTerms","username"]],[28,[37,2],[[30,0],"onChangeSearchTermForUsername"],null],[28,[37,5],null,[["headerAriaLabel","maximum","excludeCurrentUser"],[[28,[37,0],["search.advanced.posted_by.aria_label"],null],1,false]]]]],null],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n\\n    "],[10,0],[14,0,"control-group advanced-search-posted-date"],[12],[1,"\\n      "],[10,"label"],[14,0,"control-label"],[12],[1,[28,[35,0],["search.advanced.post.time.label"],null]],[13],[1,"\\n      "],[10,0],[14,0,"controls inline-form full-width"],[12],[1,"\\n        "],[8,[39,9],null,[["@id","@valueProperty","@content","@value","@onChange","@options"],["postTime","value",[30,0,["postTimeOptions"]],[30,0,["searchedTerms","time","when"]],[28,[37,2],[[30,0],"onChangeWhenTime"],null],[28,[37,5],null,[["headerAriaLabel"],[[28,[37,0],["search.advanced.post.time.aria_label"],null]]]]]],null],[1,"\\n        "],[8,[39,10],null,[["@date","@onChange","@inputId"],[[30,0,["searchedTerms","time","days"]],[28,[37,2],[[30,0],"onChangeWhenDate"],null],"search-post-date"]],null],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n\\n  "],[13],[1,"\\n\\n"],[41,[30,0,["site","mobileView"]],[[[1,"    "],[10,0],[14,0,"second-search-button"],[12],[1,"\\n      "],[8,[39,11],[[24,0,"btn-primary search-cta"]],[["@action","@icon","@label","@ariaLabel","@disabled"],[[30,0,["search"]],"search","search.search_button","search.search_button",[30,0,["searchButtonDisabled"]]]],null],[1,"\\n    "],[13],[1,"\\n"]],[]],null],[13]],[],false,["i18n","search-advanced-category-chooser","action","if","tag-chooser","hash","topic-chooser","array","user-chooser","combo-box","date-input","d-button"]]',moduleName:"discourse/plugins/discourse-image-enhancement/discourse/components/image-search-advanced-options.hbs",isStrictMode:!1}),c=/^topic:/gi
class o extends r.default{constructor(){super(...arguments),this.setProperties({searchedTerms:{topic:null}})}didReceiveAttrs(){super.didReceiveAttrs(),this.setSearchedTermValueForTopic()}setSearchedTermValueForTopic(){const e=this.filterBlocks(c)
if(e.length>0){const t=parseInt(e[0].replace(c,""),10)
isNaN(t)||this.get("searchedTerms.topic")?.id===t||((0,n.default)(this,this._fetchTopic,[t],200),this.set("searchedTerms.topic",{id:t,title:`topic:${t}`}))}}_fetchTopic(e){e&&this.get("searchedTerms.topic")?.id!==e&&a.default.find(e,{}).then((e=>{this.set("searchedTerms.topic",e)}))}_updateSearchTermForTopic(){const e=this.filterBlocks(c),t=this.get("searchedTerms.topic")?.id
let s=this.searchTerm||""
t?0!==e.length?s=s.replace(e[0],`topic:${t}`):s+=` topic:${t}`:s=s.replace(e[0],""),this._updateSearchTerm(s)}onChangeSearchTermForTopic(e,t){this.set("searchedTerms.topic",t),this._updateSearchTermForTopic()}static#e=(()=>dt7948.n(this.prototype,"onChangeSearchTermForTopic",[s.action]))()}e.default=o,(0,t.setComponentTemplate)(l,o)})),define("discourse/plugins/discourse-image-enhancement/discourse/components/image-search-result-entries",["exports","@ember/component","@glimmer/component","@ember/template-factory"],(function(e,t,s,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const a=(0,r.createTemplateFactory)({id:"qCSGqG8M",block:'[[[10,0],[14,0,"img-search-result-entries"],[14,"role","list"],[12],[1,"\\n  "],[10,"table"],[14,0,"topic-list topic-thumbnails-grid"],[12],[1,"\\n    "],[10,"tbody"],[14,0,"topic-list-body"],[12],[1,"\\n"],[42,[28,[37,1],[[28,[37,1],[[30,1]],null]],null],null,[[[1,"        "],[8,[39,2],null,[["@resultEntry"],[[30,2]]],null],[1,"\\n"]],[2]],null],[1,"    "],[13],[1,"\\n  "],[13],[1,"\\n"],[13]],["@resultEntries","resultEntry"],false,["each","-track-array","image-search-result-entry"]]',moduleName:"discourse/plugins/discourse-image-enhancement/discourse/components/image-search-result-entries.hbs",isStrictMode:!1})
e.default=(0,t.setComponentTemplate)(a,class extends s.default{tagName=""})})),define("discourse/plugins/discourse-image-enhancement/discourse/components/image-search-result-entry",["exports","@ember/component","@glimmer/component","@ember/object","@ember/service","discourse/models/topic","ember-this-fallback/deprecations-helper","@ember/template-factory"],(function(e,t,s,r,a,n,i,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=(0,l.createTemplateFactory)({id:"3WAQb1Yj",block:'[[[10,"tr"],[14,0,"img-search-result-entry topic-list-item"],[14,"role","list"],[12],[1,"\\n  "],[10,"td"],[14,0,"img-search-img"],[12],[1,"\\n    "],[10,0],[14,0,"img-thumbnail"],[12],[1,"\\n      "],[10,3],[15,6,[30,1,["link_target"]]],[12],[1,"\\n        "],[10,"img"],[14,0,"background-thumbnail"],[15,"src",[30,0,["imageSrc"]]],[15,"srcset",[30,0,["imageSrcSet"]]],[15,"alt",[30,1,["text"]]],[12],[13],[1,"\\n        "],[10,"img"],[14,0,"main-thumbnail"],[15,"src",[30,0,["imageSrc"]]],[15,"srcset",[30,0,["imageSrcSet"]]],[15,"alt",[30,1,["text"]]],[12],[13],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n  "],[10,"td"],[14,0,"img-search-activity"],[12],[1,"\\n    "],[10,1],[14,0,"date"],[12],[1,"\\n      "],[1,[28,[35,0],[[30,0,["post","created_at"]]],[["format"],["tiny"]]]],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n  "],[10,"td"],[14,0,"img-search-topic-title topic-list-data main-link"],[12],[1,"\\n    "],[10,1],[14,0,"link-top-line"],[12],[1,"\\n      "],[11,3],[16,6,[30,1,["link_target"]]],[24,0,"title raw-link raw-topic-link"],[24,"role","heading"],[24,"aria-level","2"],[4,[38,1],["click",[30,0,["goToPath"]]],null],[12],[1,"\\n        "],[1,[30,0,["topic","fancy_title"]]],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n    "],[10,0],[14,0,"link-bottom-line"],[12],[1,"\\n      "],[1,[28,[35,2],[[30,0,["topic","category"]]],null]],[1,"\\n      "],[1,[28,[35,3],[[30,0,["topic"]]],[["mode","tagsForUser"],["list",[30,0,["tagsForUser"]]]]]],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n  "],[10,"td"],[14,0,"img-search-post"],[12],[1,"\\n    "],[10,1],[14,0,"topic-excerpt post-excerpt"],[12],[1,"\\n      "],[1,[30,0,["postContent"]]],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n  "],[10,"td"],[14,0,"img-search-posters"],[12],[1,"\\n    "],[10,0],[14,0,"author"],[12],[1,"\\n      "],[10,3],[15,6,[30,0,["post","userPath"]]],[15,"data-user-card",[30,0,["post","username"]]],[12],[1,"\\n        "],[1,[28,[35,4],[[30,0,["post"]]],[["imageSize"],["30px"]]]],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n"],[13],[1,[28,[32,0],["[[\\"The `tagsForUser` property path was used in the `discourse/plugins/discourse-image-enhancement/discourse/components/image-search-result-entry.hbs` template without using `this`. This fallback behavior has been deprecated, all properties must be looked up on `this` when used in the template: {{this.tagsForUser}}\\",false,{\\"id\\":\\"ember-this-fallback.this-property-fallback\\",\\"until\\":\\"n/a\\",\\"for\\":\\"ember-this-fallback\\",\\"url\\":\\"https://deprecations.emberjs.com/v3.x#toc_this-property-fallback\\",\\"since\\":{\\"available\\":\\"0.2.0\\"}}]]"],null]]],["@resultEntry"],false,["format-date","on","category-link","discourse-tags","avatar"]]',moduleName:"discourse/plugins/discourse-image-enhancement/discourse/components/image-search-result-entry.hbs",scope:()=>[i.default],isStrictMode:!1})
e.default=(0,t.setComponentTemplate)(c,class extends s.default{static#e=(()=>dt7948.g(this.prototype,"router",[a.inject]))()
#t=(()=>{dt7948.i(this,"router")})()
constructor(){super(...arguments),this.topic=n.default.create(this.args.resultEntry.topic),this.post=this.args.resultEntry.post}get imageSrc(){const e=this.args.resultEntry.optimized_images
if(e){let t=e.filter((e=>e.height>300&&e.width>150))
if(t?.length>0)return t=t.reduce(((e,t)=>e.height*e.width<t.height*t.width?e:t)),t.url}return this.args.resultEntry.image.url}get postContent(){let e=(new DOMParser).parseFromString(this.post.cooked,"text/html")
e.querySelectorAll(".lightbox-wrapper").forEach((e=>e.remove())),e.querySelectorAll(".onebox").forEach((e=>e.remove()))
let t=e.body.textContent
return this.post.post_number>1&&(t=`#${this.post.post_number} ${t}`),t}goToPath(e){return e.preventDefault(),this.router.transitionTo(this.args.resultEntry.link_target),!1}static#s=(()=>dt7948.n(this.prototype,"goToPath",[r.action]))()})})),define("discourse/plugins/discourse-image-enhancement/discourse/controllers/image-search",["exports","@ember/controller","@ember/object","@ember-decorators/object","discourse/lib/ajax","discourse-common/utils/decorators","discourse-i18n"],(function(e,t,s,r,a,n,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends t.default{searching=!1
loadingMore=!1
noMoreResults=!1
searchActive=!1
searchTerm=""
page=0
searchResults={}
searchResultEntries=[]
searchResultEntriesCount=0
searchButtonDisabled=!1
expandFilters=!1
queryParams=["q","search_type"]
q=void 0
searchTypes=(()=>[{name:i.default.t("image_search.search_type.ocr_and_desc"),id:"image_search_ocr_and_description"},{name:i.default.t("image_search.search_type.ocr_only"),id:"image_search_ocr"},{name:i.default.t("image_search.search_type.desc_only"),id:"image_search_description"}])()
search_type=(()=>this.searchTypes[0].id)()
constructor(){super(...arguments)}_search(){const e={}
switch(e.term=this.get("q"),e.page=this.get("page"),this.get("search_type")){case"image_search_ocr_and_description":e.ocr=!0,e.description=!0
break
case"image_search_ocr":e.ocr=!0,e.description=!1
break
case"image_search_description":e.ocr=!1,e.description=!0}return(0,a.ajax)("/image-search/search.json",{data:e})}resultEntries(){return this.get("searching")?[]:this.get("searchResultEntries")??[]}static#e=(()=>dt7948.n(this.prototype,"resultEntries",[(0,n.default)("searching","searchResultEntries")]))()
hasResults(){return this.get("searchResultEntries").length>0}static#s=(()=>dt7948.n(this.prototype,"hasResults",[(0,n.default)("searchResultEntries")]))()
resetSearch(){this.set("page",0),this.set("searchResultEntries",[]),this.set("searchResultEntriesCount",0),this.set("loadingMore",!1),this.set("noMoreResults",!1)}triggerSearchOnTypeChange(){this.searchActive&&(this.resetSearch(),this._search())}static#r=(()=>dt7948.n(this.prototype,"triggerSearchOnTypeChange",[(0,r.observes)("search_type")]))()
search(){this.searchTerm.length<2?this.set("invalidSearch",!0):(this.set("searchActive",!0),this.set("invalidSearch",!1),this.resetSearch(),this.set("searching",!0),this.set("q",this.searchTerm),this._search().then((e=>{this.set("searchResultEntries",Array.from(e.image_search_result.grouped_results)),this.set("noMoreResults",!e.image_search_result.has_more),this.set("searchResultEntriesCount",this.get("searchResultEntries").length),this.set("searching",!1)})))}static#a=(()=>dt7948.n(this.prototype,"search",[s.action]))()
loadMore(){this.get("searching")||this.get("loadingMore")||this.get("noMoreResults")||(this.set("loadingMore",!0),this.set("page",this.page+1),this._search().then((e=>{this.set("noMoreResults",!e.image_search_result.has_more),e.image_search_result.grouped_results.length>0&&(this.set("searchResultEntries",this.get("searchResultEntries").concat(e.image_search_result.grouped_results)),this.set("searchResultEntriesCount",this.get("searchResultEntries").length)),this.set("loadingMore",!1)})))}static#n=(()=>dt7948.n(this.prototype,"loadMore",[s.action]))()}e.default=l})),define("discourse/plugins/discourse-image-enhancement/discourse/image-search-route-map",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){this.route("image-search")}})),define("discourse/plugins/discourse-image-enhancement/discourse/routes/image-search",["exports","@ember/routing/route"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class s extends t.default{queryParams={}
setupController(e){e.q&&(e.set("searchTerm",e.q),e.search())}}e.default=s})),define("discourse/plugins/discourse-image-enhancement/discourse/templates/image-search",["exports","@ember/template-factory"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"MHgskEXI",block:'[[[10,"section"],[14,0,"search-container"],[12],[1,"\\n  "],[8,[39,0],[[24,0,"hidden"]],[["@name","@tag"],["full-page-search",[30,0,["searchTerm"]]]],null],[1,"\\n\\n  "],[10,0],[14,0,"search-header image-search-header"],[14,"role","search"],[12],[1,"\\n    "],[10,"h1"],[14,0,"search-page-heading"],[12],[1,"\\n      "],[1,[28,[35,1],["image_search.title"],null]],[1,"\\n    "],[13],[1,"\\n    "],[10,2],[12],[1," "],[1,[28,[35,1],["image_search.description"],null]],[1," "],[13],[1,"\\n    "],[10,0],[14,0,"search-bar"],[12],[1,"\\n      "],[8,[39,2],[[24,0,"full-page-search search no-blur search-query"]],[["@value","@aria-label","@enter","@hasAutofocus","@aria-controls"],[[30,0,["searchTerm"]],[28,[37,1],["search.search_term_label"],null],[28,[37,3],[[30,0],"search",[28,[37,4],null,[["collapseFilters"],[true]]]],null],[30,0,["hasAutofocus"]],"search-result-count"]],null],[1,"\\n      "],[8,[39,5],null,[["@id","@value","@content","@onChange","@options"],["search-type",[30,0,["search_type"]],[30,0,["searchTypes"]],[28,[37,6],[[28,[37,7],[[30,0,["search_type"]]],null]],null],[28,[37,4],null,[["castInteger"],[true]]]]],null],[1,"\\n      "],[8,[39,8],[[24,0,"btn-primary search-cta"]],[["@action","@icon","@label","@ariaLabel","@disabled"],[[28,[37,6],[[28,[37,3],[[30,0],"search"],null],[28,[37,4],null,[["collapseFilters"],[true]]]],null],"search","search.search_button","search.search_button",[30,0,["searchButtonDisabled"]]]],null],[1,"\\n    "],[13],[1,"\\n\\n    "],[10,0],[14,0,"search-filters"],[12],[1,"\\n      "],[8,[39,9],null,[["@searchTerm","@onChangeSearchTerm","@search","@searchButtonDisabled","@expandFilters"],[[28,[37,10],[[30,0,["searchTerm"]]],null],[28,[37,6],[[28,[37,7],[[30,0,["searchTerm"]]],null]],null],[28,[37,3],[[30,0],"search",[28,[37,4],null,[["collapseFilters"],[true]]]],null],[30,0,["searchButtonDisabled"]],[30,0,["expandFilters"]]]],null],[1,"\\n    "],[13],[1,"\\n\\n    "],[10,0],[14,0,"search-notice"],[12],[1,"\\n"],[41,[30,0,["invalidSearch"]],[[[1,"        "],[10,0],[14,0,"fps-invalid"],[12],[1,"\\n          "],[1,[28,[35,1],["search.too_short"],null]],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n\\n"],[41,[30,0,["searching"]],[[[1,"      "],[1,[28,[35,12],null,[["size"],["medium"]]]],[1,"\\n"]],[]],[[],[]]],[1,"  "],[13],[1,"\\n\\n"],[41,[51,[28,[37,14],[[30,0,["hasResults"]],[30,0,["searching"]]],null]],[[[41,[30,0,["searchActive"]],[[[1,"      "],[10,"h3"],[14,0,"image-search-no-results"],[12],[1,[28,[35,1],["search.no_results"],null]],[13],[1,"\\n"]],[]],null]],[]],null],[1,"\\n"],[41,[30,0,["hasResults"]],[[[1,"    "],[8,[39,15],null,[["@selector","@action"],[".img-search-result-entry",[28,[37,3],[[30,0],"loadMore"],null]]],[["default"],[[[[1,"\\n      "],[8,[39,16],null,[["@resultEntries"],[[30,0,["resultEntries"]]]],null],[1,"\\n"],[41,[30,0,["loadingMore"]],[[[1,"        "],[1,[28,[35,12],null,[["size"],["medium"]]]],[1,"\\n"]],[]],null],[41,[30,0,["noMoreResults"]],[[[1,"        "],[10,0],[14,0,"no-more-results"],[12],[1,[28,[35,1],["search.no_more_results"],null]],[13],[1,"\\n"]],[]],null],[1,"    "]],[]]]]],[1,"\\n"]],[]],null],[13]],[],false,["scroll-tracker","i18n","search-text-field","action","hash","combo-box","fn","mut","d-button","image-search-advanced-options","readonly","if","loading-spinner","unless","or","load-more","image-search-result-entries"]]',moduleName:"discourse/plugins/discourse-image-enhancement/discourse/templates/image-search.hbs",isStrictMode:!1})})),define("discourse/plugins/discourse-image-enhancement/initializers/image-search",["exports","discourse/lib/plugin-api"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={name:"image-search",initialize:function(){(0,t.withPluginApi)("0.8.6",(e=>function(e){e.addFullPageSearchType("search.type.images","images",(function(t,s,r){t.setProperties({searching:!1,loading:!1}),e._lookupContainer("service:router").transitionTo("image-search",{queryParams:{q:s.q}})}))}(e)))}}}))

//# sourceMappingURL=discourse-image-enhancement-6427d8609d100e947725c4f61eb170248d3047daaded604a7f22ca09be96ecbb.map
//!

;
