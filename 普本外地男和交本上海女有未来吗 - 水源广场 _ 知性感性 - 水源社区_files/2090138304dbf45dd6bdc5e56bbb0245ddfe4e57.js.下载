"require"in window&&require("discourse/lib/theme-settings-store").registerSettings(94,{show_watermark_in_background:!0,scroll_enabled:!0,only_in_categories:"",except_in_categories:"",only_in_tags:"水印|2023换寝室事件|2023外卖进校中转事件",except_in_tags:"",if_site_title_matches:"",or_if_url_matches:"",tile_width:150,tile_height:150,color:"var(--primary-low)",text_align:"center",text_rotation:-45,display_text:"",display_text_font:"bolder 1rem var(--font-family)",display_text_x:0,display_text_y:116,display_username:!0,display_username_font:"bolder 1.5rem var(--font-family)",display_username_x:0,display_username_y:100,display_timestamp:!0,display_timestamp_format:"YYYY-MM-DD HH:mm",display_timestamp_font:"bolder 1rem var(--font-family)",display_timestamp_x:0,display_timestamp_y:120}),"define"in window&&define("discourse/theme-94/discourse/templates/connectors/above-site-header/watermark-background-widget",["exports","ember-this-fallback/deprecations-helper","@ember/template-factory"],(function(e,t,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,r.createTemplateFactory)({id:null,block:'[[[41,[28,[37,1],[94,"show_watermark_in_background"],null],[[[1,"  "],[1,[28,[35,2],null,[["widget","args"],["watermark-background-widget",[30,0,["user"]]]]]],[1,"\\n"]],[]],null],[1,[28,[32,0],["[[\\"The `user` property path was used in the `discourse/theme-94/discourse/templates/connectors/above-site-header/watermark-background-widget` template without using `this`. This fallback behavior has been deprecated, all properties must be looked up on `this` when used in the template: {{this.user}}\\",false,{\\"id\\":\\"ember-this-fallback.this-property-fallback\\",\\"until\\":\\"n/a\\",\\"for\\":\\"ember-this-fallback\\",\\"url\\":\\"https://deprecations.emberjs.com/v3.x#toc_this-property-fallback\\",\\"since\\":{\\"available\\":\\"0.2.0\\"}}]]"],null]]],[],false,["if","theme-setting","mount-widget"]]',moduleName:"discourse/theme-94/discourse/templates/connectors/above-site-header/watermark-background-widget",scope:()=>[t.default],isStrictMode:!1})})),"define"in window&&define("discourse/theme-94/discourse/helpers/computed-values",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.getComputedColor=function(e,t){return e.style.color=t,window.getComputedStyle(e,null).getPropertyValue("color")},e.getComputedFont=function(e,t){e.style.font=t
const r=window.getComputedStyle(e,null),a=r.getPropertyValue("font-size"),i=r.getPropertyValue("font-family"),s=r.getPropertyValue("font-style"),n=r.getPropertyValue("font-variant"),o=r.getPropertyValue("font-weight")
return`${s} ${n} ${o} ${a} ${i}`.trim()}
require("discourse/lib/theme-settings-store").getObjectForTheme(94)})),"define"in window&&define("discourse/theme-94/discourse/helpers/render-watermark",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
require("discourse/lib/theme-settings-store").getObjectForTheme(94)
e.default=(e,t,r)=>{const{tile_width:a,tile_height:i,color:s,text_align:n,text_rotation:o,display_text:l,display_text_font:d,display_text_x:m,display_text_y:u,display_username_font:p,display_username_x:c,display_username_y:_,display_timestamp_font:g,display_timestamp_x:f,display_timestamp_y:h}=t,{username:y,timestamp:w}=r
e.width=a,e.height=i
const b=e.getContext("2d")
return b.fillStyle=s,b.textAlign=n,b.rotate(Math.PI/(180/parseInt(o,10))),""!==l.trim()&&(b.font=d,b.fillText(l,m,u)),y&&(b.font=p,b.fillText(y,c,_)),w&&(b.font=g,b.fillText(w,f,h)),e.toDataURL()}})),"define"in window&&define("discourse/theme-94/discourse/initializers/watermark-background-widget",["exports","discourse/lib/plugin-api","discourse/models/category","../helpers/render-watermark","../helpers/computed-values","@ember/runloop"],(function(e,t,r,a,i,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const n=require("discourse/lib/theme-settings-store").getObjectForTheme(94)
e.default={name:"watermark-background-widget",initialize(){const e=n.only_in_categories.split("|").filter((e=>""!==e)).map((e=>parseInt(e,10))),o=n.except_in_categories.split("|").filter((e=>""!==e)).map((e=>parseInt(e,10))),l=n.only_in_tags.split("|").filter((e=>""!==e)),d=n.except_in_tags.split("|").filter((e=>""!==e)),m=n.or_if_url_matches.split("|").filter((e=>""!==e)).map((e=>new RegExp(e)));(0,t.withPluginApi)("0.8",(t=>{t.createWidget("watermark-background-widget",{tagName:"div#watermark-background."+(n.scroll_enabled?"scroll":"fixed"),getCurrentCategories(e){const t=e.currentRoute
if(null===t)return[]
let a=null
if("topic.fromParams"!==t.name&&"topic.fromParamsNear"!==t.name||(a=r.default.findById(t.parent.attributes.category_id)),t.params.hasOwnProperty("category_slug_path_with_id")&&(a=r.default.findBySlugPathWithID(t.params.category_slug_path_with_id)),a){const e=[a.id]
do{e.push(a.parent_category_id),a=a.parentCategory}while(a&&a.parentCategory)
return e.filter((e=>null!=e))}return[]},getCurrentTags(e){const t=e.currentRoute
return null===t?[]:"topic.fromParams"===t.name||"topic.fromParamsNear"===t.name?t.parent.attributes.tags:t.params.hasOwnProperty("tag_id")?[t.params.tag_id]:[]},shouldShowWatermark(){const t=this.register.lookup("router:main")
if(""===n.display_text.trim()&&!n.display_username&&!n.display_timestamp)return!1
let r
if(r=this.siteSettings.title.match(n.if_site_title_matches),r&&(e.length>0||o.length>0)){const a=this.getCurrentCategories(t),i=0===e.length||a.find((t=>e.indexOf(t)>-1)),s=i&&(0===o.length||a.every((e=>-1===o.indexOf(e))))
r=i&&s}if(r&&(l.length>0||d.length>0)){const e=this.getCurrentTags(t),a=0===l.length||e.find((e=>l.indexOf(e)>-1)),i=a&&(0===d.length||e.every((e=>-1===d.indexOf(e))))
r=a&&i}for(const e of m)if(r=r||e.test(t.currentURL),r)break
return r},getDomElement:()=>document.getElementById("watermark-background"),clearWatermark(){this.getDomElement().style.backgroundImage=""},renderWatermark(){const e=this.getDomElement(),r=document.createElement("canvas"),s=(0,i.getComputedColor)(e,n.color),o=(0,i.getComputedFont)(e,n.display_text_font),l=(0,i.getComputedFont)(e,n.display_username_font),d=(0,i.getComputedFont)(e,n.display_timestamp_font),m=t.getCurrentUser(),u={username:n.display_username?m?.username:null,timestamp:n.display_timestamp?moment().format(n.display_timestamp_format):null},p=(0,a.default)(r,{...n,color:s,display_text_font:o,display_username_font:l,display_timestamp_font:d},u)
if(!p)return void this.clearWatermark()
const c=`url(${p})`
e.style.backgroundImage!==c&&(e.style.backgroundImage=c)},init(){(0,s.schedule)("afterRender",(()=>{this.shouldShowWatermark()?this.renderWatermark():this.clearWatermark()}))},html:()=>null}),t.decorateWidget("watermark-background-widget:after",(e=>{const t=e.widget.appEvents;["page:changed","header:update-topic"].forEach((r=>t.on(r,(()=>{e.widget.scheduleRerender()}))))}))}))}}}))

//# sourceMappingURL=2090138304dbf45dd6bdc5e56bbb0245ddfe4e57.map?__ws=shuiyuan.sjtu.edu.cn
