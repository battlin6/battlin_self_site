define("discourse/plugins/discourse-ai/discourse/admin-discourse-ai-plugin-route-map",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={resource:"admin.adminPlugins.show",path:"/plugins",map(){this.route("discourse-ai-personas",{path:"ai-personas"},(function(){this.route("new"),this.route("show",{path:"/:id"})})),this.route("discourse-ai-llms",{path:"ai-llms"},(function(){this.route("new"),this.route("show",{path:"/:id"})})),this.route("discourse-ai-tools",{path:"ai-tools"},(function(){this.route("new"),this.route("show",{path:"/:id"})}))}}})),define("discourse/plugins/discourse-ai/discourse/admin-discourse-ai-route-map",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={resource:"admin.dashboard",path:"/dashboard",map(){this.route("admin.dashboardSentiment",{path:"/dashboard/sentiment",resetNamespace:!0})}}})),define("discourse/plugins/discourse-ai/discourse/admin/adapters/ai-llm",["exports","discourse/adapters/rest"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class s extends t.default{jsonMode=!0
basePath(){return"/admin/plugins/discourse-ai/"}pathFor(e,t,s){let i=this.basePath(e,t,s)+e.pluralize(this.apiNameFor(t))
return this.appendQueryParams(i,s)}apiNameFor(){return"ai-llm"}}e.default=s})),define("discourse/plugins/discourse-ai/discourse/admin/adapters/ai-persona",["exports","discourse/adapters/rest"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class s extends t.default{jsonMode=!0
basePath(){return"/admin/plugins/discourse-ai/"}pathFor(e,t,s){let i=this.basePath(e,t,s)+e.pluralize(this.apiNameFor(t))
return this.appendQueryParams(i,s)}apiNameFor(){return"ai-persona"}}e.default=s})),define("discourse/plugins/discourse-ai/discourse/admin/adapters/ai-tool",["exports","discourse/adapters/rest"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class s extends t.default{jsonMode=!0
basePath(){return"/admin/plugins/discourse-ai/"}pathFor(e,t,s){let i=this.basePath(e,t,s)+e.pluralize(this.apiNameFor(t))
return this.appendQueryParams(i,s)}apiNameFor(){return"ai-tool"}}e.default=s})),define("discourse/plugins/discourse-ai/discourse/admin/models/ai-llm",["exports","discourse/lib/ajax","discourse/models/rest"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{createProperties(){return this.getProperties("id","display_name","name","provider","tokenizer","max_prompt_tokens","url","api_key","enabled_chat_bot","provider_params")}updateProperties(){const e=this.createProperties()
return e.id=this.id,e}async testConfig(){return await(0,t.ajax)("/admin/plugins/discourse-ai/ai-llms/test.json",{data:{ai_llm:this.createProperties()}})}}e.default=i})),define("discourse/plugins/discourse-ai/discourse/admin/models/ai-persona",["exports","@glimmer/tracking","discourse/lib/ajax","discourse/models/rest"],(function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const o=["id","name","description","tools","system_prompt","allowed_group_ids","enabled","system","priority","top_p","temperature","user_id","mentionable","default_llm","user","max_context_posts","vision_enabled","vision_max_pixels","rag_uploads","rag_chunk_tokens","rag_chunk_overlap_tokens","rag_conversation_chunks","question_consolidator_llm","allow_chat","tool_details"],n=["id","allowed_group_ids","enabled","system","priority","user_id","mentionable","default_llm","user","max_context_posts","vision_enabled","vision_max_pixels","rag_uploads","rag_chunk_tokens","rag_chunk_overlap_tokens","rag_conversation_chunks","question_consolidator_llm","allow_chat","tool_details"]
class a{static#e=(()=>dt7948.g(this.prototype,"value",[t.tracked],(function(){return null})))()
#t=(()=>{dt7948.i(this,"value")})()}class r extends i.default{init(e){e.tools&&(e.tools=e.tools.map((e=>{if("string"==typeof e)return e
{let[t,s]=e
for(let e in s)s.hasOwnProperty(e)&&(this.getToolOption(t,e).value=s[e])
return t}}))),super.init(e),this.tools=e.tools}async createUser(){const e=await(0,s.ajax)(`/admin/plugins/discourse-ai/ai-personas/${this.id}/create-user.json`,{type:"POST"})
return this.user=e.user,this.user_id=this.user.id,this.user}getToolOption(e,t){return this.toolOptions||={},this.toolOptions[e]||={},this.toolOptions[e][t]||=new a}populateToolOptions(e){if(!e.tools)return
let t=[]
e.tools.forEach((e=>{if("string"!=typeof e&&(e=e[0]),this.toolOptions&&this.toolOptions[e]){let s=this.toolOptions[e],i={}
for(let e in s){if(!s.hasOwnProperty(e))continue
let t=s[e]
i[e]=t.value}t.push([e,i])}else t.push(e)})),e.tools=t}updateProperties(){let e=this.system?this.getProperties(n):this.getProperties(o)
return e.id=this.id,this.populateToolOptions(e),e}createProperties(){let e=this.getProperties(o)
return this.populateToolOptions(e),e}workingCopy(){let e=this.getProperties(o)
return this.populateToolOptions(e),r.create(e)}}e.default=r})),define("discourse/plugins/discourse-ai/discourse/admin/models/ai-tool",["exports","@ember-compat/tracked-built-ins","discourse/models/rest"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const i=["id","name","description","parameters","script","summary","enabled"]
class o extends s.default{createProperties(){return this.getProperties(i)}updateProperties(){return this.getProperties(i)}workingCopy(){const e=this.getProperties(i)
return e.parameters=new t.TrackedArray(e.parameters?.map((e=>{const s=new t.TrackedObject(e)
return s.enum_values&&(s.enumValues=new t.TrackedArray(s.enum_values),delete s.enum_values),s}))),this.store.createRecord("ai-tool",e)}}e.default=o})),define("discourse/plugins/discourse-ai/discourse/components/ai-bot-header-icon",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/d-button","discourse-common/helpers/i18n","discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class u extends t.default{static#e=(()=>dt7948.g(this.prototype,"currentUser",[i.service]))()
#s=(()=>{dt7948.i(this,"currentUser")})()
static#i=(()=>dt7948.g(this.prototype,"siteSettings",[i.service]))()
#o=(()=>{dt7948.i(this,"siteSettings")})()
static#n=(()=>dt7948.g(this.prototype,"composer",[i.service]))()
#a=(()=>{dt7948.i(this,"composer")})()
get bots(){const e=this.currentUser.ai_enabled_chat_bots.filter((e=>!e.is_persosna)).filter(Boolean)
return e?e.map((e=>e.model_name)):[]}get showHeaderButton(){return this.bots.length>0&&this.siteSettings.ai_bot_add_to_header}compose(){(0,a.composeAiBotMessage)(this.bots[0],this.composer)}static#r=(()=>dt7948.n(this.prototype,"compose",[s.action]))()
static#l=(()=>(0,r.setComponentTemplate)((0,l.createTemplateFactory)({id:"NL7Zjh9n",block:'[[[1,"\\n"],[41,[30,0,["showHeaderButton"]],[[[1,"      "],[10,"li"],[12],[1,"\\n        "],[8,[32,0],[[16,"title",[28,[32,1],["discourse_ai.ai_bot.shortcut_title"],null]],[24,0,"ai-bot-button icon btn-flat"]],[["@action","@icon"],[[30,0,["compose"]],"robot"]],null],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-bot-header-icon.js",scope:()=>[o.default,n.default],isStrictMode:!0}),this))()}e.default=u})),define("discourse/plugins/discourse-ai/discourse/components/ai-helper-custom-prompt",["exports","@glimmer/component","@glimmer/tracking","@ember/component","@ember/helper","@ember/object","@ember/render-modifiers/modifiers/did-insert","discourse/components/d-button","discourse-common/helpers/i18n","truth-helpers/helpers/not","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,u,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static#e=(()=>dt7948.g(this.prototype,"_customPromptInput",[s.tracked]))()
#u=(()=>{dt7948.i(this,"_customPromptInput")})()
setupCustomPrompt(){this._customPromptInput=document.querySelector(".ai-custom-prompt__input"),this._customPromptInput.focus()}static#i=(()=>dt7948.n(this.prototype,"setupCustomPrompt",[n.action]))()
sendInput(){return this.args.submit(this.args.promptArgs)}static#n=(()=>dt7948.n(this.prototype,"sendInput",[n.action]))()
static#r=(()=>(0,i.setComponentTemplate)((0,d.createTemplateFactory)({id:"R9H8RJGc",block:'[[[1,"\\n    "],[11,0],[24,0,"ai-custom-prompt"],[4,[32,0],[[30,0,["setupCustomPrompt"]]],null],[12],[1,"\\n      "],[8,[32,1],[[16,"placeholder",[28,[32,2],["discourse_ai.ai_helper.context_menu.custom_prompt.placeholder"],null]],[24,0,"ai-custom-prompt__input"]],[["@value","@enter"],[[30,1],[30,0,["sendInput"]]]],null],[1,"\\n\\n      "],[8,[32,3],[[24,0,"ai-custom-prompt__submit btn-primary"]],[["@icon","@action","@disabled"],["discourse-sparkles",[28,[32,4],[[30,2],[30,3]],null],[28,[32,5],[[30,1,["length"]]],null]]],null],[1,"\\n    "],[13],[1,"\\n  "]],["@value","@submit","@promptArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-helper-custom-prompt.js",scope:()=>[a.default,i.Input,l.default,r.default,o.fn,u.default],isStrictMode:!0}),this))()}e.default=c})),define("discourse/plugins/discourse-ai/discourse/components/ai-helper-loading",["exports","discourse/components/d-button","discourse-common/helpers/i18n","@ember/component","@ember/template-factory","@ember/component/template-only"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const a=(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"Av2n/cr8",block:'[[[1,"\\n  "],[10,0],[14,0,"ai-helper-context-menu__loading"],[12],[1,"\\n    "],[10,0],[14,0,"dot-falling"],[12],[13],[1,"\\n    "],[10,1],[12],[1,"\\n      "],[1,[28,[32,0],["discourse_ai.ai_helper.context_menu.loading"],null]],[1,"\\n    "],[13],[1,"\\n    "],[8,[32,1],[[24,0,"btn-flat cancel-request"]],[["@icon","@title","@action"],["times","discourse_ai.ai_helper.context_menu.cancel",[30,1]]],null],[1,"\\n  "],[13],[1,"\\n"]],["@cancel"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-helper-loading.js",scope:()=>[s.default,t.default],isStrictMode:!0}),(0,n.default)())
e.default=a})),define("discourse/plugins/discourse-ai/discourse/components/ai-llm-editor-form",["exports","@glimmer/component","@glimmer/tracking","@ember/component","@ember/helper","@ember/modifier","@ember/object","@ember/routing","@ember/runloop","@ember/service","discourse/components/d-button","discourse/components/d-toggle-switch","discourse/helpers/bound-avatar-template","discourse/lib/ajax-error","discourse-common/helpers/d-icon","discourse-common/helpers/i18n","discourse-i18n","admin/models/admin-user","select-kit/components/combo-box","float-kit/components/d-tooltip","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,u,d,c,p,m,h,g,_,f,b,y,v){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class w extends t.default{static#e=(()=>dt7948.g(this.prototype,"toasts",[u.inject]))()
#d=(()=>{dt7948.i(this,"toasts")})()
static#i=(()=>dt7948.g(this.prototype,"router",[u.inject]))()
#c=(()=>{dt7948.i(this,"router")})()
static#n=(()=>dt7948.g(this.prototype,"dialog",[u.inject]))()
#p=(()=>{dt7948.i(this,"dialog")})()
static#r=(()=>dt7948.g(this.prototype,"isSaving",[s.tracked],(function(){return!1})))()
#m=(()=>{dt7948.i(this,"isSaving")})()
static#l=(()=>dt7948.g(this.prototype,"testRunning",[s.tracked],(function(){return!1})))()
#h=(()=>{dt7948.i(this,"testRunning")})()
static#g=(()=>dt7948.g(this.prototype,"testResult",[s.tracked],(function(){return null})))()
#_=(()=>{dt7948.i(this,"testResult")})()
static#f=(()=>dt7948.g(this.prototype,"testError",[s.tracked],(function(){return null})))()
#b=(()=>{dt7948.i(this,"testError")})()
static#y=(()=>dt7948.g(this.prototype,"apiKeySecret",[s.tracked],(function(){return!0})))()
#v=(()=>{dt7948.i(this,"apiKeySecret")})()
didReceiveAttrs(){super.didReceiveAttrs(...arguments),this.args.model.provider_params||this.populateProviderParams(this.args.model.provider)}get selectedProviders(){return this.args.llms.resultSetMeta.providers.map((e=>{return{id:e,name:(t=e,_.default.t(`discourse_ai.llms.providers.${t}`))}
var t}))}get adminUser(){return f.default.create(this.args.model?.user)}get testErrorMessage(){return _.default.t("discourse_ai.llms.tests.failure",{error:this.testError})}get displayTestResult(){return this.testRunning||null!==this.testResult}get displaySRVWarning(){return this.args.model.shadowed_by_srv&&!this.args.model.isNew}get canEditURL(){return!1!==this.metaProviderParams.url_editable&&(!this.args.model.shadowed_by_srv||this.args.model.isNew)}get metaProviderParams(){return this.args.llms.resultSetMeta.provider_params[this.args.model.provider]||{}}static#w=(()=>dt7948.n(this.prototype,"metaProviderParams",[(0,a.computed)("args.model.provider")]))()
async save(){this.isSaving=!0
const e=this.args.model.isNew
try{const t=await this.args.model.save()
this.args.model.setProperties(t.responseJson.ai_persona),e?(this.args.llms.addObject(this.args.model),this.router.transitionTo("adminPlugins.show.discourse-ai-llms.index")):this.toasts.success({data:{message:_.default.t("discourse_ai.llms.saved")},duration:2e3})}catch(t){(0,m.popupAjaxError)(t)}finally{(0,l.later)((()=>{this.isSaving=!1}),1e3)}}static#x=(()=>dt7948.n(this.prototype,"save",[a.action]))()
async test(){this.testRunning=!0
try{const e=await this.args.model.testConfig()
this.testResult=e.success,this.testResult?this.testError=null:this.testError=e.error}catch(e){(0,m.popupAjaxError)(e)}finally{(0,l.later)((()=>{this.testRunning=!1}),1e3)}}static#S=(()=>dt7948.n(this.prototype,"test",[a.action]))()
makeApiKeySecret(){this.apiKeySecret=!0}static#k=(()=>dt7948.n(this.prototype,"makeApiKeySecret",[a.action]))()
toggleApiKeySecret(){this.apiKeySecret=!this.apiKeySecret}static#T=(()=>dt7948.n(this.prototype,"toggleApiKeySecret",[a.action]))()
delete(){return this.dialog.confirm({message:_.default.t("discourse_ai.llms.confirm_delete"),didConfirm:()=>this.args.model.destroyRecord().then((()=>{this.args.llms.removeObject(this.args.model),this.router.transitionTo("adminPlugins.show.discourse-ai-llms.index")})).catch(m.popupAjaxError)})}static#P=(()=>dt7948.n(this.prototype,"delete",[a.action]))()
async toggleEnabledChatBot(){if(this.args.model.set("enabled_chat_bot",!this.args.model.enabled_chat_bot),!this.args.model.isNew)try{await this.args.model.update({enabled_chat_bot:this.args.model.enabled_chat_bot})}catch(e){(0,m.popupAjaxError)(e)}}static#M=(()=>dt7948.n(this.prototype,"toggleEnabledChatBot",[a.action]))()
static#j=(()=>(0,i.setComponentTemplate)((0,v.createTemplateFactory)({id:"xbMvBzh8",block:'[[[1,"\\n"],[41,[30,0,["displaySRVWarning"]],[[[1,"      "],[10,0],[14,0,"alert alert-info"],[12],[1,"\\n        "],[1,[28,[32,0],["exclamation-circle"],null]],[1,"\\n        "],[1,[28,[32,1,["t"]],["discourse_ai.llms.srv_warning"],null]],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"    "],[10,"form"],[14,0,"form-horizontal ai-llm-editor"],[12],[1,"\\n      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,2],["discourse_ai.llms.display_name"],null]],[13],[1,"\\n        "],[8,[32,3],[[24,0,"ai-llm-editor-input ai-llm-editor__display-name"]],[["@type","@value"],["text",[30,1,["display_name"]]]],null],[1,"\\n      "],[13],[1,"\\n      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,2],["discourse_ai.llms.name"],null]],[13],[1,"\\n        "],[8,[32,3],[[24,0,"ai-llm-editor-input ai-llm-editor__name"]],[["@type","@value"],["text",[30,1,["name"]]]],null],[1,"\\n        "],[8,[32,4],null,[["@icon","@content"],["question-circle",[28,[32,1,["t"]],["discourse_ai.llms.hints.name"],null]]],null],[1,"\\n      "],[13],[1,"\\n      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,1,["t"]],["discourse_ai.llms.provider"],null]],[13],[1,"\\n        "],[8,[32,5],null,[["@value","@content"],[[30,1,["provider"]],[30,0,["selectedProviders"]]]],null],[1,"\\n      "],[13],[1,"\\n"],[41,[30,0,["canEditURL"]],[[[1,"        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,1,["t"]],["discourse_ai.llms.url"],null]],[13],[1,"\\n          "],[8,[32,3],[[24,0,"ai-llm-editor-input ai-llm-editor__url"],[24,"required","true"]],[["@type","@value"],["text",[30,1,["url"]]]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,1,["t"]],["discourse_ai.llms.api_key"],null]],[13],[1,"\\n        "],[10,0],[14,0,"ai-llm-editor__secret-api-key-group"],[12],[1,"\\n          "],[8,[32,3],[[24,0,"ai-llm-editor-input ai-llm-editor__api-key"],[24,"required","true"],[4,[32,6],["focusout",[30,0,["makeApiKeySecret"]]],null]],[["@value","@type"],[[30,1,["api_key"]],[52,[30,0,["apiKeySecret"]],"password","text"]]],null],[1,"\\n          "],[8,[32,7],null,[["@action","@icon"],[[30,0,["toggleApiKeySecret"]],"far-eye-slash"]],null],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["metaProviderParams","fields"]]],null]],null],null,[[[1,"        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,1,["t"]],[[28,[32,8],["discourse_ai.llms.provider_fields.",[30,2]],null]],null]],[13],[1,"\\n          "],[8,[32,3],[[16,0,[29,["ai-llm-editor-input ai-llm-editor__",[30,2]]]]],[["@type","@value"],["text",[28,[31,3],[[28,[32,9],[[30,1,["provider_params"]],[30,2]],null]],null]]],null],[1,"\\n        "],[13],[1,"\\n"]],[2]],null],[1,"      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,1,["t"]],["discourse_ai.llms.tokenizer"],null]],[13],[1,"\\n        "],[8,[32,5],null,[["@value","@content"],[[30,1,["tokenizer"]],[30,3,["resultSetMeta","tokenizers"]]]],null],[1,"\\n      "],[13],[1,"\\n      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,2],["discourse_ai.llms.max_prompt_tokens"],null]],[13],[1,"\\n        "],[8,[32,3],[[24,0,"ai-llm-editor-input ai-llm-editor__max-prompt-tokens"],[24,"step","any"],[24,"min","0"],[24,"lang","en"],[24,"required","true"]],[["@type","@value"],["number",[30,1,["max_prompt_tokens"]]]],null],[1,"\\n        "],[8,[32,4],null,[["@icon","@content"],["question-circle",[28,[32,1,["t"]],["discourse_ai.llms.hints.max_prompt_tokens"],null]]],null],[1,"\\n      "],[13],[1,"\\n      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[8,[32,10],[[24,0,"ai-llm-editor__enabled-chat-bot"],[4,[32,6],["click",[30,0,["toggleEnabledChatBot"]]],null]],[["@state","@label"],[[30,1,["enabled_chat_bot"]],"discourse_ai.llms.enabled_chat_bot"]],null],[1,"\\n      "],[13],[1,"\\n"],[41,[30,1,["user"]],[[[1,"        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,2],["discourse_ai.llms.ai_bot_user"],null]],[13],[1,"\\n          "],[10,3],[14,0,"avatar"],[15,6,[30,1,["user","path"]]],[15,"data-user-card",[30,1,["user","username"]]],[12],[1,"\\n            "],[1,[28,[32,11],[[30,1,["user","avatar_template"]],"small"],null]],[1,"\\n          "],[13],[1,"\\n          "],[8,[32,12],null,[["@route","@model"],["adminUser",[30,0,["adminUser"]]]],[["default"],[[[[1,"\\n            "],[1,[30,1,["user","username"]]],[1,"\\n          "]],[]]]]],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"      "],[10,0],[14,0,"control-group ai-llm-editor__action_panel"],[12],[1,"\\n        "],[8,[32,7],[[24,0,"ai-llm-editor__test"]],[["@action","@disabled"],[[30,0,["test"]],[30,0,["testRunning"]]]],[["default"],[[[[1,"\\n          "],[1,[28,[32,1,["t"]],["discourse_ai.llms.tests.title"],null]],[1,"\\n        "]],[]]]]],[1,"\\n\\n        "],[8,[32,7],[[24,0,"btn-primary ai-llm-editor__save"]],[["@action","@disabled"],[[30,0,["save"]],[30,0,["isSaving"]]]],[["default"],[[[[1,"\\n          "],[1,[28,[32,1,["t"]],["discourse_ai.llms.save"],null]],[1,"\\n        "]],[]]]]],[1,"\\n"],[41,[51,[30,1,["isNew"]]],[[[1,"          "],[8,[32,7],[[24,0,"btn-danger ai-llm-editor__delete"]],[["@action"],[[30,0,["delete"]]]],[["default"],[[[[1,"\\n            "],[1,[28,[32,1,["t"]],["discourse_ai.llms.delete"],null]],[1,"\\n          "]],[]]]]],[1,"\\n"]],[]],null],[1,"      "],[13],[1,"\\n\\n      "],[10,0],[14,0,"control-group ai-llm-editor-tests"],[12],[1,"\\n"],[41,[30,0,["displayTestResult"]],[[[41,[30,0,["testRunning"]],[[[1,"            "],[10,0],[14,0,"spinner small"],[12],[13],[1,"\\n            "],[1,[28,[32,1,["t"]],["discourse_ai.llms.tests.running"],null]],[1,"\\n"]],[]],[[[41,[30,0,["testResult"]],[[[1,"              "],[10,0],[14,0,"ai-llm-editor-tests__success"],[12],[1,"\\n                "],[1,[28,[32,0],["check"],null]],[1,"\\n                "],[1,[28,[32,1,["t"]],["discourse_ai.llms.tests.success"],null]],[1,"\\n              "],[13],[1,"\\n"]],[]],[[[1,"              "],[10,0],[14,0,"ai-llm-editor-tests__failure"],[12],[1,"\\n                "],[1,[28,[32,0],["times"],null]],[1,"\\n                "],[1,[30,0,["testErrorMessage"]]],[1,"\\n              "],[13],[1,"\\n"]],[]]]],[]]]],[]],null],[1,"      "],[13],[1,"\\n    "],[13],[1,"\\n  "]],["@model","field","@llms"],false,["if","each","-track-array","mut","unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-llm-editor-form.js",scope:()=>[h.default,_.default,g.default,i.Input,y.default,b.default,n.on,d.default,o.concat,o.get,c.default,p.default,r.LinkTo],isStrictMode:!0}),this))()}e.default=w})),define("discourse/plugins/discourse-ai/discourse/components/ai-llm-editor",["exports","@glimmer/component","@glimmer/tracking","@ember/object","discourse/components/back-button","discourse/components/d-button","discourse-i18n","select-kit/components/combo-box","discourse/plugins/discourse-ai/discourse/components/ai-llm-editor-form","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,u,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static#e=(()=>dt7948.g(this.prototype,"presetConfigured",[s.tracked],(function(){return!1})))()
#C=(()=>{dt7948.i(this,"presetConfigured")})()
presetId="none"
get showPresets(){return this.args.model.isNew&&!this.presetConfigured&&!this.args.model.url}get preConfiguredLlms(){let e=[{id:"none",name:a.default.t("discourse_ai.llms.preconfigured.none")}]
return this.args.llms.resultSetMeta.presets.forEach((t=>{t.models&&t.models.forEach((s=>{e.push({id:`${t.id}-${s.name}`,name:s.display_name})}))})),e}configurePreset(){this.presetConfigured=!0
let[e,t]=this.presetId.split(/-(.*)/)
if("none"===e)return
const s=this.args.llms.resultSetMeta.presets.findBy("id",e),i=s.models.findBy("name",t)
this.args.model.setProperties({max_prompt_tokens:i.tokens,tokenizer:s.tokenizer,url:i.endpoint||s.endpoint,display_name:i.display_name,name:i.name,provider:s.provider})}static#i=(()=>dt7948.n(this.prototype,"configurePreset",[i.action]))()
static#n=(()=>(0,u.setComponentTemplate)((0,d.createTemplateFactory)({id:"r6uN6b4m",block:'[[[1,"\\n    "],[8,[32,0],null,[["@route","@label"],["adminPlugins.show.discourse-ai-llms","discourse_ai.llms.back"]],null],[1,"\\n"],[41,[30,0,["showPresets"]],[[[1,"      "],[10,"form"],[14,0,"form-horizontal ai-llm-editor"],[12],[1,"\\n        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,1,["t"]],["discourse_ai.llms.preconfigured_llms"],null]],[13],[1,"\\n          "],[8,[32,2],[[24,0,"ai-llm-editor__presets"]],[["@value","@content"],[[30,0,["presetId"]],[30,0,["preConfiguredLlms"]]]],null],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"control-group ai-llm-editor__action_panel"],[12],[1,"\\n          "],[8,[32,3],[[24,0,"ai-llm-editor__next"]],[["@action"],[[30,0,["configurePreset"]]]],[["default"],[[[[1,"\\n            "],[1,[28,[32,1,["t"]],["discourse_ai.llms.next.title"],null]],[1,"\\n          "]],[]]]]],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n"]],[]],[[[1,"      "],[8,[32,4],null,[["@model","@llms"],[[30,1],[30,2]]],null],[1,"\\n"]],[]]],[1,"  "]],["@model","@llms"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-llm-editor.js",scope:()=>[o.default,a.default,r.default,n.default,l.default],isStrictMode:!0}),this))()}e.default=c})),define("discourse/plugins/discourse-ai/discourse/components/ai-llm-selector",["exports","@ember/object","discourse-i18n","select-kit/components/combo-box"],(function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=i.default.extend({_modelDisabledChanged:(0,t.observer)("attrs.disabled",(function(){this.selectKit.options.set("disabled",this.get("attrs.disabled.value"))})),content:(0,t.computed)((function(){return[{id:"blank",name:s.default.t("discourse_ai.ai_persona.no_llm_selected")}].concat(this.llms)})),selectKitOptions:{filterable:!0}})})),define("discourse/plugins/discourse-ai/discourse/components/ai-llms-list-editor",["exports","@glimmer/component","@ember/helper","@ember/modifier","@ember/object","@ember/routing","discourse/components/d-toggle-switch","discourse/lib/ajax-error","discourse-common/helpers/d-icon","discourse-common/helpers/i18n","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-llm-editor","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,u,d,c,p,m){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class h extends t.default{get hasLLMElements(){return 0!==this.args.llms.length}async toggleEnabledChatBot(e){const t=e.enabled_chat_bot,s=!t
try{e.set("enabled_chat_bot",s),await e.update({enabled_chat_bot:s})}catch(i){e.set("enabled_chat_bot",t),(0,r.popupAjaxError)(i)}}static#e=(()=>dt7948.n(this.prototype,"toggleEnabledChatBot",[o.action]))()
static#i=(()=>(0,p.setComponentTemplate)((0,m.createTemplateFactory)({id:"c8CwNxbR",block:'[[[1,"\\n    "],[10,"section"],[14,0,"ai-llms-list-editor admin-detail pull-left"],[12],[1,"\\n"],[41,[30,1],[[[1,"        "],[8,[32,0],null,[["@model","@llms"],[[30,1],[30,2]]],null],[1,"\\n"]],[]],[[[1,"        "],[10,0],[14,0,"ai-llms-list-editor__header"],[12],[1,"\\n          "],[10,"h3"],[12],[1,[28,[32,1],["discourse_ai.llms.short_title"],null]],[13],[1,"\\n"],[41,[51,[30,1,["isNew"]]],[[[1,"            "],[8,[32,2],[[24,0,"btn btn-small btn-primary ai-llms-list-editor__new"]],[["@route"],["adminPlugins.show.discourse-ai-llms.new"]],[["default"],[[[[1,"\\n              "],[1,[28,[32,3],["plus"],null]],[1,"\\n              "],[10,1],[12],[1,[28,[32,4,["t"]],["discourse_ai.llms.new"],null]],[13],[1,"\\n            "]],[]]]]],[1,"\\n"]],[]],null],[1,"        "],[13],[1,"\\n\\n"],[41,[30,0,["hasLLMElements"]],[[[1,"          "],[10,"table"],[14,0,"content-list ai-persona-list-editor"],[12],[1,"\\n            "],[10,"thead"],[12],[1,"\\n              "],[10,"tr"],[12],[1,"\\n                "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.llms.display_name"],null]],[13],[1,"\\n                "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.llms.provider"],null]],[13],[1,"\\n                "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.llms.enabled_chat_bot"],null]],[13],[1,"\\n                "],[10,"th"],[12],[13],[1,"\\n              "],[13],[1,"\\n            "],[13],[1,"\\n            "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,3],[[28,[31,3],[[30,2]],null]],null],null,[[[1,"                "],[10,"tr"],[15,"data-persona-id",[30,3,["id"]]],[14,0,"ai-llm-list__row"],[12],[1,"\\n                  "],[10,"td"],[12],[10,"strong"],[12],[1,[30,3,["display_name"]]],[13],[13],[1,"\\n                  "],[10,"td"],[12],[1,[28,[32,1],[[28,[32,5],["discourse_ai.llms.providers.",[30,3,["provider"]]],null]],null]],[13],[1,"\\n                  "],[10,"td"],[12],[1,"\\n                    "],[8,[32,6],[[4,[32,7],["click",[28,[32,8],[[30,0,["toggleEnabledChatBot"]],[30,3]],null]],null]],[["@state"],[[30,3,["enabled_chat_bot"]]]],null],[1,"\\n                  "],[13],[1,"\\n                  "],[10,"td"],[12],[1,"\\n                    "],[8,[32,2],[[24,"current-when","true"],[24,0,"btn btn-text btn-small"]],[["@route","@model"],["adminPlugins.show.discourse-ai-llms.show",[30,3]]],[["default"],[[[[1,[28,[32,1],["discourse_ai.llms.edit"],null]]],[]]]]],[1,"\\n                  "],[13],[1,"\\n                "],[13],[1,"\\n"]],[3]],null],[1,"            "],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],null]],[]]],[1,"    "],[13],[1,"\\n  "]],["@currentLlm","@llms","llm"],false,["if","unless","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-llms-list-editor.js",scope:()=>[c.default,u.default,n.LinkTo,l.default,d.default,s.concat,a.default,i.on,s.fn],isStrictMode:!0}),this))()}e.default=h})),define("discourse/plugins/discourse-ai/discourse/components/ai-persona-editor",["exports","@glimmer/component","@glimmer/tracking","@ember/component","@ember/modifier","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/did-update","@ember/routing","@ember/runloop","@ember/service","discourse/components/back-button","discourse/components/d-button","discourse/components/d-textarea","discourse/components/d-toggle-switch","discourse/helpers/bound-avatar-template","discourse/lib/ajax-error","discourse/models/group","discourse-i18n","admin/models/admin-user","select-kit/components/combo-box","select-kit/components/group-chooser","float-kit/components/d-tooltip","discourse/plugins/discourse-ai/discourse/components/ai-llm-selector","discourse/plugins/discourse-ai/discourse/components/ai-persona-tool-options","discourse/plugins/discourse-ai/discourse/components/ai-tool-selector","discourse/plugins/discourse-ai/discourse/components/persona-rag-uploader","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,u,d,c,p,m,h,g,_,f,b,y,v,w,x,S,k,T,P,M){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class j extends t.default{static#e=(()=>dt7948.g(this.prototype,"router",[d.inject]))()
#c=(()=>{dt7948.i(this,"router")})()
static#i=(()=>dt7948.g(this.prototype,"store",[d.inject]))()
#E=(()=>{dt7948.i(this,"store")})()
static#n=(()=>dt7948.g(this.prototype,"dialog",[d.inject]))()
#p=(()=>{dt7948.i(this,"dialog")})()
static#r=(()=>dt7948.g(this.prototype,"toasts",[d.inject]))()
#d=(()=>{dt7948.i(this,"toasts")})()
static#l=(()=>dt7948.g(this.prototype,"siteSettings",[d.inject]))()
#o=(()=>{dt7948.i(this,"siteSettings")})()
static#g=(()=>dt7948.g(this.prototype,"allGroups",[s.tracked],(function(){return[]})))()
#A=(()=>{dt7948.i(this,"allGroups")})()
static#f=(()=>dt7948.g(this.prototype,"isSaving",[s.tracked],(function(){return!1})))()
#m=(()=>{dt7948.i(this,"isSaving")})()
static#y=(()=>dt7948.g(this.prototype,"editingModel",[s.tracked],(function(){return null})))()
#I=(()=>{dt7948.i(this,"editingModel")})()
static#w=(()=>dt7948.g(this.prototype,"showDelete",[s.tracked],(function(){return!1})))()
#O=(()=>{dt7948.i(this,"showDelete")})()
static#x=(()=>dt7948.g(this.prototype,"maxPixelsValue",[s.tracked],(function(){return null})))()
#R=(()=>{dt7948.i(this,"maxPixelsValue")})()
static#S=(()=>dt7948.g(this.prototype,"ragIndexingStatuses",[s.tracked],(function(){return null})))()
#N=(()=>{dt7948.i(this,"ragIndexingStatuses")})()
static#k=(()=>dt7948.g(this.prototype,"showIndexingOptions",[s.tracked],(function(){return!1})))()
#U=(()=>{dt7948.i(this,"showIndexingOptions")})()
get chatPluginEnabled(){return this.siteSettings.chat_enabled}updateModel(){this.editingModel=this.args.model.workingCopy(),this.showDelete=!this.args.model.isNew&&!this.args.model.system,this.maxPixelsValue=this.findClosestPixelValue(this.editingModel.vision_max_pixels)}static#T=(()=>dt7948.n(this.prototype,"updateModel",[n.action]))()
toggleIndexingOptions(e){this.showIndexingOptions=!this.showIndexingOptions,e.preventDefault(),e.stopPropagation()}static#P=(()=>dt7948.n(this.prototype,"toggleIndexingOptions",[n.action]))()
findClosestPixelValue(e){let t="high"
return this.maxPixelValues.forEach((s=>{e===s.pixels&&(t=s.id)})),t}get maxPixelValues(){const e=e=>b.default.t(`discourse_ai.ai_persona.vision_max_pixel_sizes.${e}`)
return[{id:"low",name:e("low"),pixels:65536},{id:"medium",name:e("medium"),pixels:262144},{id:"high",name:e("high"),pixels:1048576}]}static#M=(()=>dt7948.n(this.prototype,"maxPixelValues",[s.cached]))()
get indexingOptionsText(){return this.showIndexingOptions?b.default.t("discourse_ai.ai_persona.hide_indexing_options"):b.default.t("discourse_ai.ai_persona.show_indexing_options")}async updateAllGroups(){this.allGroups=await f.default.findAll()}static#j=(()=>dt7948.n(this.prototype,"updateAllGroups",[n.action]))()
async save(){const e=this.args.model.isNew
this.isSaving=!0
const t=this.args.model.workingCopy()
this.args.model.setProperties(this.editingModel)
try{await this.args.model.save(),this.#q(),e&&0===this.args.model.rag_uploads.length?(this.args.personas.addObject(this.args.model),this.router.transitionTo("adminPlugins.show.discourse-ai-personas.show",this.args.model)):this.toasts.success({data:{message:b.default.t("discourse_ai.ai_persona.saved")},duration:2e3})}catch(s){this.args.model.setProperties(t),(0,_.popupAjaxError)(s)}finally{(0,u.later)((()=>{this.isSaving=!1}),1e3)}}static#L=(()=>dt7948.n(this.prototype,"save",[n.action]))()
get showTemperature(){return this.editingModel?.temperature||!this.editingModel?.system}get showTopP(){return this.editingModel?.top_p||!this.editingModel?.system}get adminUser(){return y.default.create(this.editingModel?.user)}get mappedQuestionConsolidatorLlm(){return this.editingModel?.question_consolidator_llm||"blank"}set mappedQuestionConsolidatorLlm(e){this.editingModel.question_consolidator_llm="blank"===e?null:e}get mappedDefaultLlm(){return this.editingModel?.default_llm||"blank"}set mappedDefaultLlm(e){this.editingModel.default_llm="blank"===e?null:e}onChangeMaxPixels(e){const t=this.maxPixelValues.findBy("id",e)
t&&(this.maxPixelsValue=e,this.editingModel.vision_max_pixels=t.pixels)}static#F=(()=>dt7948.n(this.prototype,"onChangeMaxPixels",[n.action]))()
delete(){return this.dialog.confirm({message:b.default.t("discourse_ai.ai_persona.confirm_delete"),didConfirm:()=>this.args.model.destroyRecord().then((()=>{this.args.personas.removeObject(this.args.model),this.router.transitionTo("adminPlugins.show.discourse-ai-personas.index")}))})}static#B=(()=>dt7948.n(this.prototype,"delete",[n.action]))()
updateAllowedGroups(e){this.editingModel.set("allowed_group_ids",e)}static#V=(()=>dt7948.n(this.prototype,"updateAllowedGroups",[n.action]))()
async toggleEnabled(){await this.toggleField("enabled")}static#D=(()=>dt7948.n(this.prototype,"toggleEnabled",[n.action]))()
async togglePriority(){await this.toggleField("priority",!0)}static#G=(()=>dt7948.n(this.prototype,"togglePriority",[n.action]))()
async createUser(){try{let e=await this.args.model.createUser()
this.editingModel.set("user",e),this.editingModel.set("user_id",e.id)}catch(e){(0,_.popupAjaxError)(e)}}static#H=(()=>dt7948.n(this.prototype,"createUser",[n.action]))()
updateUploads(e){this.editingModel.rag_uploads=e}static#$=(()=>dt7948.n(this.prototype,"updateUploads",[n.action]))()
removeUpload(e){this.editingModel.rag_uploads.removeObject(e),this.args.model.isNew||this.save()}static#z=(()=>dt7948.n(this.prototype,"removeUpload",[n.action]))()
async toggleField(e,t){if(this.args.model.set(e,!this.args.model[e]),this.editingModel.set(e,this.args.model[e]),!this.args.model.isNew)try{const s={}
s[e]=this.args.model[e],await this.args.model.update(s),t&&this.#q()}catch(s){(0,_.popupAjaxError)(s)}}#q(){const e=this.args.personas.toArray().sort(((e,t)=>e.priority&&!t.priority?-1:!e.priority&&t.priority?1:e.name.localeCompare(t.name)))
this.args.personas.clear(),this.args.personas.setObjects(e)}static#K=(()=>(0,i.setComponentTemplate)((0,M.createTemplateFactory)({id:"2/2bVNly",block:'[[[1,"\\n    "],[8,[32,0],null,[["@route","@label"],["adminPlugins.show.discourse-ai-personas","discourse_ai.ai_persona.back"]],null],[1,"\\n    "],[11,"form"],[24,0,"form-horizontal ai-persona-editor"],[4,[32,1],[[30,0,["updateModel"]],[30,1,["id"]]],null],[4,[32,2],[[30,0,["updateModel"]],[30,1,["id"]]],null],[4,[32,2],[[30,0,["updateAllGroups"]],[30,1,["id"]]],null],[12],[1,"\\n      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[8,[32,3],[[24,0,"ai-persona-editor__enabled"],[4,[32,4],["click",[30,0,["toggleEnabled"]]],null]],[["@state","@label"],[[30,1,["enabled"]],"discourse_ai.ai_persona.enabled"]],null],[1,"\\n      "],[13],[1,"\\n      "],[10,0],[14,0,"control-group ai-persona-editor__priority"],[12],[1,"\\n        "],[8,[32,3],[[24,0,"ai-persona-editor__priority"],[4,[32,4],["click",[30,0,["togglePriority"]]],null]],[["@state","@label"],[[30,1,["priority"]],"discourse_ai.ai_persona.priority"]],null],[1,"\\n        "],[8,[32,5],null,[["@icon","@content"],["question-circle",[28,[32,6,["t"]],["discourse_ai.ai_persona.priority_help"],null]]],null],[1,"\\n      "],[13],[1,"\\n      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.name"],null]],[13],[1,"\\n        "],[8,[32,7],[[24,0,"ai-persona-editor__name"],[16,"disabled",[30,0,["editingModel","system"]]]],[["@type","@value"],["text",[30,0,["editingModel","name"]]]],null],[1,"\\n      "],[13],[1,"\\n      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.description"],null]],[13],[1,"\\n        "],[8,[32,8],[[24,0,"ai-persona-editor__description"],[16,"disabled",[30,0,["editingModel","system"]]]],[["@value"],[[30,0,["editingModel","description"]]]],null],[1,"      "],[13],[1,"\\n      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.default_llm"],null]],[13],[1,"\\n        "],[8,[32,9],[[24,0,"ai-persona-editor__llms"]],[["@value","@llms"],[[30,0,["mappedDefaultLlm"]],[30,2,["resultSetMeta","llms"]]]],null],[1,"\\n        "],[8,[32,5],null,[["@icon","@content"],["question-circle",[28,[32,6,["t"]],["discourse_ai.ai_persona.default_llm_help"],null]]],null],[1,"\\n      "],[13],[1,"\\n"],[41,[51,[30,1,["isNew"]]],[[[1,"        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.user"],null]],[13],[1,"\\n"],[41,[30,0,["editingModel","user"]],[[[1,"            "],[10,3],[14,0,"avatar"],[15,6,[30,0,["editingModel","user","path"]]],[15,"data-user-card",[30,0,["editingModel","user","username"]]],[12],[1,"\\n              "],[1,[28,[32,10],[[30,0,["editingModel","user","avatar_template"]],"small"],null]],[1,"\\n            "],[13],[1,"\\n            "],[8,[32,11],null,[["@route","@model"],["adminUser",[30,0,["adminUser"]]]],[["default"],[[[[1,"\\n              "],[1,[30,0,["editingModel","user","username"]]],[1,"\\n            "]],[]]]]],[1,"\\n"]],[]],[[[1,"            "],[8,[32,12],[[24,0,"ai-persona-editor__create-user"]],[["@action"],[[30,0,["createUser"]]]],[["default"],[[[[1,"\\n              "],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.create_user"],null]],[1,"\\n            "]],[]]]]],[1,"\\n            "],[8,[32,5],null,[["@icon","@content"],["question-circle",[28,[32,6,["t"]],["discourse_ai.ai_persona.create_user_help"],null]]],null],[1,"\\n"]],[]]],[1,"        "],[13],[1,"\\n"]],[]],null],[1,"      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.tools"],null]],[13],[1,"\\n        "],[8,[32,13],[[24,0,"ai-persona-editor__tools"]],[["@value","@disabled","@tools"],[[30,0,["editingModel","tools"]],[30,0,["editingModel","system"]],[30,2,["resultSetMeta","tools"]]]],null],[1,"\\n      "],[13],[1,"\\n"],[41,[51,[30,0,["editingModel","system"]]],[[[1,"        "],[8,[32,14],null,[["@persona","@tools","@allTools"],[[30,0,["editingModel"]],[30,0,["editingModel","tools"]],[30,2,["resultSetMeta","tools"]]]],null],[1,"\\n"]],[]],null],[1,"      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.allowed_groups"],null]],[13],[1,"\\n        "],[8,[32,15],null,[["@value","@content","@onChange"],[[30,0,["editingModel","allowed_group_ids"]],[30,0,["allGroups"]],[30,0,["updateAllowedGroups"]]]],null],[1,"\\n      "],[13],[1,"\\n      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[14,"for","ai-persona-editor__system_prompt"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.system_prompt"],null]],[13],[1,"\\n        "],[8,[32,8],[[24,0,"ai-persona-editor__system_prompt"],[16,"disabled",[30,0,["editingModel","system"]]]],[["@value"],[[30,0,["editingModel","system_prompt"]]]],null],[1,"      "],[13],[1,"\\n"],[41,[30,0,["editingModel","user"]],[[[41,[30,0,["chatPluginEnabled"]],[[[1,"          "],[10,0],[14,0,"control-group ai-persona-editor__allow_chat"],[12],[1,"\\n            "],[10,"label"],[12],[1,"\\n              "],[8,[32,7],null,[["@type","@checked"],["checkbox",[30,0,["editingModel","allow_chat"]]]],null],[1,"\\n              "],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.allow_chat"],null]],[13],[1,"\\n            "],[8,[32,5],null,[["@icon","@content"],["question-circle",[28,[32,6,["t"]],["discourse_ai.ai_persona.allow_chat_help"],null]]],null],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"        "],[10,0],[14,0,"control-group ai-persona-editor__mentionable"],[12],[1,"\\n          "],[10,"label"],[12],[1,"\\n            "],[8,[32,7],null,[["@type","@checked"],["checkbox",[30,0,["editingModel","mentionable"]]]],null],[1,"\\n            "],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.mentionable"],null]],[13],[1,"\\n          "],[8,[32,5],null,[["@icon","@content"],["question-circle",[28,[32,6,["t"]],["discourse_ai.ai_persona.mentionable_help"],null]]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"      "],[10,0],[14,0,"control-group ai-persona-editor__tool-details"],[12],[1,"\\n        "],[10,"label"],[12],[1,"\\n          "],[8,[32,7],null,[["@type","@checked"],["checkbox",[30,0,["editingModel","tool_details"]]]],null],[1,"\\n          "],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.tool_details"],null]],[13],[1,"\\n        "],[8,[32,5],null,[["@icon","@content"],["question-circle",[28,[32,6,["t"]],["discourse_ai.ai_persona.tool_details_help"],null]]],null],[1,"\\n      "],[13],[1,"\\n      "],[10,0],[14,0,"control-group ai-persona-editor__vision_enabled"],[12],[1,"\\n        "],[10,"label"],[12],[1,"\\n          "],[8,[32,7],null,[["@type","@checked"],["checkbox",[30,0,["editingModel","vision_enabled"]]]],null],[1,"\\n          "],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.vision_enabled"],null]],[13],[1,"\\n        "],[8,[32,5],null,[["@icon","@content"],["question-circle",[28,[32,6,["t"]],["discourse_ai.ai_persona.vision_enabled_help"],null]]],null],[1,"\\n      "],[13],[1,"\\n"],[41,[30,0,["editingModel","vision_enabled"]],[[[1,"        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.vision_max_pixels"],null]],[13],[1,"\\n          "],[8,[32,16],null,[["@value","@content","@onChange"],[[30,0,["maxPixelsValue"]],[30,0,["maxPixelValues"]],[30,0,["onChangeMaxPixels"]]]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.max_context_posts"],null]],[13],[1,"\\n        "],[8,[32,7],[[24,"lang","en"],[24,0,"ai-persona-editor__max_context_posts"]],[["@type","@value"],["number",[30,0,["editingModel","max_context_posts"]]]],null],[1,"\\n        "],[8,[32,5],null,[["@icon","@content"],["question-circle",[28,[32,6,["t"]],["discourse_ai.ai_persona.max_context_posts_help"],null]]],null],[1,"\\n      "],[13],[1,"\\n"],[41,[30,0,["showTemperature"]],[[[1,"        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.temperature"],null]],[13],[1,"\\n          "],[8,[32,7],[[24,0,"ai-persona-editor__temperature"],[24,"step","any"],[24,"lang","en"],[16,"disabled",[30,0,["editingModel","system"]]]],[["@type","@value"],["number",[30,0,["editingModel","temperature"]]]],null],[1,"\\n          "],[8,[32,5],null,[["@icon","@content"],["question-circle",[28,[32,6,["t"]],["discourse_ai.ai_persona.temperature_help"],null]]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[41,[30,0,["showTopP"]],[[[1,"        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.top_p"],null]],[13],[1,"\\n          "],[8,[32,7],[[24,"step","any"],[24,"lang","en"],[24,0,"ai-persona-editor__top_p"],[16,"disabled",[30,0,["editingModel","system"]]]],[["@type","@value"],["number",[30,0,["editingModel","top_p"]]]],null],[1,"\\n          "],[8,[32,5],null,[["@icon","@content"],["question-circle",[28,[32,6,["t"]],["discourse_ai.ai_persona.top_p_help"],null]]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[41,[30,0,["siteSettings","ai_embeddings_enabled"]],[[[1,"        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[8,[32,17],null,[["@persona","@updateUploads","@onRemove"],[[30,0,["editingModel"]],[30,0,["updateUploads"]],[30,0,["removeUpload"]]]],null],[1,"\\n"],[41,[30,0,["editingModel","rag_uploads"]],[[[1,"            "],[11,3],[24,6,"#"],[24,0,"ai-persona-editor__indexing-options"],[4,[32,4],["click",[30,0,["toggleIndexingOptions"]]],null],[12],[1,[30,0,["indexingOptionsText"]]],[13],[1,"\\n"]],[]],null],[1,"        "],[13],[1,"\\n"],[41,[30,0,["showIndexingOptions"]],[[[1,"          "],[10,0],[14,0,"control-group"],[12],[1,"\\n            "],[10,"label"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.rag_chunk_tokens"],null]],[13],[1,"\\n            "],[8,[32,7],[[24,"step","any"],[24,"lang","en"],[24,0,"ai-persona-editor__rag_chunk_tokens"]],[["@type","@value"],["number",[30,0,["editingModel","rag_chunk_tokens"]]]],null],[1,"\\n            "],[8,[32,5],null,[["@icon","@content"],["question-circle",[28,[32,6,["t"]],["discourse_ai.ai_persona.rag_chunk_tokens_help"],null]]],null],[1,"\\n          "],[13],[1,"\\n          "],[10,0],[14,0,"control-group"],[12],[1,"\\n            "],[10,"label"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.rag_chunk_overlap_tokens"],null]],[13],[1,"\\n            "],[8,[32,7],[[24,"step","any"],[24,"lang","en"],[24,0,"ai-persona-editor__rag_chunk_overlap_tokens"]],[["@type","@value"],["number",[30,0,["editingModel","rag_chunk_overlap_tokens"]]]],null],[1,"\\n            "],[8,[32,5],null,[["@icon","@content"],["question-circle",[28,[32,6,["t"]],["discourse_ai.ai_persona.rag_chunk_overlap_tokens_help"],null]]],null],[1,"\\n          "],[13],[1,"\\n          "],[10,0],[14,0,"control-group"],[12],[1,"\\n            "],[10,"label"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.rag_conversation_chunks"],null]],[13],[1,"\\n            "],[8,[32,7],[[24,"step","any"],[24,"lang","en"],[24,0,"ai-persona-editor__rag_conversation_chunks"]],[["@type","@value"],["number",[30,0,["editingModel","rag_conversation_chunks"]]]],null],[1,"\\n            "],[8,[32,5],null,[["@icon","@content"],["question-circle",[28,[32,6,["t"]],["discourse_ai.ai_persona.rag_conversation_chunks_help"],null]]],null],[1,"\\n          "],[13],[1,"\\n\\n          "],[10,0],[14,0,"control-group"],[12],[1,"\\n            "],[10,"label"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.question_consolidator_llm"],null]],[13],[1,"\\n            "],[8,[32,9],[[24,0,"ai-persona-editor__llms"]],[["@value","@llms"],[[30,0,["mappedQuestionConsolidatorLlm"]],[30,2,["resultSetMeta","llms"]]]],null],[1,"\\n\\n            "],[8,[32,5],null,[["@icon","@content"],["question-circle",[28,[32,6,["t"]],["discourse_ai.ai_persona.question_consolidator_llm_help"],null]]],null],[1,"\\n          "],[13],[1,"\\n"]],[]],null]],[]],null],[1,"      "],[10,0],[14,0,"control-group ai-persona-editor__action_panel"],[12],[1,"\\n        "],[8,[32,12],[[24,0,"btn-primary ai-persona-editor__save"]],[["@action","@disabled"],[[30,0,["save"]],[30,0,["isSaving"]]]],[["default"],[[[[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.save"],null]]],[]]]]],[1,"\\n"],[41,[30,0,["showDelete"]],[[[1,"          "],[8,[32,12],[[24,0,"btn-danger ai-persona-editor__delete"]],[["@action"],[[30,0,["delete"]]]],[["default"],[[[[1,"\\n            "],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.delete"],null]],[1,"\\n          "]],[]]]]],[1,"\\n"]],[]],null],[1,"      "],[13],[1,"\\n    "],[13],[1,"\\n  "]],["@model","@personas"],false,["unless","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-persona-editor.js",scope:()=>[c.default,r.default,a.default,h.default,o.on,x.default,b.default,i.Input,m.default,S.default,g.default,l.LinkTo,p.default,T.default,k.default,w.default,v.default,P.default],isStrictMode:!0}),this))()}e.default=j})),define("discourse/plugins/discourse-ai/discourse/components/ai-persona-list-editor",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","@ember/routing","discourse/components/d-toggle-switch","discourse/helpers/concat-class","discourse/lib/ajax-error","discourse/lib/text","discourse-common/helpers/d-icon","discourse-common/helpers/i18n","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-persona-editor","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,u,d,c,p,m,h,g,_){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class f extends t.default{static#e=(()=>dt7948.g(this.prototype,"_noPersonaText",[s.tracked],(function(){return null})))()
#W=(()=>{dt7948.i(this,"_noPersonaText")})()
get noPersonaText(){if(null===this._noPersonaText){const e=m.default.t("discourse_ai.ai_persona.no_persona_selected");(0,d.cook)(e).then((e=>{this._noPersonaText=e}))}return this._noPersonaText}async toggleEnabled(e){const t=e.enabled,s=!t
try{e.set("enabled",s),await e.save()}catch(i){e.set("enabled",t),(0,u.popupAjaxError)(i)}}static#i=(()=>dt7948.n(this.prototype,"toggleEnabled",[n.action]))()
static#n=(()=>(0,g.setComponentTemplate)((0,_.createTemplateFactory)({id:"8nF+DCXc",block:'[[[1,"\\n    "],[10,"section"],[14,0,"ai-persona-list-editor__current admin-detail pull-left"],[12],[1,"\\n"],[41,[30,1],[[[1,"        "],[8,[32,0],null,[["@model","@personas"],[[30,1],[30,2]]],null],[1,"\\n"]],[]],[[[1,"        "],[10,0],[14,0,"ai-persona-list-editor__header"],[12],[1,"\\n          "],[10,"h3"],[12],[1,[28,[32,1],["discourse_ai.ai_persona.short_title"],null]],[13],[1,"\\n"],[41,[51,[30,1,["isNew"]]],[[[1,"            "],[8,[32,2],[[24,0,"btn btn-small btn-primary"]],[["@route"],["adminPlugins.show.discourse-ai-personas.new"]],[["default"],[[[[1,"\\n              "],[1,[28,[32,3],["plus"],null]],[1,"\\n              "],[10,1],[12],[1,[28,[32,4,["t"]],["discourse_ai.ai_persona.new"],null]],[13],[1,"\\n            "]],[]]]]],[1,"\\n"]],[]],null],[1,"        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"ai-persona-list-editor__empty"],[12],[1,"\\n          "],[10,"details"],[14,0,"details__boxed"],[12],[1,"\\n            "],[10,"summary"],[12],[1,[28,[32,1],["discourse_ai.ai_persona.what_are_personas"],null]],[13],[1,"\\n            "],[1,[30,0,["noPersonaText"]]],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,"table"],[14,0,"content-list ai-persona-list-editor"],[12],[1,"\\n          "],[10,"thead"],[12],[1,"\\n            "],[10,"tr"],[12],[1,"\\n              "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.ai_persona.name"],null]],[13],[1,"\\n              "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.ai_persona.enabled"],null]],[13],[1,"\\n              "],[10,"th"],[12],[13],[1,"\\n            "],[13],[1,"\\n          "],[13],[1,"\\n          "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,3],[[28,[31,3],[[30,2]],null]],null],null,[[[1,"              "],[10,"tr"],[15,"data-persona-id",[30,3,["id"]]],[15,0,[28,[32,5],["ai-persona-list__row",[52,[30,3,["priority"]],"priority"]],null]],[12],[1,"\\n                "],[10,"td"],[12],[1,"\\n                  "],[10,0],[14,0,"ai-persona-list__name-with-description"],[12],[1,"\\n                    "],[10,0],[14,0,"ai-persona-list__name"],[12],[1,"\\n                      "],[10,"strong"],[12],[1,"\\n                        "],[1,[30,3,["name"]]],[1,"\\n                      "],[13],[1,"\\n                    "],[13],[1,"\\n                    "],[10,0],[14,0,"ai-persona-list__description"],[12],[1,"\\n                      "],[1,[30,3,["description"]]],[1,"\\n                    "],[13],[1,"\\n                  "],[13],[1,"\\n                "],[13],[1,"\\n                "],[10,"td"],[12],[1,"\\n                  "],[8,[32,6],[[4,[32,7],["click",[28,[32,8],[[30,0,["toggleEnabled"]],[30,3]],null]],null]],[["@state"],[[30,3,["enabled"]]]],null],[1,"\\n                "],[13],[1,"\\n                "],[10,"td"],[12],[1,"\\n                  "],[8,[32,2],[[24,0,"btn btn-text btn-small"]],[["@route","@model"],["adminPlugins.show.discourse-ai-personas.show",[30,3]]],[["default"],[[[[1,[28,[32,1],["discourse_ai.ai_persona.edit"],null]],[1," "]],[]]]]],[1,"\\n                "],[13],[1,"\\n              "],[13],[1,"\\n"]],[3]],null],[1,"          "],[13],[1,"\\n        "],[13],[1,"\\n"]],[]]],[1,"    "],[13],[1,"\\n  "]],["@currentPersona","@personas","persona"],false,["if","unless","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-persona-list-editor.js",scope:()=>[h.default,p.default,a.LinkTo,c.default,m.default,l.default,r.default,o.on,i.fn],isStrictMode:!0}),this))()}e.default=f})),define("discourse/plugins/discourse-ai/discourse/components/ai-persona-tool-option-editor",["exports","@glimmer/component","@ember/component","@ember/modifier","@ember/object","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{get isBoolean(){return"boolean"===this.args.option.type}get selectedValue(){return"true"===this.args.option.value.value}onCheckboxChange(e){this.args.option.value.value=e.target.checked?"true":"false"}static#e=(()=>dt7948.n(this.prototype,"onCheckboxChange",[o.action]))()
static#i=(()=>(0,s.setComponentTemplate)((0,n.createTemplateFactory)({id:"3m5ogwIV",block:'[[[1,"\\n    "],[10,0],[14,0,"control-group ai-persona-tool-option-editor"],[12],[1,"\\n      "],[10,"label"],[12],[1,"\\n        "],[1,[30,1,["name"]]],[1,"\\n      "],[13],[1,"\\n      "],[10,0],[14,0,""],[12],[1,"\\n"],[41,[30,0,["isBoolean"]],[[[1,"          "],[11,"input"],[16,"checked",[30,0,["selectedValue"]]],[24,4,"checkbox"],[4,[32,0],["click",[30,0,["onCheckboxChange"]]],null],[12],[13],[1,"\\n          "],[1,[30,1,["description"]]],[1,"\\n"]],[]],[[[1,"          "],[8,[32,1],null,[["@value"],[[30,1,["value","value"]]]],null],[1,"\\n"]],[]]],[1,"      "],[13],[1,"\\n"],[41,[51,[30,0,["isBoolean"]]],[[[1,"        "],[10,0],[14,0,"ai-persona-tool-option-editor__instructions"],[12],[1,"\\n          "],[1,[30,1,["description"]]],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n  "]],["@option"],false,["if","unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-persona-tool-option-editor.js",scope:()=>[i.on,s.Input],isStrictMode:!0}),this))()}e.default=a})),define("discourse/plugins/discourse-ai/discourse/components/ai-persona-tool-options",["exports","@glimmer/component","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-persona-tool-option-editor","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{get showToolOptions(){const e=this.args.allTools
return!!e&&this.toolNames.any((t=>e.findBy("id",t)?.options))}get toolNames(){return this.args.tools?this.args.tools.map((e=>"string"==typeof e?e:e[0])):[]}get toolOptions(){if(!this.args.tools)return[]
const e=this.args.allTools
if(!e)return[]
const t=[]
return this.toolNames.forEach((s=>{const i=e.findBy("id",s),o=i?.name,n=i?.options
if(n){const e=Object.keys(n).map((e=>{const t=this.args.persona.getToolOption(s,e)
return Object.assign({},n[e],{id:e,value:t})}))
t.push({toolName:o,options:e})}})),t}static#e=(()=>(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"Z0blnyXN",block:'[[[1,"\\n"],[41,[30,0,["showToolOptions"]],[[[1,"      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,0,["t"]],["discourse_ai.ai_persona.tool_options"],null]],[13],[1,"\\n        "],[10,0],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["toolOptions"]]],null]],null],null,[[[1,"            "],[10,0],[14,0,"ai-persona-editor__tool-options"],[12],[1,"\\n              "],[10,0],[14,0,"ai-persona-editor__tool-options-name"],[12],[1,"\\n                "],[1,[30,1,["toolName"]]],[1,"\\n              "],[13],[1,"\\n              "],[10,0],[14,0,"ai-persona-editor__tool-option-options"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,1,["options"]]],null]],null],null,[[[1,"                  "],[8,[32,1],null,[["@option"],[[30,2]]],null],[1,"\\n"]],[2]],null],[1,"              "],[13],[1,"\\n            "],[13],[1,"\\n"]],[1]],null],[1,"        "],[13],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],["toolOption","option"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-persona-tool-options.js",scope:()=>[s.default,i.default],isStrictMode:!0}),this))()}e.default=a})),define("discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","@ember/service","discourse/components/d-button","discourse/helpers/category-badge","discourse/lib/ajax","discourse/lib/ajax-error","float-kit/components/d-menu","truth-helpers/helpers/eq","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,u,d,c,p,m,h){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class g extends t.default{static#e=(()=>dt7948.g(this.prototype,"site",[a.inject]))()
#X=(()=>{dt7948.i(this,"site")})()
static#i=(()=>dt7948.g(this.prototype,"menu",[a.inject]))()
#Y=(()=>{dt7948.i(this,"menu")})()
static#n=(()=>dt7948.g(this.prototype,"suggestions",[s.tracked],(function(){return[]})))()
#J=(()=>{dt7948.i(this,"suggestions")})()
static#r=(()=>dt7948.g(this.prototype,"loading",[s.tracked],(function(){return!1})))()
#Q=(()=>{dt7948.i(this,"loading")})()
static#l=(()=>dt7948.g(this.prototype,"icon",[s.tracked],(function(){return"discourse-sparkles"})))()
#Z=(()=>{dt7948.i(this,"icon")})()
SUGGESTION_TYPES={title:"suggest_title",category:"suggest_category",tag:"suggest_tags"}
get input(){return this.args.selectedPosts.map((e=>e.cooked)).join("\n")}get disabled(){return this.loading||this.suggestions.length>0}loadSuggestions(){this.loading||this.suggestions.length>0||(this.loading=!0,(0,u.ajax)(`/discourse-ai/ai-helper/${this.args.mode}`,{method:"POST",data:{text:this.input}}).then((e=>{if(this.args.mode===this.SUGGESTION_TYPES.title)this.suggestions=e.suggestions
else if(this.args.mode===this.SUGGESTION_TYPES.category){const t=e.assistant.map((e=>e.name)),s=this.site.categories.filter((e=>t.includes(e.name.toLowerCase())))
this.suggestions=s}else this.suggestions=e.assistant.map((e=>e.name))})).catch(d.popupAjaxError).finally((()=>{this.loading=!1})))}static#g=(()=>dt7948.n(this.prototype,"loadSuggestions",[n.action]))()
applySuggestion(e,t){if(this.args.mode){if(this.args.mode===this.SUGGESTION_TYPES.title)return this.args.updateAction(e),t.close()
if(this.args.mode===this.SUGGESTION_TYPES.category)return this.args.updateAction(e.id),t.close()
if(this.args.mode===this.SUGGESTION_TYPES.tag){if(this.args.currentValue)if(Array.isArray(this.args.currentValue)){const t=[...this.args.currentValue,e]
this.args.updateAction([...new Set(t)])}else{const t=[this.args.currentValue,e]
this.args.updateAction([...new Set(t)])}else this.args.updateAction(e)
return t.close()}}}static#f=(()=>dt7948.n(this.prototype,"applySuggestion",[n.action]))()
static#y=(()=>(0,m.setComponentTemplate)((0,h.createTemplateFactory)({id:"OK/TJTRS",block:'[[[1,"\\n"],[41,[30,0,["loading"]],[[[1,"      "],[8,[32,0],[[24,0,"ai-split-topic-loading-placeholder"]],[["@disabled","@icon"],[true,"spinner"]],null],[1,"\\n"]],[]],null],[1,"    "],[8,[32,1],[[24,0,"ai-split-topic-suggestion-button"],[16,"data-suggestion-mode",[30,1]],[4,[32,2],["click",[30,0,["loadSuggestions"]]],null]],[["@icon","@interactive","@identifier"],["discourse-sparkles",true,"ai-split-topic-suggestion-menu"]],[["default"],[[[[1,"\\n      "],[10,"ul"],[14,0,"ai-split-topic-suggestion__results"],[12],[1,"\\n"],[41,[51,[30,0,["loading"]]],[[[42,[28,[31,3],[[28,[31,3],[[30,0,["suggestions"]]],null]],null],null,[[[41,[28,[32,3],[[30,1],"suggest_category"],null],[[[1,"              "],[11,"li"],[16,"data-name",[30,3,["name"]]],[16,"data-value",[30,3,["id"]]],[24,0,"ai-split-topic-suggestion__category-result"],[24,"role","button"],[4,[32,2],["click",[28,[32,4],[[30,0,["applySuggestion"]],[30,3],[30,2]],null]],null],[12],[1,"\\n                "],[1,[28,[32,5],[[30,3]],null]],[1,"\\n              "],[13],[1,"\\n"]],[]],[[[1,"              "],[10,"li"],[15,"data-name",[30,3]],[15,"data-value",[30,4]],[12],[1,"\\n                "],[8,[32,0],null,[["@translatedLabel","@action"],[[30,3],[28,[32,4],[[30,0,["applySuggestion"]],[30,3],[30,2]],null]]],null],[1,"\\n              "],[13],[1,"\\n"]],[]]]],[3,4]],null]],[]],null],[1,"      "],[13],[1,"\\n    "]],[2]]]]],[1,"\\n  "]],["@mode","menu","suggestion","index"],false,["if","unless","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester.js",scope:()=>[r.default,c.default,o.on,p.default,i.fn,l.default],isStrictMode:!0}),this))()}e.default=g})),define("discourse/plugins/discourse-ai/discourse/components/ai-suggestion-dropdown",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/service","discourse/components/d-button","discourse/lib/ajax","discourse/lib/ajax-error","discourse-common/utils/decorators","I18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,u,d,c,p,m){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class h extends t.default{static#e=(()=>dt7948.g(this.prototype,"dialog",[a.inject]))()
#p=(()=>{dt7948.i(this,"dialog")})()
static#i=(()=>dt7948.g(this.prototype,"siteSettings",[a.inject]))()
#o=(()=>{dt7948.i(this,"siteSettings")})()
static#n=(()=>dt7948.g(this.prototype,"composer",[a.inject]))()
#a=(()=>{dt7948.i(this,"composer")})()
static#r=(()=>dt7948.g(this.prototype,"loading",[s.tracked],(function(){return!1})))()
#Q=(()=>{dt7948.i(this,"loading")})()
static#l=(()=>dt7948.g(this.prototype,"showMenu",[s.tracked],(function(){return!1})))()
#ee=(()=>{dt7948.i(this,"showMenu")})()
static#g=(()=>dt7948.g(this.prototype,"generatedSuggestions",[s.tracked],(function(){return[]})))()
#te=(()=>{dt7948.i(this,"generatedSuggestions")})()
static#f=(()=>dt7948.g(this.prototype,"suggestIcon",[s.tracked],(function(){return"discourse-sparkles"})))()
#se=(()=>{dt7948.i(this,"suggestIcon")})()
static#y=(()=>dt7948.g(this.prototype,"showErrors",[s.tracked],(function(){return!1})))()
#ie=(()=>{dt7948.i(this,"showErrors")})()
static#w=(()=>dt7948.g(this.prototype,"error",[s.tracked],(function(){return""})))()
#oe=(()=>{dt7948.i(this,"error")})()
SUGGESTION_TYPES={title:"suggest_title",category:"suggest_category",tag:"suggest_tags"}
willDestroy(){super.willDestroy(...arguments),document.removeEventListener("click",this.onClickOutside)}get showAIButton(){const e=this.composer.model.replyLength>10,t=document.querySelector(".composer-fields")
return t&&(e?t.classList.add("showing-ai-suggestions"):t.classList.remove("showing-ai-suggestions")),e}get disableSuggestionButton(){return this.loading}applyClasses(){this.showAIButton?document.querySelector(".composer-fields")?.classList.add("showing-ai-suggestions"):document.querySelector(".composer-fields")?.classList.remove("showing-ai-suggestions")}static#x=(()=>dt7948.n(this.prototype,"applyClasses",[o.action]))()
onClickOutside(e){const t=document.querySelector(".ai-title-suggestions-menu")
if(e.target!==t)return this.#ne()}static#S=(()=>dt7948.n(this.prototype,"onClickOutside",[d.bind]))()
handleClickOutside(){document.addEventListener("click",this.onClickOutside)}static#k=(()=>dt7948.n(this.prototype,"handleClickOutside",[o.action]))()
applySuggestion(e){if(!this.args.mode)return
const t=this.args?.composer
if(t){if(this.args.mode===this.SUGGESTION_TYPES.title)return t.set("title",e),this.#ne()
if(this.args.mode===this.SUGGESTION_TYPES.category){const s=this.composer.categories.find((t=>t.name===e)).id
return t.set("categoryId",s),this.#ne()}this.args.mode===this.SUGGESTION_TYPES.tag&&this.#ae(e,t)}}static#T=(()=>dt7948.n(this.prototype,"applySuggestion",[o.action]))()
async performSuggestion(){if(this.args.mode)return 0===this.composer.model.replyLength?this.dialog.alert(c.default.t("discourse_ai.ai_helper.missing_content")):(this.loading=!0,this.suggestIcon="spinner",(0,l.ajax)(`/discourse-ai/ai-helper/${this.args.mode}`,{method:"POST",data:{text:this.composer.model.reply}}).then((e=>{this.#re(e,this.args.mode)})).catch(u.popupAjaxError).finally((()=>{this.loading=!1,this.suggestIcon="sync-alt",this.showMenu=!0,"suggest_category"===this.args.mode&&document.querySelector(".category-input")?.classList.add("showing-ai-suggestion-menu")})))}static#P=(()=>dt7948.n(this.prototype,"performSuggestion",[o.action]))()
#ne(){this.showMenu&&"suggest_category"===this.args.mode&&document.querySelector(".category-input")?.classList.remove("showing-ai-suggestion-menu"),this.suggestIcon="discourse-sparkles",this.showMenu=!1,this.showErrors=!1,this.errors=""}#ae(e,t){const s=this.siteSettings.max_tags_per_topic
if(!t.tags)return t.set("tags",[e]),void(this.generatedSuggestions=this.generatedSuggestions.filter((t=>t!==e)))
const i=t.tags
return i?.length>=s?(this.showErrors=!0,void(this.error=c.default.t("select_kit.max_content_reached",{count:s}))):(i.push(e),t.set("tags",[...i]),this.generatedSuggestions=this.generatedSuggestions.filter((t=>t!==e)))}#le(){return this.args.composer?.tags&&this.args.composer?.tags.length>0}#re(e,t){if(t===this.SUGGESTION_TYPES.title)return this.generatedSuggestions=e.suggestions
const s=e.assistant.map((e=>e.name))
return t===this.SUGGESTION_TYPES.tag&&this.#le()?this.generatedSuggestions=s.filter((e=>!this.args.composer.tags.includes(e))):this.generatedSuggestions=s}static#M=(()=>(0,p.setComponentTemplate)((0,m.createTemplateFactory)({id:"Cn6HectJ",block:'[[[1,"\\n"],[41,[30,0,["showAIButton"]],[[[1,"      "],[8,[32,0],[[16,0,[29,["suggestion-button ",[52,[30,0,["loading"]],"is-loading"]]]],[17,1]],[["@icon","@title","@action","@disabled"],[[30,0,["suggestIcon"]],"discourse_ai.ai_helper.suggest",[30,0,["performSuggestion"]],[30,0,["disableSuggestionButton"]]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["showMenu"]],[[[1,"      "],[11,"ul"],[24,0,"popup-menu ai-suggestions-menu"],[4,[32,1],[[30,0,["handleClickOutside"]]],null],[12],[1,"\\n"],[41,[30,0,["showErrors"]],[[[1,"          "],[10,"li"],[14,0,"ai-suggestions-menu__errors"],[12],[1,[30,0,["error"]]],[13],[1,"\\n"]],[]],null],[42,[28,[31,2],[[28,[31,2],[[30,0,["generatedSuggestions"]]],null]],null],null,[[[1,"          "],[10,"li"],[15,"data-name",[30,2]],[15,"data-value",[30,3]],[12],[1,"\\n            "],[8,[32,0],[[24,0,"popup-menu-btn"]],[["@translatedLabel","@action"],[[30,2],[28,[32,2],[[30,0,["applySuggestion"]],[30,2]],null]]],null],[1,"\\n          "],[13],[1,"\\n"]],[2,3]],null],[1,"      "],[13],[1,"\\n"]],[]],null],[1,"  "]],["&attrs","suggestion","index"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-suggestion-dropdown.js",scope:()=>[r.default,n.default,i.fn],isStrictMode:!0}),this))()}e.default=h})),define("discourse/plugins/discourse-ai/discourse/components/ai-tool-editor",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/did-update","@ember/service","discourse/components/back-button","discourse/components/d-button","discourse/components/d-tooltip","discourse/helpers/with-event-value","discourse/lib/ajax-error","discourse-i18n","admin/components/ace-editor","select-kit/components/combo-box","discourse/plugins/discourse-ai/discourse/components/ai-tool-parameter-editor","discourse/plugins/discourse-ai/discourse/components/modal/ai-tool-test-modal","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,u,d,c,p,m,h,g,_,f,b,y,v){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class w extends t.default{static#e=(()=>dt7948.g(this.prototype,"router",[l.service]))()
#c=(()=>{dt7948.i(this,"router")})()
static#i=(()=>dt7948.g(this.prototype,"dialog",[l.service]))()
#p=(()=>{dt7948.i(this,"dialog")})()
static#n=(()=>dt7948.g(this.prototype,"modal",[l.service]))()
#ue=(()=>{dt7948.i(this,"modal")})()
static#r=(()=>dt7948.g(this.prototype,"toasts",[l.service]))()
#d=(()=>{dt7948.i(this,"toasts")})()
static#l=(()=>dt7948.g(this.prototype,"isSaving",[s.tracked],(function(){return!1})))()
#m=(()=>{dt7948.i(this,"isSaving")})()
static#g=(()=>dt7948.g(this.prototype,"editingModel",[s.tracked],(function(){return null})))()
#I=(()=>{dt7948.i(this,"editingModel")})()
static#f=(()=>dt7948.g(this.prototype,"showDelete",[s.tracked],(function(){return!1})))()
#O=(()=>{dt7948.i(this,"showDelete")})()
static#y=(()=>dt7948.g(this.prototype,"selectedPreset",[s.tracked],(function(){return null})))()
#de=(()=>{dt7948.i(this,"selectedPreset")})()
get presets(){return this.args.presets.map((e=>({name:e.preset_name,id:e.preset_id})))}get showPresets(){return!this.selectedPreset&&this.args.model.isNew}updateModel(){this.editingModel=this.args.model.workingCopy(),this.showDelete=!this.args.model.isNew}static#w=(()=>dt7948.n(this.prototype,"updateModel",[n.action]))()
configurePreset(){this.selectedPreset=this.args.presets.findBy("preset_id",this.presetId),this.editingModel=this.args.model.workingCopy(),this.editingModel.setProperties(this.selectedPreset),this.showDelete=!1}static#x=(()=>dt7948.n(this.prototype,"configurePreset",[n.action]))()
async save(){this.isSaving=!0
try{const e=this.editingModel.getProperties("name","description","parameters","script","summary")
for(const t of e.parameters)t.enumValues&&(t.enum_values=t.enumValues,delete t.enumValues)
await this.args.model.save(e),this.toasts.success({data:{message:h.default.t("discourse_ai.tools.saved")},duration:2e3}),this.args.tools.any((e=>e.id===this.args.model.id))||this.args.tools.pushObject(this.args.model),this.router.transitionTo("adminPlugins.show.discourse-ai-tools.show",this.args.model)}catch(e){(0,m.popupAjaxError)(e)}finally{this.isSaving=!1}}static#S=(()=>dt7948.n(this.prototype,"save",[n.action]))()
delete(){return this.dialog.confirm({message:h.default.t("discourse_ai.tools.confirm_delete"),didConfirm:async()=>{await this.args.model.destroyRecord(),this.args.tools.removeObject(this.args.model),this.router.transitionTo("adminPlugins.show.discourse-ai-tools.index")}})}static#k=(()=>dt7948.n(this.prototype,"delete",[n.action]))()
openTestModal(){this.modal.show(b.default,{model:{tool:this.editingModel}})}static#T=(()=>dt7948.n(this.prototype,"openTestModal",[n.action]))()
static#P=(()=>(0,y.setComponentTemplate)((0,v.createTemplateFactory)({id:"JbB51ZkD",block:'[[[1,"\\n    "],[8,[32,0],null,[["@route","@label"],["adminPlugins.show.discourse-ai-tools","discourse_ai.ai_tool.back"]],null],[1,"\\n\\n    "],[11,"form"],[24,0,"form-horizontal ai-tool-editor"],[4,[32,1],[[30,0,["updateModel"]],[30,1,["id"]]],null],[4,[32,2],[[30,0,["updateModel"]],[30,1,["id"]]],null],[12],[1,"\\n"],[41,[30,0,["showPresets"]],[[[1,"        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,3,["t"]],["discourse_ai.tools.presets"],null]],[13],[1,"\\n          "],[8,[32,4],[[24,0,"ai-tool-editor__presets"]],[["@value","@content"],[[30,0,["presetId"]],[30,0,["presets"]]]],null],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"control-group ai-llm-editor__action_panel"],[12],[1,"\\n          "],[8,[32,5],[[24,0,"ai-tool-editor__next"]],[["@action","@label"],[[30,0,["configurePreset"]],"discourse_ai.tools.next.title"]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],[[[1,"        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,3,["t"]],["discourse_ai.tools.name"],null]],[13],[1,"\\n          "],[11,"input"],[16,2,[30,0,["editingModel","name"]]],[24,0,"ai-tool-editor__name"],[24,4,"text"],[4,[32,6],["input",[28,[32,7],[[28,[32,8],[[28,[31,1],[[30,0,["editingModel","name"]]],null]],null]],null]],null],[12],[13],[1,"\\n          "],[8,[32,9],null,[["@icon","@content"],["question-circle",[28,[32,3,["t"]],["discourse_ai.tools.name_help"],null]]],null],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,3,["t"]],["discourse_ai.tools.description"],null]],[13],[1,"\\n          "],[11,"textarea"],[16,"placeholder",[28,[32,3,["t"]],["discourse_ai.tools.description_help"],null]],[24,0,"ai-tool-editor__description input-xxlarge"],[4,[32,6],["input",[28,[32,7],[[28,[32,8],[[28,[31,1],[[30,0,["editingModel","description"]]],null]],null]],null]],null],[12],[1,[30,0,["editingModel","description"]]],[13],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,3,["t"]],["discourse_ai.tools.summary"],null]],[13],[1,"\\n          "],[11,"input"],[16,2,[30,0,["editingModel","summary"]]],[24,0,"ai-tool-editor__summary input-xxlarge"],[24,4,"text"],[4,[32,6],["input",[28,[32,7],[[28,[32,8],[[28,[31,1],[[30,0,["editingModel","summary"]]],null]],null]],null]],null],[12],[13],[1,"\\n          "],[8,[32,9],null,[["@icon","@content"],["question-circle",[28,[32,3,["t"]],["discourse_ai.tools.summary_help"],null]]],null],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,3,["t"]],["discourse_ai.tools.parameters"],null]],[13],[1,"\\n          "],[8,[32,10],null,[["@parameters"],[[30,0,["editingModel","parameters"]]]],null],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,3,["t"]],["discourse_ai.tools.script"],null]],[13],[1,"\\n          "],[8,[32,11],null,[["@content","@onChange","@mode","@theme","@editorId"],[[30,0,["editingModel","script"]],[28,[32,7],[[28,[32,8],[[28,[31,1],[[30,0,["editingModel","script"]]],null]],null]],null],[32,12],[32,13],"ai-tool-script-editor"]],null],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"control-group ai-tool-editor__action_panel"],[12],[1,"\\n          "],[8,[32,5],[[24,0,"ai-tool-editor__test-button"]],[["@action","@label"],[[30,0,["openTestModal"]],"discourse_ai.tools.test"]],null],[1,"\\n\\n          "],[8,[32,5],[[24,0,"btn-primary ai-tool-editor__save"]],[["@action","@label","@disabled"],[[30,0,["save"]],"discourse_ai.tools.save",[30,0,["isSaving"]]]],null],[1,"\\n\\n"],[41,[30,0,["showDelete"]],[[[1,"            "],[8,[32,5],[[24,0,"btn-danger ai-tool-editor__delete"]],[["@action","@label"],[[30,0,["delete"]],"discourse_ai.tools.delete"]],null],[1,"\\n"]],[]],null],[1,"        "],[13],[1,"\\n"]],[]]],[1,"    "],[13],[1,"\\n  "]],["@model"],false,["if","mut"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-tool-editor.js",scope:()=>[u.default,a.default,r.default,h.default,_.default,d.default,o.on,p.default,i.fn,c.default,f.default,g.default,"javascript","chrome"],isStrictMode:!0}),this))()}e.default=w})),define("discourse/plugins/discourse-ai/discourse/components/ai-tool-list-editor",["exports","@ember/routing","discourse-common/helpers/d-icon","discourse-i18n","@ember/component","@ember/template-factory","@ember/component/template-only"],(function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"2/cRV6Rm",block:'[[[1,"\\n  "],[10,"section"],[14,0,"ai-tool-list-editor__current admin-detail pull-left"],[12],[1,"\\n    "],[10,0],[14,0,"ai-tool-list-editor__header"],[12],[1,"\\n      "],[10,"h3"],[12],[1,[28,[32,0,["t"]],["discourse_ai.tools.short_title"],null]],[13],[1,"\\n      "],[8,[32,1],[[24,0,"btn btn-small btn-primary ai-tool-list-editor__new-button"]],[["@route"],["adminPlugins.show.discourse-ai-tools.new"]],[["default"],[[[[1,"\\n        "],[1,[28,[32,2],["plus"],null]],[1,"\\n        "],[10,1],[12],[1,[28,[32,0,["t"]],["discourse_ai.tools.new"],null]],[13],[1,"\\n      "]],[]]]]],[1,"\\n    "],[13],[1,"\\n\\n    "],[10,"table"],[14,0,"content-list ai-tool-list-editor"],[12],[1,"\\n      "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,1]],null]],null],null,[[[1,"          "],[10,"tr"],[15,"data-tool-id",[30,2,["id"]]],[14,0,"ai-tool-list__row"],[12],[1,"\\n            "],[10,"td"],[12],[1,"\\n              "],[10,0],[14,0,"ai-tool-list__name-with-description"],[12],[1,"\\n                "],[10,0],[14,0,"ai-tool-list__name"],[12],[1,"\\n                  "],[10,"strong"],[12],[1,"\\n                    "],[1,[30,2,["name"]]],[1,"\\n                  "],[13],[1,"\\n                "],[13],[1,"\\n                "],[10,0],[14,0,"ai-tool-list__description"],[12],[1,"\\n                  "],[1,[30,2,["description"]]],[1,"\\n                "],[13],[1,"\\n              "],[13],[1,"\\n            "],[13],[1,"\\n            "],[10,"td"],[12],[1,"\\n              "],[8,[32,1],[[24,0,"btn btn-text btn-small"]],[["@route","@model"],["adminPlugins.show.discourse-ai-tools.show",[30,2]]],[["default"],[[[[1,[28,[32,0,["t"]],["discourse_ai.tools.edit"],null]]],[]]]]],[1,"\\n            "],[13],[1,"\\n          "],[13],[1,"\\n"]],[2]],null],[1,"      "],[13],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n"]],["@tools","tool"],false,["each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-tool-list-editor.js",scope:()=>[i.default,t.LinkTo,s.default],isStrictMode:!0}),(0,a.default)())})),define("discourse/plugins/discourse-ai/discourse/components/ai-tool-parameter-editor",["exports","@glimmer/component","@ember/helper","@ember/modifier","@ember/object","@ember-compat/tracked-built-ins","discourse/components/d-button","discourse/helpers/with-event-value","discourse-i18n","select-kit/components/combo-box","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,u,d,c){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const p=[{name:"string",id:"string"},{name:"number",id:"number"},{name:"boolean",id:"boolean"},{name:"array",id:"array"}]
class m extends t.default{addParameter(){this.args.parameters.push(new n.TrackedObject({name:"",description:"",type:"string",required:!1,enum:!1,enumValues:null}))}static#e=(()=>dt7948.n(this.prototype,"addParameter",[o.action]))()
removeParameter(e){const t=this.args.parameters.indexOf(e)
this.args.parameters.splice(t,1)}static#i=(()=>dt7948.n(this.prototype,"removeParameter",[o.action]))()
toggleRequired(e,t){e.required=t.target.checked}static#n=(()=>dt7948.n(this.prototype,"toggleRequired",[o.action]))()
toggleEnum(e){e.enum=!e.enum,e.enum||(e.enumValues=null)}static#r=(()=>dt7948.n(this.prototype,"toggleEnum",[o.action]))()
addEnumValue(e){e.enumValues||=new n.TrackedArray,e.enumValues.push("")}static#l=(()=>dt7948.n(this.prototype,"addEnumValue",[o.action]))()
removeEnumValue(e,t){e.enumValues.splice(t,1)}static#g=(()=>dt7948.n(this.prototype,"removeEnumValue",[o.action]))()
updateEnumValue(e,t,s){e.enumValues[t]=s.target.value}static#f=(()=>dt7948.n(this.prototype,"updateEnumValue",[o.action]))()
static#y=(()=>(0,d.setComponentTemplate)((0,c.createTemplateFactory)({id:"z+0la4qv",block:'[[[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,1]],null]],null],null,[[[1,"      "],[10,0],[14,0,"ai-tool-parameter"],[12],[1,"\\n        "],[10,0],[14,0,"parameter-row"],[12],[1,"\\n          "],[11,"input"],[16,2,[30,2,["name"]]],[16,"placeholder",[28,[32,0,["t"]],["discourse_ai.tools.parameter_name"],null]],[24,4,"text"],[4,[32,1],["input",[28,[32,2],[[28,[32,3],[[28,[31,2],[[30,2,["name"]]],null]],null]],null]],null],[12],[13],[1,"\\n          "],[8,[32,4],null,[["@value","@content"],[[30,2,["type"]],[32,5]]],null],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"parameter-row"],[12],[1,"\\n          "],[11,"input"],[16,2,[30,2,["description"]]],[16,"placeholder",[28,[32,0,["t"]],["discourse_ai.tools.parameter_description"],null]],[24,4,"text"],[4,[32,1],["input",[28,[32,2],[[28,[32,3],[[28,[31,2],[[30,2,["description"]]],null]],null]],null]],null],[12],[13],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"parameter-row"],[12],[1,"\\n          "],[10,"label"],[12],[1,"\\n            "],[11,"input"],[16,"checked",[30,2,["required"]]],[24,4,"checkbox"],[4,[32,1],["input",[28,[32,3],[[30,0,["toggleRequired"]],[30,2]],null]],null],[12],[13],[1,"\\n            "],[1,[28,[32,0,["t"]],["discourse_ai.tools.parameter_required"],null]],[1,"\\n          "],[13],[1,"\\n\\n          "],[10,"label"],[12],[1,"\\n            "],[11,"input"],[16,"checked",[30,2,["enum"]]],[24,4,"checkbox"],[4,[32,1],["input",[28,[32,3],[[30,0,["toggleEnum"]],[30,2]],null]],null],[12],[13],[1,"\\n            "],[1,[28,[32,0,["t"]],["discourse_ai.tools.parameter_enum"],null]],[1,"\\n          "],[13],[1,"\\n\\n          "],[8,[32,6],[[24,0,"btn-danger"]],[["@action","@icon"],[[28,[32,3],[[30,0,["removeParameter"]],[30,2]],null],"trash-alt"]],null],[1,"\\n        "],[13],[1,"\\n\\n"],[41,[30,2,["enum"]],[[[1,"          "],[10,0],[14,0,"parameter-enum-values"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,2,["enumValues"]]],null]],null],null,[[[1,"              "],[10,0],[14,0,"enum-value-row"],[12],[1,"\\n                "],[11,"input"],[16,2,[30,3]],[16,"placeholder",[28,[32,0,["t"]],["discourse_ai.tools.enum_value"],null]],[24,4,"text"],[4,[32,1],["change",[28,[32,3],[[30,0,["updateEnumValue"]],[30,2],[30,4]],null]],null],[12],[13],[1,"\\n                "],[8,[32,6],[[24,0,"btn-danger"]],[["@action","@icon"],[[28,[32,3],[[30,0,["removeEnumValue"]],[30,2],[30,4]],null],"trash-alt"]],null],[1,"\\n              "],[13],[1,"\\n"]],[3,4]],null],[1,"\\n            "],[8,[32,6],null,[["@action","@label","@icon"],[[28,[32,3],[[30,0,["addEnumValue"]],[30,2]],null],"discourse_ai.tools.add_enum_value","plus"]],null],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"      "],[13],[1,"\\n"]],[2]],null],[1,"\\n    "],[8,[32,6],null,[["@action","@label","@icon"],[[30,0,["addParameter"]],"discourse_ai.tools.add_parameter","plus"]],null],[1,"\\n  "]],["@parameters","parameter","enumValue","enumIndex"],false,["each","-track-array","mut","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-tool-parameter-editor.js",scope:()=>[l.default,i.on,r.default,s.fn,u.default,p,a.default],isStrictMode:!0}),this))()}e.default=m})),define("discourse/plugins/discourse-ai/discourse/components/ai-tool-selector",["exports","@ember/object","select-kit/components/multi-select"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=s.default.extend({_modelDisabledChanged:(0,t.observer)("attrs.disabled",(function(){this.selectKit.options.set("disabled",this.get("attrs.disabled.value"))})),content:(0,t.computed)((function(){return this.tools})),value:"",selectKitOptions:{filterable:!0}})})),define("discourse/plugins/discourse-ai/discourse/components/modal/ai-tool-test-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","discourse/components/d-button","discourse/components/d-modal","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/utilities","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,u,d,c,p,m){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class h extends t.default{static#e=(()=>dt7948.g(this.prototype,"testResult",[s.tracked]))()
#_=(()=>{dt7948.i(this,"testResult")})()
static#i=(()=>dt7948.g(this.prototype,"isLoading",[s.tracked],(function(){return!1})))()
#ce=(()=>{dt7948.i(this,"isLoading")})()
parameterValues={}
updateParameter(e,t){this.parameterValues[e]=t.target.value}static#n=(()=>dt7948.n(this.prototype,"updateParameter",[n.action]))()
async runTest(){this.isLoading=!0
try{const e=await(0,l.ajax)("/admin/plugins/discourse-ai/ai-tools/test.json",{type:"POST",data:JSON.stringify({ai_tool:this.args.model.tool,parameters:this.parameterValues}),contentType:"application/json"})
this.testResult=(0,c.jsonToHtml)(e.output)}catch(e){(0,u.popupAjaxError)(e)}finally{this.isLoading=!1}}static#r=(()=>dt7948.n(this.prototype,"runTest",[n.action]))()
static#l=(()=>(0,p.setComponentTemplate)((0,m.createTemplateFactory)({id:"aClC59Lc",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"ai-tool-test-modal"]],[["@title","@closeModal","@bodyClass"],[[28,[32,1,["t"]],["discourse_ai.tools.test_modal.title"],null],[30,1],"ai-tool-test-modal__body"]],[["body","footer"],[[[[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,2,["tool","parameters"]]],null]],null],null,[[[1,"          "],[10,0],[14,0,"control-group"],[12],[1,"\\n            "],[10,"label"],[12],[1,[30,3,["name"]]],[13],[1,"\\n            "],[11,"input"],[16,3,[30,3,["name"]]],[24,4,"text"],[4,[32,2],["input",[28,[32,3],[[30,0,["updateParameter"]],[30,3,["name"]]],null]],null],[12],[13],[1,"\\n          "],[13],[1,"\\n"]],[3]],null],[1,"\\n"],[41,[30,0,["testResult"]],[[[1,"          "],[10,0],[14,0,"ai-tool-test-modal__test-result"],[12],[1,"\\n            "],[10,"h3"],[12],[1,[28,[32,1,["t"]],["discourse_ai.tools.test_modal.result"],null]],[13],[1,"\\n            "],[10,0],[12],[1,[30,0,["testResult"]]],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"      "]],[]],[[[1,"\\n        "],[8,[32,4],[[24,0,"btn-primary ai-tool-test-modal__run-button"]],[["@action","@label","@disabled"],[[30,0,["runTest"]],"discourse_ai.tools.test_modal.run",[30,0,["isLoading"]]]],null],[1,"\\n      "]],[]]]]],[1,"\\n  "]],["@closeModal","@model","param"],false,["each","-track-array","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/ai-tool-test-modal.js",scope:()=>[r.default,d.default,o.on,i.fn,a.default],isStrictMode:!0}),this))()}e.default=h})),define("discourse/plugins/discourse-ai/discourse/components/modal/debug-ai-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/modifier","@ember/object","@ember/runloop","@ember/template","discourse/components/d-button","discourse/components/d-modal","discourse/lib/ajax","discourse/lib/utilities","discourse-common/helpers/i18n","discourse-common/lib/later","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/utilities","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,u,d,c,p,m,h,g,_){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class f extends t.default{static#e=(()=>dt7948.g(this.prototype,"info",[s.tracked],(function(){return null})))()
#pe=(()=>{dt7948.i(this,"info")})()
static#i=(()=>dt7948.g(this.prototype,"justCopiedText",[s.tracked],(function(){return""})))()
#me=(()=>{dt7948.i(this,"justCopiedText")})()
static#n=(()=>dt7948.g(this.prototype,"activeTab",[s.tracked],(function(){return"request"})))()
#he=(()=>{dt7948.i(this,"activeTab")})()
constructor(){super(...arguments),(0,n.next)((()=>{this.loadApiRequestInfo()}))}get htmlContext(){if(!this.info)return""
let e
try{if("request"!==this.activeTab)return this.formattedResponse(this.info.raw_response_payload)
e=JSON.parse(this.info.raw_request_payload)}catch(t){return this.info.raw_request_payload}return(0,h.jsonToHtml)(e)}formattedResponse(e){const t=e.split("\n").map((e=>(0,d.escapeExpression)(e))).join("<br>")
return(0,a.htmlSafe)(t)}copyRequest(){this.copy(this.info.raw_request_payload)}static#r=(()=>dt7948.n(this.prototype,"copyRequest",[o.action]))()
copyResponse(){this.copy(this.info.raw_response_payload)}static#l=(()=>dt7948.n(this.prototype,"copyResponse",[o.action]))()
copy(e){(0,d.clipboardCopy)(e),this.justCopiedText=m.default.t("discourse_ai.ai_bot.conversation_shared"),(0,p.default)((()=>{this.justCopiedText=""}),2e3)}loadApiRequestInfo(){(0,u.ajax)(`/discourse-ai/ai-bot/post/${this.args.model.id}/show-debug-info.json`).then((e=>{this.info=e}))}get requestActive(){return"request"===this.activeTab?"active":""}get responseActive(){return"response"===this.activeTab?"active":""}requestClicked(e){this.activeTab="request",e.preventDefault()}static#g=(()=>dt7948.n(this.prototype,"requestClicked",[o.action]))()
responseClicked(e){this.activeTab="response",e.preventDefault()}static#f=(()=>dt7948.n(this.prototype,"responseClicked",[o.action]))()
static#y=(()=>(0,g.setComponentTemplate)((0,_.createTemplateFactory)({id:"SZ4z76vH",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"ai-debug-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.ai_bot.debug_ai_modal.title"],null],[30,1]]],[["body","footer"],[[[[1,"\\n        "],[10,"ul"],[14,0,"nav nav-pills ai-debug-modal__nav"],[12],[1,"\\n          "],[10,"li"],[12],[11,3],[24,6,""],[16,0,[30,0,["requestActive"]]],[4,[32,2],["click",[30,0,["requestClicked"]]],null],[12],[1,[28,[32,1],["discourse_ai.ai_bot.debug_ai_modal.request"],null]],[13],[13],[1,"\\n          "],[10,"li"],[12],[11,3],[24,6,""],[16,0,[30,0,["responseActive"]]],[4,[32,2],["click",[30,0,["responseClicked"]]],null],[12],[1,[28,[32,1],["discourse_ai.ai_bot.debug_ai_modal.response"],null]],[13],[13],[1,"\\n        "],[13],[1,"\\n        "],[10,0],[14,0,"ai-debug-modal__tokens"],[12],[1,"\\n          "],[10,1],[12],[1,"\\n            "],[1,[28,[32,1],["discourse_ai.ai_bot.debug_ai_modal.request_tokens"],null]],[1,"\\n            "],[1,[30,0,["info","request_tokens"]]],[1,"\\n          "],[13],[1,"\\n          "],[10,1],[12],[1,"\\n            "],[1,[28,[32,1],["discourse_ai.ai_bot.debug_ai_modal.response_tokens"],null]],[1,"\\n            "],[1,[30,0,["info","response_tokens"]]],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n        "],[10,0],[14,0,"debug-ai-modal__preview"],[12],[1,"\\n          "],[1,[30,0,["htmlContext"]]],[1,"\\n        "],[13],[1,"\\n      "]],[]],[[[1,"\\n        "],[8,[32,3],[[24,0,"btn confirm"]],[["@icon","@action","@label"],["copy",[30,0,["copyRequest"]],"discourse_ai.ai_bot.debug_ai_modal.copy_request"]],null],[1,"\\n        "],[8,[32,3],[[24,0,"btn confirm"]],[["@icon","@action","@label"],["copy",[30,0,["copyResponse"]],"discourse_ai.ai_bot.debug_ai_modal.copy_response"]],null],[1,"\\n        "],[10,1],[14,0,"ai-debut-modal__just-copied"],[12],[1,[30,0,["justCopiedText"]]],[13],[1,"\\n      "]],[]]]]],[1,"\\n  "]],["@closeModal"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/debug-ai-modal.js",scope:()=>[l.default,c.default,i.on,r.default],isStrictMode:!0}),this))()}e.default=f})),define("discourse/plugins/discourse-ai/discourse/components/modal/diff-modal",["exports","@glimmer/component","@ember/object","@ember/template","discourse/components/d-button","discourse/components/d-modal","discourse-common/helpers/i18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class u extends t.default{triggerConfirmChanges(){this.args.closeModal(),this.args.confirm()}static#e=(()=>dt7948.n(this.prototype,"triggerConfirmChanges",[s.action]))()
triggerRevertChanges(){this.args.closeModal(),this.args.revert()}static#i=(()=>dt7948.n(this.prototype,"triggerRevertChanges",[s.action]))()
static#n=(()=>(0,r.setComponentTemplate)((0,l.createTemplateFactory)({id:"tqHStVL1",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"composer-ai-helper-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.ai_helper.context_menu.changes"],null],[30,1]]],[["body","footer"],[[[[1,"\\n"],[41,[30,2],[[[1,"          "],[1,[28,[32,2],[[30,2]],null]],[1,"\\n"]],[]],[[[1,"          "],[10,0],[14,0,"composer-ai-helper-modal__old-value"],[12],[1,"\\n            "],[1,[30,3]],[1,"\\n          "],[13],[1,"\\n\\n          "],[10,0],[14,0,"composer-ai-helper-modal__new-value"],[12],[1,"\\n            "],[1,[30,4]],[1,"\\n          "],[13],[1,"\\n"]],[]]],[1,"      "]],[]],[[[1,"\\n        "],[8,[32,3],[[24,0,"btn-primary confirm"]],[["@action","@label"],[[30,0,["triggerConfirmChanges"]],"discourse_ai.ai_helper.context_menu.confirm"]],null],[1,"\\n        "],[8,[32,3],[[24,0,"btn-flat"]],[["@action","@label"],[[30,0,["triggerRevertChanges"]],"discourse_ai.ai_helper.context_menu.revert"]],null],[1,"\\n      "]],[]]]]],[1,"\\n  "]],["@closeModal","@diff","@oldValue","@newValue"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/diff-modal.js",scope:()=>[n.default,a.default,i.htmlSafe,o.default],isStrictMode:!0}),this))()}e.default=u})),define("discourse/plugins/discourse-ai/discourse/components/modal/share-full-topic-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/service","@ember/template","discourse/components/d-button","discourse/components/d-modal","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/utilities","discourse-common/helpers/i18n","discourse-common/lib/get-url","discourse-i18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,u,d,c,p,m,h,g){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class _ extends t.default{static#e=(()=>dt7948.g(this.prototype,"toasts",[o.inject]))()
#d=(()=>{dt7948.i(this,"toasts")})()
static#i=(()=>dt7948.g(this.prototype,"shareKey",[s.tracked],(function(){return""})))()
#ge=(()=>{dt7948.i(this,"shareKey")})()
constructor(){super(...arguments),this.shareKey=this.args.model.share_key}get htmlContext(){let e=[]
return this.args.model.context.forEach((t=>{e.push(`<p><b>${t.username}:</b></p>`),e.push(t.cooked)})),(0,n.htmlSafe)(e.join("\n"))}async generateShareURL(){try{const e=await(0,l.ajax)("/discourse-ai/ai-bot/shared-ai-conversations",{type:"POST",data:{topic_id:this.args.model.topic_id}}),t=(0,p.getAbsoluteURL)(`/discourse-ai/ai-bot/shared-ai-conversations/${e.share_key}`)
return this.shareKey=e.share_key,new Blob([t],{type:"text/plain"})}catch(e){return void(0,u.popupAjaxError)(e)}}get primaryLabel(){return this.shareKey?"discourse_ai.ai_bot.share_full_topic_modal.update":"discourse_ai.ai_bot.share_full_topic_modal.share"}async deleteLink(){try{await(0,l.ajax)(`/discourse-ai/ai-bot/shared-ai-conversations/${this.shareKey}.json`,{type:"DELETE"}),this.shareKey=null}catch(e){(0,u.popupAjaxError)(e)}}static#n=(()=>dt7948.n(this.prototype,"deleteLink",[i.action]))()
async share(){await(0,d.clipboardCopyAsync)(this.generateShareURL.bind(this)),this.toasts.success({duration:3e3,data:{message:m.default.t("discourse_ai.ai_bot.conversation_shared")}})}static#r=(()=>dt7948.n(this.prototype,"share",[i.action]))()
static#l=(()=>(0,h.setComponentTemplate)((0,g.createTemplateFactory)({id:"In8VW+gA",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"ai-share-full-topic-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.ai_bot.share_full_topic_modal.title"],null],[30,1]]],[["body","footer"],[[[[1,"\\n        "],[10,0],[14,0,"ai-share-full-topic-modal__body"],[12],[1,"\\n          "],[1,[30,0,["htmlContext"]]],[1,"\\n        "],[13],[1,"\\n      "]],[]],[[[1,"\\n        "],[8,[32,2],[[24,0,"btn-primary confirm"]],[["@icon","@action","@label"],["copy",[30,0,["share"]],[30,0,["primaryLabel"]]]],null],[1,"\\n"],[41,[30,0,["shareKey"]],[[[1,"          "],[8,[32,2],[[24,0,"btn-danger"]],[["@icon","@action","@label"],["far-trash-alt",[30,0,["deleteLink"]],"discourse_ai.ai_bot.share_full_topic_modal.delete"]],null],[1,"\\n"]],[]],null],[1,"      "]],[]]]]],[1,"\\n  "]],["@closeModal"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/share-full-topic-modal.js",scope:()=>[r.default,c.default,a.default],isStrictMode:!0}),this))()}e.default=_})),define("discourse/plugins/discourse-ai/discourse/components/modal/share-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/component","@ember/modifier","@ember/object","@ember/service","@ember/template","discourse/components/d-button","discourse/components/d-modal","discourse-common/helpers/i18n","discourse-common/lib/later","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper","discourse/plugins/discourse-ai/discourse/lib/copy-conversation","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,u,d,c,p,m,h,g){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class _ extends t.default{static#e=(()=>dt7948.g(this.prototype,"modal",[a.service]))()
#ue=(()=>{dt7948.i(this,"modal")})()
static#i=(()=>dt7948.g(this.prototype,"siteSettings",[a.service]))()
#o=(()=>{dt7948.i(this,"siteSettings")})()
static#n=(()=>dt7948.g(this.prototype,"currentUser",[a.service]))()
#s=(()=>{dt7948.i(this,"currentUser")})()
static#r=(()=>dt7948.g(this.prototype,"contextValue",[s.tracked],(function(){return 1})))()
#_e=(()=>{dt7948.i(this,"contextValue")})()
static#l=(()=>dt7948.g(this.prototype,"htmlContext",[s.tracked],(function(){return""})))()
#fe=(()=>{dt7948.i(this,"htmlContext")})()
static#g=(()=>dt7948.g(this.prototype,"maxContext",[s.tracked],(function(){return 0})))()
#be=(()=>{dt7948.i(this,"maxContext")})()
static#f=(()=>dt7948.g(this.prototype,"allPosts",[s.tracked],(function(){return[]})))()
#ye=(()=>{dt7948.i(this,"allPosts")})()
static#y=(()=>dt7948.g(this.prototype,"justCopiedText",[s.tracked],(function(){return""})))()
#me=(()=>{dt7948.i(this,"justCopiedText")})()
constructor(){super(...arguments)
const e=this.args.model.topic.get("postStream")
let t=[]
for(let s=1;s<=this.args.model.post_number;s++)t.push(s)
this.allPosts=t.map((t=>{let s=e.findPostIdForPostNumber(t)
if(s)return e.findLoadedPost(s)})).filter((e=>e)),this.maxContext=this.allPosts.length/2,this.contextValue=1,this.updateHtmlContext()}updateHtmlContext(){let e=[]
for(let t=this.allPosts.length-2*this.contextValue;t<this.allPosts.length;t++){const s=this.allPosts[t]
e.push(`<p><b>${s.username}:</b></p>`),e.push(s.cooked)}this.htmlContext=(0,r.htmlSafe)(e.join("\n"))}static#w=(()=>dt7948.n(this.prototype,"updateHtmlContext",[n.action]))()
async copyContext(){const e=this.allPosts[this.allPosts.length-2*this.contextValue].post_number,t=this.args.model.post_number
await(0,h.default)(this.args.model.topic,e,t),this.justCopiedText=p.default.t("discourse_ai.ai_bot.conversation_shared"),(0,c.default)((()=>{this.justCopiedText=""}),2e3)}static#x=(()=>dt7948.n(this.prototype,"copyContext",[n.action]))()
shareConversationModal(e){return e?.preventDefault(),this.args.closeModal(),(0,m.showShareConversationModal)(this.modal,this.args.model.topic_id),!1}static#S=(()=>dt7948.n(this.prototype,"shareConversationModal",[n.action]))()
static#k=(()=>(0,i.setComponentTemplate)((0,g.createTemplateFactory)({id:"Ccsc9yzh",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"ai-share-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.ai_bot.share_modal.title"],null],[30,1]]],[["body","footer"],[[[[1,"\\n        "],[10,0],[14,0,"ai-share-modal__preview"],[12],[1,"\\n          "],[1,[30,0,["htmlContext"]]],[1,"\\n        "],[13],[1,"\\n      "]],[]],[[[1,"\\n        "],[10,0],[14,0,"ai-share-modal__slider"],[12],[1,"\\n          "],[8,[32,2],[[24,"min","1"],[16,"max",[30,0,["maxContext"]]],[4,[32,3],["change",[30,0,["updateHtmlContext"]]],null]],[["@type","@value"],["range",[30,0,["contextValue"]]]],null],[1,"\\n          "],[10,0],[14,0,"ai-share-modal__context"],[12],[1,"\\n            "],[1,[28,[32,1],["discourse_ai.ai_bot.share_modal.context"],null]],[1,"\\n            "],[1,[30,0,["contextValue"]]],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n        "],[8,[32,4],[[24,0,"btn-primary confirm"]],[["@icon","@action","@label"],["copy",[30,0,["copyContext"]],"discourse_ai.ai_bot.share_modal.copy"]],null],[1,"\\n        "],[10,1],[14,0,"ai-share-modal__just-copied"],[12],[1,[30,0,["justCopiedText"]]],[13],[1,"\\n"],[41,[30,0,["currentUser","can_share_ai_bot_conversations"]],[[[1,"          "],[11,3],[24,6,""],[4,[32,3],["click",[30,0,["shareConversationModal"]]],null],[12],[1,"\\n            "],[10,1],[14,0,"ai-share-modal__share-tip"],[12],[1,"\\n              "],[1,[28,[32,1],["discourse_ai.ai_bot.share_modal.share_tip"],null]],[1,"\\n            "],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"      "]],[]]]]],[1,"\\n  "]],["@closeModal"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/share-modal.js",scope:()=>[u.default,d.default,i.Input,o.on,l.default],isStrictMode:!0}),this))()}e.default=_}))
define("discourse/plugins/discourse-ai/discourse/components/modal/thumbnail-suggestions",["exports","@glimmer/component","@glimmer/tracking","@ember/object","discourse/components/d-button","discourse/components/d-modal","discourse/components/d-modal-cancel","discourse-common/helpers/i18n","discourse/plugins/discourse-ai/discourse/components/thumbnail-suggestion-item","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,u,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static#e=(()=>dt7948.g(this.prototype,"selectedImages",[s.tracked],(function(){return[]})))()
#ve=(()=>{dt7948.i(this,"selectedImages")})()
get isDisabled(){return 0===this.selectedImages.length}addSelection(e){const t=`![${e.original_filename}|${e.width}x${e.height}](${e.short_url})`
this.selectedImages=[...this.selectedImages,t]}static#i=(()=>dt7948.n(this.prototype,"addSelection",[i.action]))()
removeSelection(e){const t=`![${e.original_filename}|${e.width}x${e.height}](${e.short_url})`
this.selectedImages=this.selectedImages.filter((e=>{if(e!==t)return e}))}static#n=(()=>dt7948.n(this.prototype,"removeSelection",[i.action]))()
appendSelectedImages(){const e="\n\n"+this.selectedImages.join("\n"),t=document.querySelector(".d-editor-input")
t.setSelectionRange(t.value.length,t.value.length),t.focus(),document.execCommand("insertText",!1,e),this.args.closeModal()}static#r=(()=>dt7948.n(this.prototype,"appendSelectedImages",[i.action]))()
static#l=(()=>(0,u.setComponentTemplate)((0,d.createTemplateFactory)({id:"rVPkxzzs",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"thumbnail-suggestions-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.ai_helper.thumbnail_suggestions.title"],null],[30,1]]],[["body","footer"],[[[[1,"\\n        "],[10,0],[14,0,"ai-thumbnail-suggestions"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,2]],null]],null],null,[[[1,"            "],[8,[32,2],null,[["@thumbnail","@addSelection","@removeSelection"],[[30,3],[30,0,["addSelection"]],[30,0,["removeSelection"]]]],null],[1,"\\n"]],[3]],null],[1,"        "],[13],[1,"\\n      "]],[]],[[[1,"\\n        "],[8,[32,3],[[24,0,"btn-primary create"]],[["@action","@label","@disabled"],[[30,0,["appendSelectedImages"]],"save",[30,0,["isDisabled"]]]],null],[1,"\\n        "],[8,[32,4],null,[["@close"],[[30,1]]],null],[1,"\\n      "]],[]]]]],[1,"\\n  "]],["@closeModal","@thumbnails","thumbnail"],false,["each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/thumbnail-suggestions.js",scope:()=>[n.default,r.default,l.default,o.default,a.default],isStrictMode:!0}),this))()}e.default=c})),define("discourse/plugins/discourse-ai/discourse/components/model-accuracies",["exports","@ember/component","@ember/component/template-only","@ember/template-factory"],(function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const o=(0,i.createTemplateFactory)({id:"r8usWg+W",block:'[[[41,[30,1],[[[1,"  "],[10,"table"],[14,0,"reviewable-scores"],[12],[1,"\\n    "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[37,2],[[30,1]],null],null,[[[1,"        "],[10,"tr"],[12],[1,"\\n          "],[10,"td"],[14,"colspan","4"],[12],[1,[28,[35,3],["discourse_ai.reviewables.model_used"],null]],[13],[1,"\\n          "],[10,"td"],[14,"colspan","3"],[12],[1,[30,3]],[13],[1,"\\n          "],[10,"td"],[14,"colspan","4"],[12],[1,[28,[35,3],["discourse_ai.reviewables.accuracy"],null]],[13],[1,"\\n          "],[10,"td"],[14,"colspan","3"],[12],[1,[30,2]],[1,"%"],[13],[1,"\\n        "],[13],[1,"\\n"]],[2,3]],null],[1,"    "],[13],[1,"\\n  "],[13],[1,"\\n"]],[]],null]],["@accuracies","acc","model"],false,["if","each","-each-in","i18n"]]',moduleName:"discourse/plugins/discourse-ai/discourse/components/model-accuracies.hbs",isStrictMode:!1})
e.default=(0,t.setComponentTemplate)(o,(0,s.default)())})),define("discourse/plugins/discourse-ai/discourse/components/persona-rag-uploader",["exports","@glimmer/tracking","@ember/component","@ember/helper","@ember/modifier","@ember/object","@ember/service","discourse/components/d-button","discourse/lib/ajax","discourse/mixins/uppy-upload","discourse-common/helpers/d-icon","discourse-common/lib/debounce","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/rag-upload-progress","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,u,d,c,p,m,h){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class g extends(s.default.extend(u.default)){static#e=(()=>dt7948.g(this.prototype,"appEvents",[a.inject]))()
#we=(()=>{dt7948.i(this,"appEvents")})()
static#i=(()=>dt7948.g(this.prototype,"term",[t.tracked],(function(){return null})))()
#xe=(()=>{dt7948.i(this,"term")})()
static#n=(()=>dt7948.g(this.prototype,"filteredUploads",[t.tracked],(function(){return null})))()
#Se=(()=>{dt7948.i(this,"filteredUploads")})()
static#r=(()=>dt7948.g(this.prototype,"ragIndexingStatuses",[t.tracked],(function(){return null})))()
#N=(()=>{dt7948.i(this,"ragIndexingStatuses")})()
static#l=(()=>dt7948.g(this.prototype,"ragUploads",[t.tracked],(function(){return null})))()
#ke=(()=>{dt7948.i(this,"ragUploads")})()
id="discourse-ai-persona-rag-uploader"
maxFiles=20
uploadUrl="/admin/plugins/discourse-ai/ai-personas/files/upload"
preventDirectS3Uploads=!0
didReceiveAttrs(){super.didReceiveAttrs(...arguments),this.inProgressUploads?.length>0&&this._uppyInstance?.cancelAll(),this.ragUploads=this.persona?.rag_uploads||[],this.filteredUploads=this.ragUploads,this.ragUploads?.length&&this.persona?.id&&(0,l.ajax)(`/admin/plugins/discourse-ai/ai-personas/${this.persona.id}/files/status.json`).then((e=>{this.set("ragIndexingStatuses",e)})),this.appEvents.on(`upload-mixin:${this.id}:all-uploads-complete`,this,"_updatePersonaWithUploads")}willDestroy(){super.willDestroy(...arguments),this.appEvents.off(`upload-mixin:${this.id}:all-uploads-complete`,this,"_updatePersonaWithUploads")}_updatePersonaWithUploads(){this.updateUploads(this.ragUploads)}uploadDone(e){const t=e.upload
t.status="uploaded",t.statusText=p.default.t("discourse_ai.ai_persona.uploads.uploaded"),this.ragUploads.pushObject(t),this.debouncedSearch()}submitFiles(){this.fileInputEl.click()}static#g=(()=>dt7948.n(this.prototype,"submitFiles",[n.action]))()
cancelUploading(e){this.appEvents.trigger(`upload-mixin:${this.id}:cancel-upload`,{fileId:e.id})}static#f=(()=>dt7948.n(this.prototype,"cancelUploading",[n.action]))()
search(){this.term?this.filteredUploads=this.ragUploads.filter((e=>e.original_filename.toUpperCase().indexOf(this.term.toUpperCase())>-1)):this.filteredUploads=this.ragUploads}static#y=(()=>dt7948.n(this.prototype,"search",[n.action]))()
debouncedSearch(){(0,c.default)(this,this.search,100)}static#w=(()=>dt7948.n(this.prototype,"debouncedSearch",[n.action]))()
removeUpload(e){this.ragUploads.removeObject(e),this.onRemove(e),this.debouncedSearch()}static#x=(()=>dt7948.n(this.prototype,"removeUpload",[n.action]))()
static#S=(()=>(0,s.setComponentTemplate)((0,h.createTemplateFactory)({id:"EpNZUCWj",block:'[[[1,"\\n    "],[10,0],[14,0,"persona-rag-uploader"],[12],[1,"\\n      "],[10,"h3"],[12],[1,[28,[32,0,["t"]],["discourse_ai.ai_persona.uploads.title"],null]],[13],[1,"\\n      "],[10,2],[12],[1,[28,[32,0,["t"]],["discourse_ai.ai_persona.uploads.description"],null]],[13],[1,"\\n\\n"],[41,[30,0,["ragUploads"]],[[[1,"        "],[10,0],[14,0,"persona-rag-uploader__search-input-container"],[12],[1,"\\n          "],[10,0],[14,0,"persona-rag-uploader__search-input"],[12],[1,"\\n            "],[1,[28,[32,1],["search"],[["class"],["persona-rag-uploader__search-input__search-icon"]]]],[1,"\\n            "],[8,[32,2],[[24,0,"persona-rag-uploader__search-input__input"],[16,"placeholder",[28,[32,0,["t"]],["discourse_ai.ai_persona.uploads.filter"],null]],[4,[32,3],["keyup",[30,0,["debouncedSearch"]]],null]],[["@value"],[[30,0,["term"]]]],null],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"\\n      "],[10,"table"],[14,0,"persona-rag-uploader__uploads-list"],[12],[1,"\\n        "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["filteredUploads"]]],null]],null],null,[[[1,"            "],[10,"tr"],[12],[1,"\\n              "],[10,"td"],[12],[1,"\\n                "],[10,1],[14,0,"persona-rag-uploader__rag-file-icon"],[12],[1,[28,[32,1],["file"],null]],[13],[1,"\\n                "],[1,[30,1,["original_filename"]]],[1,"\\n              "],[13],[1,"\\n              "],[8,[32,4],null,[["@upload","@ragIndexingStatuses"],[[30,1],[30,0,["ragIndexingStatuses"]]]],null],[1,"\\n              "],[10,"td"],[14,0,"persona-rag-uploader__remove-file"],[12],[1,"\\n                "],[8,[32,5],null,[["@icon","@title","@action","@class"],["times","discourse_ai.ai_persona.uploads.remove",[28,[32,6],[[30,0,["removeUpload"]],[30,1]],null],"btn-flat"]],null],[1,"\\n              "],[13],[1,"\\n            "],[13],[1,"\\n"]],[1]],null],[42,[28,[31,2],[[28,[31,2],[[30,0,["inProgressUploads"]]],null]],null],null,[[[1,"            "],[10,"tr"],[12],[1,"\\n              "],[10,"td"],[12],[10,1],[14,0,"persona-rag-uploader__rag-file-icon"],[12],[1,[28,[32,1],["file"],null]],[13],[1,"\\n                "],[1,[30,2,["original_filename"]]],[13],[1,"\\n              "],[10,"td"],[14,0,"persona-rag-uploader__upload-status"],[12],[1,"\\n                "],[10,0],[14,0,"spinner small"],[12],[13],[1,"\\n                "],[10,1],[12],[1,[28,[32,0,["t"]],["discourse_ai.ai_persona.uploads.uploading"],null]],[1,"\\n                  "],[1,[30,2,["uploadProgress"]]],[1,"%"],[13],[1,"\\n              "],[13],[1,"\\n              "],[10,"td"],[14,0,"persona-rag-uploader__remove-file"],[12],[1,"\\n                "],[8,[32,5],null,[["@icon","@title","@action","@class"],["times","discourse_ai.ai_persona.uploads.remove",[28,[32,6],[[30,0,["cancelUploading"]],[30,2]],null],"btn-flat"]],null],[1,"\\n              "],[13],[1,"\\n            "],[13],[1,"\\n"]],[2]],null],[1,"        "],[13],[1,"\\n      "],[13],[1,"\\n\\n      "],[10,"input"],[14,0,"hidden-upload-field"],[15,"disabled",[30,0,["uploading"]]],[14,"multiple","multiple"],[14,"accept",".txt,.md"],[14,4,"file"],[12],[13],[1,"\\n      "],[8,[32,5],[[24,0,"btn-default"]],[["@label","@icon","@title","@action"],["discourse_ai.ai_persona.uploads.button","plus","discourse_ai.ai_persona.uploads.button",[30,0,["submitFiles"]]]],null],[1,"\\n    "],[13],[1,"\\n  "]],["upload","upload"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/persona-rag-uploader.js",scope:()=>[p.default,d.default,s.Input,o.on,m.default,r.default,i.fn],isStrictMode:!0}),this))()}e.default=g})),define("discourse/plugins/discourse-ai/discourse/components/rag-upload-progress",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/service","discourse-common/helpers/d-icon","discourse-common/utils/decorators","discourse-i18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,u,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static#e=(()=>dt7948.g(this.prototype,"messageBus",[n.inject]))()
#Te=(()=>{dt7948.i(this,"messageBus")})()
static#i=(()=>dt7948.g(this.prototype,"updatedProgress",[s.tracked],(function(){return null})))()
#Pe=(()=>{dt7948.i(this,"updatedProgress")})()
willDestroy(){super.willDestroy(...arguments),this.messageBus.unsubscribe(`/discourse-ai/ai-persona-rag/${this.args.upload.id}`)}trackProgress(){this.messageBus.subscribe(`/discourse-ai/ai-persona-rag/${this.args.upload.id}`,this.onIndexingUpdate)}static#n=(()=>dt7948.n(this.prototype,"trackProgress",[i.action]))()
onIndexingUpdate(e){(!this.updatedProgress||0===e.total||this.updatedProgress.left>e.left)&&(this.updatedProgress=e)}static#r=(()=>dt7948.n(this.prototype,"onIndexingUpdate",[r.bind]))()
get calculateProgress(){return 0===this.progress.total?0:Math.ceil(100*this.progress.indexed/this.progress.total)}get fullyIndexed(){return this.progress&&0!==this.progress.total&&0===this.progress.left}get progress(){return this.updatedProgress?this.updatedProgress:this.args.ragIndexingStatuses?this.args.ragIndexingStatuses[this.args.upload.id]:[]}static#l=(()=>(0,u.setComponentTemplate)((0,d.createTemplateFactory)({id:"otL3+nu2",block:'[[[1,"\\n    "],[11,"td"],[24,0,"persona-rag-uploader__upload-status"],[4,[32,0],[[30,0,["trackProgress"]]],null],[12],[1,"\\n"],[41,[30,0,["progress"]],[[[41,[30,0,["fullyIndexed"]],[[[1,"          "],[10,1],[14,0,"indexed"],[12],[1,"\\n            "],[1,[28,[32,1],["check"],null]],[1,"\\n            "],[1,[28,[32,2,["t"]],["discourse_ai.ai_persona.uploads.indexed"],null]],[1,"\\n          "],[13],[1,"\\n"]],[]],[[[1,"          "],[10,1],[14,0,"indexing"],[12],[1,"\\n            "],[1,[28,[32,1],["robot"],null]],[1,"\\n            "],[1,[28,[32,2,["t"]],["discourse_ai.ai_persona.uploads.indexing"],null]],[1,"\\n            "],[1,[30,0,["calculateProgress"]]],[1,"%\\n          "],[13],[1,"\\n"]],[]]]],[]],[[[1,"        "],[10,1],[14,0,"uploaded"],[12],[1,[28,[32,2,["t"]],["discourse_ai.ai_persona.uploads.uploaded"],null]],[13],[1,"\\n"]],[]]],[1,"    "],[13],[1,"\\n  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/rag-upload-progress.js",scope:()=>[o.default,a.default,l.default],isStrictMode:!0}),this))()}e.default=c})),define("discourse/plugins/discourse-ai/discourse/components/reviewable-ai-chat-message",["exports","@ember/component","@glimmer/component","discourse/plugins/chat/discourse/models/chat-channel","@ember/template-factory"],(function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const n=(0,o.createTemplateFactory)({id:"yKOx21Wk",block:'[[[41,[30,0,["chatChannel"]],[[[1,"  "],[10,0],[14,0,"flagged-post-header"],[12],[1,"\\n    "],[8,[39,1],null,[["@route","@models"],["chat.channel.near-message",[28,[37,2],[[30,0,["chatChannel","slugifiedTitle"]],[30,0,["chatChannel","id"]],[30,1,["target_id"]]],null]]],[["default"],[[[[1,"\\n      "],[8,[39,3],null,[["@channel"],[[30,0,["chatChannel"]]]],null],[1,"\\n    "]],[]]]]],[1,"\\n  "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[10,0],[14,0,"post-contents-wrapper"],[12],[1,"\\n  "],[8,[39,4],null,[["@user","@tagName"],[[30,1,["target_created_by"]],""]],null],[1,"\\n  "],[10,0],[14,0,"post-contents"],[12],[1,"\\n    "],[8,[39,5],null,[["@reviewable","@createdBy","@tagName"],[[30,1],[30,1,["target_created_by"]],""]],null],[1,"\\n\\n    "],[10,0],[14,0,"post-body"],[12],[1,"\\n      "],[1,[28,[35,6],[[28,[37,7],[[30,1,["payload","message_cooked"]],[30,1,["cooked"]]],null]],null]],[1,"\\n    "],[13],[1,"\\n\\n    "],[18,2,null],[1,"\\n\\n    "],[8,[39,9],null,[["@accuracies"],[[30,1,["payload","accuracies"]]]],null],[1,"\\n  "],[13],[1,"\\n"],[13]],["@reviewable","&default"],false,["if","link-to","array","chat-channel-title","reviewable-created-by","reviewable-post-header","html-safe","or","yield","model-accuracies"]]',moduleName:"discourse/plugins/discourse-ai/discourse/components/reviewable-ai-chat-message.hbs",isStrictMode:!1})
class a extends s.default{get chatChannel(){if(this.args.reviewable.chat_channel)return i.default.create(this.args.reviewable.chat_channel)}}e.default=a,(0,t.setComponentTemplate)(n,a)})),define("discourse/plugins/discourse-ai/discourse/components/reviewable-ai-post",["exports","@ember/component","@ember/component/template-only","@ember/template-factory"],(function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const o=(0,i.createTemplateFactory)({id:"XJ3JIp4P",block:'[[[10,0],[14,0,"flagged-post-header"],[12],[1,"\\n  "],[8,[39,0],null,[["@reviewable","@tagName"],[[30,1],""]],null],[1,"\\n  "],[8,[39,1],null,[["@reviewable","@tagName"],[[30,1],""]],null],[1,"\\n"],[13],[1,"\\n\\n"],[10,0],[14,0,"post-contents-wrapper"],[12],[1,"\\n  "],[8,[39,2],null,[["@user","@tagName"],[[30,1,["target_created_by"]],""]],null],[1,"\\n  "],[10,0],[14,0,"post-contents"],[12],[1,"\\n    "],[8,[39,3],null,[["@reviewable","@createdBy","@tagName"],[[30,1],[30,1,["target_created_by"]],""]],null],[1,"\\n    "],[10,0],[14,0,"post-body"],[12],[1,"\\n"],[41,[30,1,["blank_post"]],[[[1,"        "],[10,2],[12],[1,[28,[35,5],["review.deleted_post"],null]],[13],[1,"\\n"]],[]],[[[1,"        "],[1,[28,[35,6],[[30,1,["cooked"]]],null]],[1,"\\n"]],[]]],[1,"    "],[13],[1,"\\n\\n    "],[18,2,null],[1,"\\n\\n    "],[8,[39,8],null,[["@accuracies"],[[30,1,["payload","accuracies"]]]],null],[1,"\\n  "],[13],[1,"\\n"],[13]],["@reviewable","&default"],false,["reviewable-topic-link","reviewable-post-edits","reviewable-created-by","reviewable-post-header","if","i18n","html-safe","yield","model-accuracies"]]',moduleName:"discourse/plugins/discourse-ai/discourse/components/reviewable-ai-post.hbs",isStrictMode:!1})
e.default=(0,t.setComponentTemplate)(o,(0,s.default)())})),define("discourse/plugins/discourse-ai/discourse/components/thumbnail-suggestion-item",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","discourse/components/d-button","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends t.default{static#e=(()=>dt7948.g(this.prototype,"selected",[s.tracked],(function(){return!1})))()
#Me=(()=>{dt7948.i(this,"selected")})()
static#i=(()=>dt7948.g(this.prototype,"selectIcon",[s.tracked],(function(){return"far-circle"})))()
#je=(()=>{dt7948.i(this,"selectIcon")})()
static#n=(()=>dt7948.g(this.prototype,"selectLabel",[s.tracked],(function(){return"discourse_ai.ai_helper.thumbnail_suggestions.select"})))()
#Ce=(()=>{dt7948.i(this,"selectLabel")})()
toggleSelection(e){return this.selected?(this.selectIcon="far-circle",this.selectLabel="discourse_ai.ai_helper.thumbnail_suggestions.select",this.selected=!1,this.args.removeSelection(e)):(this.selectIcon="check-circle",this.selectLabel="discourse_ai.ai_helper.thumbnail_suggestions.selected",this.selected=!0,this.args.addSelection(e))}static#r=(()=>dt7948.n(this.prototype,"toggleSelection",[o.action]))()
static#l=(()=>(0,a.setComponentTemplate)((0,r.createTemplateFactory)({id:"BsBgpDKw",block:'[[[1,"\\n    "],[10,0],[14,0,"ai-thumbnail-suggestions__item"],[12],[1,"\\n      "],[8,[32,0],[[16,0,[52,[30,0,["selected"]],"btn-primary"]]],[["@icon","@label","@action"],[[30,0,["selectIcon"]],[30,0,["selectLabel"]],[28,[32,1],[[30,0,["toggleSelection"]],[30,1]],null]]],null],[1,"\\n      "],[10,"img"],[15,"src",[30,1,["url"]]],[14,"loading","lazy"],[15,"width",[30,1,["thumbnail_width"]]],[15,"height",[30,1,["thumbnail_height"]]],[12],[13],[1,"\\n    "],[13],[1,"\\n  "]],["@thumbnail"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/thumbnail-suggestion-item.js",scope:()=>[n.default,i.fn],isStrictMode:!0}),this))()}e.default=l})),define("discourse/plugins/discourse-ai/discourse/connectors/admin-dashboard-tabs-after/admin-sentiment-dashbboard",["exports","@glimmer/component","@ember/routing","discourse-common/helpers/i18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,t){return t.siteSettings.ai_sentiment_enabled}static#e=(()=>(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"aCrw9598",block:'[[[1,"\\n    "],[10,"li"],[14,0,"navigation-item sentiment"],[12],[1,"\\n      "],[8,[32,0],[[24,0,"navigation-link"]],[["@route"],["admin.dashboardSentiment"]],[["default"],[[[[1,"\\n        "],[1,[28,[32,1],["discourse_ai.sentiments.dashboard.title"],null]],[1,"\\n      "]],[]]]]],[1,"\\n    "],[13],[1,"\\n  "]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/admin-dashboard-tabs-after/admin-sentiment-dashbboard.js",scope:()=>[s.LinkTo,i.default],isStrictMode:!0}),this))()}e.default=a})),define("discourse/plugins/discourse-ai/discourse/connectors/after-composer-category-input/ai-category-suggestion",["exports","@glimmer/component","@ember/service","discourse/plugins/discourse-ai/discourse/components/ai-suggestion-dropdown","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static shouldRender(e,t){return(0,o.showComposerAIHelper)(e,t,"suggestions")}static#e=(()=>dt7948.g(this.prototype,"siteSettings",[s.inject]))()
#o=(()=>{dt7948.i(this,"siteSettings")})()
static#i=(()=>(0,n.setComponentTemplate)((0,a.createTemplateFactory)({id:"tgy79Whv",block:'[[[1,"\\n"],[41,[30,0,["siteSettings","ai_embeddings_enabled"]],[[[1,"      "],[8,[32,0],[[24,0,"suggest-category-button"]],[["@mode","@composer"],["suggest_category",[30,1,["composer"]]]],null],[1,"\\n"]],[]],null],[1,"  "]],["@outletArgs"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/after-composer-category-input/ai-category-suggestion.js",scope:()=>[i.default],isStrictMode:!0}),this))()}e.default=r})),define("discourse/plugins/discourse-ai/discourse/connectors/after-composer-tag-input/ai-tag-suggestion",["exports","@glimmer/component","@ember/service","discourse/plugins/discourse-ai/discourse/components/ai-suggestion-dropdown","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static shouldRender(e,t){return(0,o.showComposerAIHelper)(e,t,"suggestions")}static#e=(()=>dt7948.g(this.prototype,"siteSettings",[s.inject]))()
#o=(()=>{dt7948.i(this,"siteSettings")})()
static#i=(()=>(0,n.setComponentTemplate)((0,a.createTemplateFactory)({id:"qB6wq01S",block:'[[[1,"\\n"],[41,[30,0,["siteSettings","ai_embeddings_enabled"]],[[[1,"      "],[8,[32,0],[[24,0,"suggest-tags-button"]],[["@mode","@composer"],["suggest_tags",[30,1,["composer"]]]],null],[1,"\\n"]],[]],null],[1,"  "]],["@outletArgs"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/after-composer-tag-input/ai-tag-suggestion.js",scope:()=>[i.default],isStrictMode:!0}),this))()}e.default=r})),define("discourse/plugins/discourse-ai/discourse/connectors/after-composer-title-input/ai-title-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/ai-suggestion-dropdown","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,t){return(0,i.showComposerAIHelper)(e,t,"suggestions")}static#e=(()=>(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"4En7i5/x",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"suggest-titles-button"]],[["@mode","@composer"],["suggest_title",[30,1,["composer"]]]],null],[1,"\\n  "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/after-composer-title-input/ai-title-suggestion.js",scope:()=>[s.default],isStrictMode:!0}),this))()}e.default=a})),define("discourse/plugins/discourse-ai/discourse/connectors/after-d-editor/ai-helper-context-menu",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/service","@popperjs/core","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/utilities","discourse-common/config/environment","discourse-common/utils/decorators","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper"],(function(e,t,s,i,o,n,a,r,l,u,d,c){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class p extends t.default{static shouldRender(e,t){return(0,c.showComposerAIHelper)(e,t,"context_menu")}static#e=(()=>dt7948.g(this.prototype,"currentUser",[o.inject]))()
#s=(()=>{dt7948.i(this,"currentUser")})()
static#i=(()=>dt7948.g(this.prototype,"siteSettings",[o.inject]))()
#o=(()=>{dt7948.i(this,"siteSettings")})()
static#n=(()=>dt7948.g(this.prototype,"modal",[o.inject]))()
#ue=(()=>{dt7948.i(this,"modal")})()
static#r=(()=>dt7948.g(this.prototype,"capabilities",[o.inject]))()
#Ee=(()=>{dt7948.i(this,"capabilities")})()
static#l=(()=>dt7948.g(this.prototype,"showContextMenu",[s.tracked],(function(){return!1})))()
#Ae=(()=>{dt7948.i(this,"showContextMenu")})()
static#g=(()=>dt7948.g(this.prototype,"caretCoords",[s.tracked]))()
#Ie=(()=>{dt7948.i(this,"caretCoords")})()
static#f=(()=>dt7948.g(this.prototype,"virtualElement",[s.tracked]))()
#Oe=(()=>{dt7948.i(this,"virtualElement")})()
static#y=(()=>dt7948.g(this.prototype,"selectedText",[s.tracked],(function(){return""})))()
#Re=(()=>{dt7948.i(this,"selectedText")})()
static#w=(()=>dt7948.g(this.prototype,"newSelectedText",[s.tracked]))()
#Ne=(()=>{dt7948.i(this,"newSelectedText")})()
static#x=(()=>dt7948.g(this.prototype,"loading",[s.tracked],(function(){return!1})))()
#Q=(()=>{dt7948.i(this,"loading")})()
static#S=(()=>dt7948.g(this.prototype,"lastUsedOption",[s.tracked],(function(){return null})))()
#Ue=(()=>{dt7948.i(this,"lastUsedOption")})()
static#k=(()=>dt7948.g(this.prototype,"showDiffModal",[s.tracked],(function(){return!1})))()
#qe=(()=>{dt7948.i(this,"showDiffModal")})()
static#T=(()=>dt7948.g(this.prototype,"showThumbnailModal",[s.tracked],(function(){return!1})))()
#Le=(()=>{dt7948.i(this,"showThumbnailModal")})()
static#P=(()=>dt7948.g(this.prototype,"diff",[s.tracked]))()
#Fe=(()=>{dt7948.i(this,"diff")})()
static#M=(()=>dt7948.g(this.prototype,"popperPlacement",[s.tracked],(function(){return"top-start"})))()
#Be=(()=>{dt7948.i(this,"popperPlacement")})()
static#j=(()=>dt7948.g(this.prototype,"previousMenuState",[s.tracked],(function(){return null})))()
#Ve=(()=>{dt7948.i(this,"previousMenuState")})()
static#L=(()=>dt7948.g(this.prototype,"customPromptValue",[s.tracked],(function(){return""})))()
#De=(()=>{dt7948.i(this,"customPromptValue")})()
static#F=(()=>dt7948.g(this.prototype,"initialValue",[s.tracked],(function(){return""})))()
#Ge=(()=>{dt7948.i(this,"initialValue")})()
static#B=(()=>dt7948.g(this.prototype,"thumbnailSuggestions",[s.tracked],(function(){return null})))()
#He=(()=>{dt7948.i(this,"thumbnailSuggestions")})()
static#V=(()=>dt7948.g(this.prototype,"selectionRange",[s.tracked],(function(){return{x:0,y:0}})))()
#$e=(()=>{dt7948.i(this,"selectionRange")})()
static#D=(()=>dt7948.g(this.prototype,"lastSelectionRange",[s.tracked],(function(){return null})))()
#ze=(()=>{dt7948.i(this,"lastSelectionRange")})()
CONTEXT_MENU_STATES={triggers:"TRIGGERS",options:"OPTIONS",resets:"RESETS",loading:"LOADING",review:"REVIEW"}
prompts=[]
promptTypes={}
minSelectionChars=3
static#G=(()=>dt7948.g(this.prototype,"_menuState",[s.tracked],(function(){return this.CONTEXT_MENU_STATES.triggers})))()
#Ke=(()=>{dt7948.i(this,"_menuState")})()
static#H=(()=>dt7948.g(this.prototype,"_popper",[s.tracked]))()
#We=(()=>{dt7948.i(this,"_popper")})()
static#$=(()=>dt7948.g(this.prototype,"_dEditorInput",[s.tracked]))()
#Xe=(()=>{dt7948.i(this,"_dEditorInput")})()
static#z=(()=>dt7948.g(this.prototype,"_customPromptInput",[s.tracked]))()
#u=(()=>{dt7948.i(this,"_customPromptInput")})()
static#K=(()=>dt7948.g(this.prototype,"_contextMenu",[s.tracked]))()
#Ye=(()=>{dt7948.i(this,"_contextMenu")})()
static#Je=(()=>dt7948.g(this.prototype,"_activeAIRequest",[s.tracked],(function(){return null})))()
#Qe=(()=>{dt7948.i(this,"_activeAIRequest")})()
willDestroy(){super.willDestroy(...arguments),document.removeEventListener("selectionchange",this.selectionChanged),document.removeEventListener("keydown",this.onKeyDown),this._popper?.destroy()}get menuState(){return this._menuState}set menuState(e){this.previousMenuState=this._menuState,this._menuState=e}get helperOptions(){let e=this.currentUser?.ai_helper_prompts
e=e.filter((e=>e.location.includes("composer"))).filter((e=>"generate_titles"!==e.name))
const t=e.findIndex((e=>"custom_prompt"===e.name))
if(-1!==t){const s=e.splice(t,1)[0]
e.unshift(s)}return this._showUserCustomPrompts()||(e=e.filter((e=>"custom_prompt"!==e.name))),e.forEach((e=>{this.prompts[e.id]=e})),this.promptTypes=e.reduce(((e,t)=>(e[t.name]=t.prompt_type,e)),{}),e}selectionChanged(){if(document.activeElement!==this._dEditorInput)return
const e=Boolean(window.getSelection()&&document.activeElement&&document.activeElement.value)
this.selectedText=e?document.activeElement.value.substring(document.activeElement.selectionStart,document.activeElement.selectionEnd):"",this.selectionRange=e?{x:document.activeElement.selectionStart,y:document.activeElement.selectionEnd}:{x:0,y:0},0!==this.selectedText?.length?this.selectedText?.length<this.minSelectionChars||this._onSelectionChanged():this.closeContextMenu()}static#Ze=(()=>dt7948.n(this.prototype,"selectionChanged",[d.bind]))()
updatePosition(){this.showContextMenu&&this.positionContextMenu()}static#et=(()=>dt7948.n(this.prototype,"updatePosition",[d.bind]))()
onKeyDown(e){return"Escape"===e.key||"Backspace"===e.key&&this.selectedText&&this.menuState===this.CONTEXT_MENU_STATES.triggers?this.closeContextMenu():void 0}static#tt=(()=>dt7948.n(this.prototype,"onKeyDown",[d.bind]))()
_onSelectionChanged(){this.positionContextMenu(),this.showContextMenu=!0}static#st=(()=>dt7948.n(this.prototype,"_onSelectionChanged",[(0,d.debounce)(u.INPUT_DELAY)]))()
generateGetBoundingClientRect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0
return()=>({width:e,height:t,top:i,right:s,bottom:i,left:s})}get canCloseContextMenu(){return document.activeElement!==this._customPromptInput&&((!this.loading||null===this._activeAIRequest)&&this.menuState!==this.CONTEXT_MENU_STATES.review)}closeContextMenu(){this.canCloseContextMenu&&(this.showContextMenu=!1,this.menuState=this.CONTEXT_MENU_STATES.triggers,this.customPromptValue="")}_updateSuggestedByAI(e){this.newSelectedText=e.suggestions[0],e.diff&&(this.diff=e.diff),this._insertAt(this.selectionRange.x,this.selectionRange.y,this.newSelectedText),this.menuState=this.CONTEXT_MENU_STATES.review}_insertAt(e,t,s){this._dEditorInput.setSelectionRange(e,t),this._dEditorInput.focus(),document.execCommand("insertText",!1,s)}_toggleLoadingState(e){return e?(this._dEditorInput.classList.add("loading"),this.loading=!0):(this._dEditorInput.classList.remove("loading"),this.loading=!1)}_showUserCustomPrompts(){return this.currentUser?.can_use_custom_prompts}handleBoundaries(){const e=document.querySelector(".d-editor-textarea-wrapper").getBoundingClientRect(),t=document.querySelector(".d-editor-button-bar").getBoundingClientRect().bottom,s=e.bottom,i=this._contextMenu.getBoundingClientRect()
i.top<t||i.bottom>s?this._contextMenu.classList.add("out-of-bounds"):this._contextMenu.classList.remove("out-of-bounds"),this.caretCoords.y-i.height<t?this.popperPlacement="bottom-start":this.popperPlacement="top-start"}positionContextMenu(){this._contextMenu=document.querySelector(".ai-helper-context-menu"),this._dEditorInput&&this._contextMenu&&(this.caretCoords=(0,l.getCaretPosition)(this._dEditorInput,{pos:(0,l.caretPosition)(this._dEditorInput)}),this.handleBoundaries(),this.virtualElement={getBoundingClientRect:this.generateGetBoundingClientRect(this._contextMenu.clientWidth,this._contextMenu.clientHeight,this.caretCoords.x,this.caretCoords.y)},this._popper=(0,n.createPopper)(this.virtualElement,this._contextMenu,{placement:this.popperPlacement,modifiers:[{name:"offset",options:{offset:[10,0]}}]}))}static#it=(()=>dt7948.n(this.prototype,"positionContextMenu",[d.afterRender]))()
setupContextMenu(){document.addEventListener("selectionchange",this.selectionChanged),document.addEventListener("keydown",this.onKeyDown),this._dEditorInput=document.querySelector(".d-editor-input"),this._dEditorInput&&this._dEditorInput.addEventListener("scroll",this.updatePosition)}static#ot=(()=>dt7948.n(this.prototype,"setupContextMenu",[i.action]))()
setupCustomPrompt(){this._customPromptInput=document.querySelector(".ai-custom-prompt__input"),this._customPromptInput.focus()}static#nt=(()=>dt7948.n(this.prototype,"setupCustomPrompt",[i.action]))()
toggleAiHelperOptions(){this.menuState=this.CONTEXT_MENU_STATES.options}static#at=(()=>dt7948.n(this.prototype,"toggleAiHelperOptions",[i.action]))()
undoAIAction(){if(this.capabilities.isFirefox){const e=this.selectedText.length-this.initialValue.length,t=this.lastSelectionRange.y-e
this._insertAt(this.lastSelectionRange.x,t,this.initialValue)}else document.execCommand("undo",!1,null)
this.menuState=this.CONTEXT_MENU_STATES.resets,this.closeContextMenu()}static#rt=(()=>dt7948.n(this.prototype,"undoAIAction",[i.action]))()
async updateSelected(e){return this._toggleLoadingState(!0),this.lastUsedOption=e,this.menuState=this.CONTEXT_MENU_STATES.loading,this.initialValue=this.selectedText,this.lastSelectionRange=this.selectionRange,this._activeAIRequest=(0,a.ajax)("/discourse-ai/ai-helper/suggest",{method:"POST",data:{mode:e.id,text:this.selectedText,custom_prompt:this.customPromptValue}}),this._activeAIRequest.then((t=>{this.diff=null,this.newSelectedText=null,this.thumbnailSuggestions=null,"illustrate_post"===e.name?(this._toggleLoadingState(!1),this.closeContextMenu(),this.showThumbnailModal=!0,this.thumbnailSuggestions=t.thumbnails):this._updateSuggestedByAI(t)})).catch(r.popupAjaxError).finally((()=>{this._toggleLoadingState(!1)})),this._activeAIRequest}static#lt=(()=>dt7948.n(this.prototype,"updateSelected",[i.action]))()
viewChanges(){this.showDiffModal=!0}static#ut=(()=>dt7948.n(this.prototype,"viewChanges",[i.action]))()
confirmChanges(){this.menuState=this.CONTEXT_MENU_STATES.resets}static#dt=(()=>dt7948.n(this.prototype,"confirmChanges",[i.action]))()
cancelAIAction(){this._activeAIRequest&&(this._activeAIRequest.abort(),this._activeAIRequest=null,this._toggleLoadingState(!1),this.closeContextMenu())}static#ct=(()=>dt7948.n(this.prototype,"cancelAIAction",[i.action]))()
togglePreviousMenu(){this.menuState=this.previousMenuState}static#pt=(()=>dt7948.n(this.prototype,"togglePreviousMenu",[i.action]))()}e.default=p})),define("discourse/plugins/discourse-ai/discourse/connectors/after-d-editor/composer-open",["exports","@glimmer/component","@ember/object","@ember/service","discourse-i18n"],(function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends t.default{static#e=(()=>dt7948.g(this.prototype,"currentUser",[i.inject]))()
#s=(()=>{dt7948.i(this,"currentUser")})()
static#i=(()=>dt7948.g(this.prototype,"siteSettings",[i.inject]))()
#o=(()=>{dt7948.i(this,"siteSettings")})()
get composerModel(){return this.args?.outletArgs?.composer}get renderChatWarning(){return this.siteSettings.ai_bot_enable_chat_warning}get aiBotClasses(){return this.composerModel?.title===o.default.t("discourse_ai.ai_bot.default_pm_prefix")?"ai-bot-chat":"ai-bot-pm"}static#n=(()=>dt7948.n(this.prototype,"aiBotClasses",[(0,s.computed)("composerModel.targetRecipients","composerModel.title")]))()
get isAiBotChat(){if(this.composerModel&&this.composerModel.targetRecipients&&this.currentUser.ai_enabled_chat_bots){let e=this.composerModel.targetRecipients.split(",")
return this.currentUser.ai_enabled_chat_bots.any((t=>e.any((e=>e===t.username))))}return!1}static#r=(()=>dt7948.n(this.prototype,"isAiBotChat",[(0,s.computed)("composerModel.targetRecipients")]))()}e.default=n})),define("discourse/plugins/discourse-ai/discourse/connectors/after-search-result-entry/search-result-decoration",["exports","discourse-common/helpers/d-icon","discourse-common/helpers/i18n","@ember/component","@ember/template-factory","@ember/component/template-only"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const a=(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"+zzrKPCx",block:'[[[1,"\\n  "],[10,0],[14,0,"ai-result__icon"],[15,"title",[28,[32,0],["discourse_ai.embeddings.ai_generated_result"],null]],[12],[1,"\\n    "],[1,[28,[32,1],["discourse-sparkles"],null]],[1,"\\n  "],[13],[1,"\\n"]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/after-search-result-entry/search-result-decoration.js",scope:()=>[s.default,t.default],isStrictMode:!0}),(0,n.default)())
e.default=a})),define("discourse/plugins/discourse-ai/discourse/connectors/composer-after-save-or-cancel/ai-image-caption-loader",["exports","@glimmer/component","@ember/service","discourse/helpers/loading-spinner","discourse-common/helpers/i18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static#e=(()=>dt7948.g(this.prototype,"imageCaptionPopup",[s.service]))()
#mt=(()=>{dt7948.i(this,"imageCaptionPopup")})()
static#i=(()=>(0,n.setComponentTemplate)((0,a.createTemplateFactory)({id:"/15Zu2iM",block:'[[[1,"\\n"],[41,[30,0,["imageCaptionPopup","showAutoCaptionLoader"]],[[[1,"      "],[10,0],[14,0,"auto-image-caption-loader"],[12],[1,"\\n        "],[1,[28,[32,0],null,[["size"],["small"]]]],[1,"\\n        "],[10,1],[12],[1,[28,[32,1],["discourse_ai.ai_helper.image_caption.automatic_caption_loading"],null]],[13],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/composer-after-save-or-cancel/ai-image-caption-loader.js",scope:()=>[i.default,o.default],isStrictMode:!0}),this))()}e.default=r})),define("discourse/plugins/discourse-ai/discourse/connectors/composer-fields/persona-llm-selector",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/runloop","@ember/service","discourse/lib/key-value-store","select-kit/components/dropdown-select-box","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class d extends t.default{static shouldRender(e,t){return t?.currentUser?.ai_enabled_personas&&function(e,t){if(e&&e.targetRecipients&&t.ai_enabled_chat_bots){const s=e.targetRecipients.split(",")
return t.ai_enabled_chat_bots.filter((e=>!e.is_persona)).any((e=>s.any((t=>t===e.username))))}return!1}(e.model,t.currentUser)}static#e=(()=>dt7948.g(this.prototype,"currentUser",[n.inject]))()
#s=(()=>{dt7948.i(this,"currentUser")})()
static#i=(()=>dt7948.g(this.prototype,"siteSettings",[n.inject]))()
#o=(()=>{dt7948.i(this,"siteSettings")})()
static#n=(()=>dt7948.g(this.prototype,"llm",[s.tracked]))()
#ht=(()=>{dt7948.i(this,"llm")})()
STORE_NAMESPACE="discourse_ai_persona_selector_"
LLM_STORE_NAMESPACE="discourse_ai_llm_selector_"
preferredPersonaStore=(()=>new a.default(this.STORE_NAMESPACE))()
preferredLlmStore=(()=>new a.default(this.LLM_STORE_NAMESPACE))()
constructor(){if(super(...arguments),this.botOptions&&this.composer){let e=this.preferredPersonaStore.getObject("id")
this._value=this.botOptions[0].id,e&&(e=parseInt(e,10),this.botOptions.any((t=>t.id===e))&&(this._value=e)),this.composer.metaData={ai_persona_id:this._value}
let t=this.preferredLlmStore.getObject("id")
t=t||this.llmOptions[0].id,t&&(0,o.next)((()=>{this.currentLlm=t}))}}get composer(){return this.args?.outletArgs?.model}get botOptions(){if(this.currentUser.ai_enabled_personas)return this.currentUser.ai_enabled_personas.map((e=>({id:e.id,name:e.name,description:e.description})))}get filterable(){return this.botOptions.length>4}get value(){return this._value}set value(e){this._value=e,this.preferredPersonaStore.setObject({key:"id",value:e}),this.composer.metaData={ai_persona_id:e}}get currentLlm(){return this.llm}set currentLlm(e){this.llm=e
const t=this.currentUser.ai_enabled_chat_bots.find((e=>e.model_name===this.llm)).username
this.preferredLlmStore.setObject({key:"id",value:e}),this.composer.set("targetRecipients",t)}get llmOptions(){return this.currentUser.ai_enabled_chat_bots.filter((e=>!e.is_persona)).filter(Boolean).map((e=>({id:e.model_name,name:e.display_name})))}static#r=(()=>(0,l.setComponentTemplate)((0,u.createTemplateFactory)({id:"d7DsFQBO",block:'[[[1,"\\n    "],[10,0],[14,0,"persona-llm-selector"],[12],[1,"\\n      "],[10,0],[14,0,"gpt-persona"],[12],[1,"\\n        "],[8,[32,0],[[24,0,"persona-llm-selector__persona-dropdown"]],[["@value","@content","@options"],[[30,0,["value"]],[30,0,["botOptions"]],[28,[32,1],null,[["icon","filterable"],["robot",[30,0,["filterable"]]]]]]],null],[1,"\\n      "],[13],[1,"\\n      "],[10,0],[14,0,"llm-selector"],[12],[1,"\\n        "],[8,[32,0],[[24,0,"persona-llm-selector__llm-dropdown"]],[["@value","@content","@options"],[[30,0,["currentLlm"]],[30,0,["llmOptions"]],[28,[32,1],null,[["icon"],["globe"]]]]],null],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n  "]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/composer-fields/persona-llm-selector.js",scope:()=>[r.default,i.hash],isStrictMode:!0}),this))()}e.default=d})),define("discourse/plugins/discourse-ai/discourse/connectors/editor-preview/ai-image-caption-container",["exports","@glimmer/component","@ember/modifier","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/did-update","@ember/render-modifiers/modifiers/will-destroy","@ember/service","discourse/components/conditional-loading-spinner","discourse/components/d-button","discourse/components/d-textarea","discourse/modifiers/auto-focus","discourse-common/helpers/d-icon","discourse-common/helpers/i18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,u,d,c,p,m,h,g){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class _ extends t.default{static#e=(()=>dt7948.g(this.prototype,"imageCaptionPopup",[r.inject]))()
#mt=(()=>{dt7948.i(this,"imageCaptionPopup")})()
updateCaption(e){e.preventDefault(),this.imageCaptionPopup.newCaption=e.target.value}static#i=(()=>dt7948.n(this.prototype,"updateCaption",[i.action]))()
saveCaption(){this.imageCaptionPopup.updateCaption(),this.hidePopup()}static#n=(()=>dt7948.n(this.prototype,"saveCaption",[i.action]))()
resizeTextarea(e){const t=window.getComputedStyle(e),s=parseInt(t.borderTopWidth,10),i=parseInt(t.borderBottomWidth,10)
e.scrollTop=0,e.style.height=`${e.scrollHeight+s+i}px`}static#r=(()=>dt7948.n(this.prototype,"resizeTextarea",[i.action]))()
hidePopup(){this.imageCaptionPopup.showPopup=!1,this.imageCaptionPopup._request&&(this.imageCaptionPopup._request.abort(),this.imageCaptionPopup._request=null,this.imageCaptionPopup.toggleLoadingState(!1))}static#l=(()=>dt7948.n(this.prototype,"hidePopup",[i.action]))()
static#g=(()=>(0,h.setComponentTemplate)((0,g.createTemplateFactory)({id:"84lcZtW4",block:'[[[1,"\\n"],[41,[30,0,["imageCaptionPopup","showPopup"]],[[[1,"      "],[11,0],[24,0,"composer-popup education-message ai-caption-popup"],[4,[32,0],[[30,0,["hidePopup"]]],null],[12],[1,"\\n        "],[8,[32,1],null,[["@condition"],[[30,0,["imageCaptionPopup","loading"]]]],[["default"],[[[[1,"\\n          "],[8,[32,2],[[4,[32,3],[[30,0,["resizeTextarea"]]],null],[4,[32,4],[[30,0,["resizeTextarea"]],[30,0,["imageCaptionPopup","newCaption"]]],null],[4,[32,5],["change",[30,0,["updateCaption"]]],null],[4,[32,6],null,null]],[["@value"],[[30,0,["imageCaptionPopup","newCaption"]]]],null],[1,"\\n        "]],[]]]]],[1,"\\n\\n        "],[10,0],[14,0,"actions"],[12],[1,"\\n          "],[8,[32,7],[[24,0,"btn-primary"]],[["@label","@icon","@action"],["discourse_ai.ai_helper.image_caption.save_caption","check",[30,0,["saveCaption"]]]],null],[1,"\\n          "],[8,[32,7],[[24,0,"btn-flat cancel-request"]],[["@label","@action"],["cancel",[30,0,["hidePopup"]]]],null],[1,"\\n\\n          "],[10,1],[14,0,"credits"],[12],[1,"\\n            "],[1,[28,[32,8],["discourse-sparkles"],null]],[1,"\\n            "],[10,1],[12],[1,[28,[32,9],["discourse_ai.ai_helper.image_caption.credits"],null]],[13],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/editor-preview/ai-image-caption-container.js",scope:()=>[a.default,l.default,d.default,o.default,n.default,s.on,c.default,u.default,p.default,m.default],isStrictMode:!0}),this))()}e.default=_})),define("discourse/plugins/discourse-ai/discourse/connectors/fast-edit-footer-after/ai-edit-suggestion-button",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/service","discourse/components/d-button","discourse/lib/ajax","discourse/lib/ajax-error","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,u,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static shouldRender(e,t){return(0,l.showPostAIHelper)(e,t)}static#e=(()=>dt7948.g(this.prototype,"currentUser",[o.inject]))()
#s=(()=>{dt7948.i(this,"currentUser")})()
static#i=(()=>dt7948.g(this.prototype,"loading",[s.tracked],(function(){return!1})))()
#Q=(()=>{dt7948.i(this,"loading")})()
static#n=(()=>dt7948.g(this.prototype,"suggestion",[s.tracked],(function(){return""})))()
#gt=(()=>{dt7948.i(this,"suggestion")})()
static#r=(()=>dt7948.g(this.prototype,"_activeAIRequest",[s.tracked],(function(){return null})))()
#Qe=(()=>{dt7948.i(this,"_activeAIRequest")})()
get disabled(){return this.loading||this.suggestion?.length>0}get mode(){return this.currentUser?.ai_helper_prompts.find((e=>"proofread"===e.name))}suggest(){return this.loading=!0,this._activeAIRequest=(0,a.ajax)("/discourse-ai/ai-helper/suggest",{method:"POST",data:{mode:this.mode.id,text:this.args.outletArgs.initialValue,custom_prompt:""}}),this._activeAIRequest.then((e=>{let{suggestions:t}=e
this.suggestion=t[0].trim(),this.args.outletArgs.updateValue(this.suggestion)})).catch(r.popupAjaxError).finally((()=>{this.loading=!1})),this._activeAIRequest}static#l=(()=>dt7948.n(this.prototype,"suggest",[i.action]))()
static#g=(()=>(0,u.setComponentTemplate)((0,d.createTemplateFactory)({id:"9jHc25oQ",block:'[[[1,"\\n"],[41,[51,[30,1,["newValue"]]],[[[1,"      "],[8,[32,0],[[24,0,"btn-small btn-ai-suggest-edit"]],[["@action","@icon","@label","@isLoading","@disabled"],[[30,0,["suggest"]],"discourse-sparkles","discourse_ai.ai_helper.fast_edit.suggest_button",[30,0,["loading"]],[30,0,["disabled"]]]],null],[1,"\\n"]],[]],null],[1,"  "]],["@outletArgs"],false,["unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/fast-edit-footer-after/ai-edit-suggestion-button.js",scope:()=>[n.default],isStrictMode:!0}),this))()}e.default=c})),define("discourse/plugins/discourse-ai/discourse/connectors/full-page-search-below-search-header/semantic-search",["exports","@glimmer/component","@glimmer/tracking","@ember/modifier","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/service","discourse/components/d-toggle-switch","discourse/controllers/full-page-search","discourse/lib/ajax","discourse/lib/plugin-api","discourse/lib/search","discourse-common/helpers/d-icon","I18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,u,d,c,p,m,h,g){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class _ extends t.default{static shouldRender(e,t){let{siteSettings:s}=t
return s.ai_embeddings_semantic_search_enabled}static#e=(()=>dt7948.g(this.prototype,"appEvents",[a.inject]))()
#we=(()=>{dt7948.i(this,"appEvents")})()
static#i=(()=>dt7948.g(this.prototype,"siteSettings",[a.inject]))()
#o=(()=>{dt7948.i(this,"siteSettings")})()
static#n=(()=>dt7948.g(this.prototype,"searchPreferencesManager",[a.inject]))()
#_t=(()=>{dt7948.i(this,"searchPreferencesManager")})()
static#r=(()=>dt7948.g(this.prototype,"searching",[s.tracked],(function(){return!1})))()
#ft=(()=>{dt7948.i(this,"searching")})()
static#l=(()=>dt7948.g(this.prototype,"AIResults",[s.tracked],(function(){return[]})))()
#bt=(()=>{dt7948.i(this,"AIResults")})()
static#g=(()=>dt7948.g(this.prototype,"showingAIResults",[s.tracked],(function(){return!1})))()
#yt=(()=>{dt7948.i(this,"showingAIResults")})()
initialSearchTerm=(()=>this.args.outletArgs.search)()
get disableToggleSwitch(){if(this.searching||0===this.AIResults.length||0!==this.args.outletArgs.sortOrder)return!0}get searchStateText(){return this.AIResults.length>0?this.showingAIResults?m.default.t("discourse_ai.embeddings.semantic_search_results.toggle",{count:this.AIResults.length}):m.default.t("discourse_ai.embeddings.semantic_search_results.toggle_hidden",{count:this.AIResults.length}):this.searching?m.default.t("discourse_ai.embeddings.semantic_search_loading"):0===this.AIResults.length&&this.searchTerm!==this.initialSearchTerm?m.default.t("discourse_ai.embeddings.semantic_search_results.new"):0===this.AIResults.length?m.default.t("discourse_ai.embeddings.semantic_search_results.none"):void 0}get searchTerm(){return this.initialSearchTerm!==this.args.outletArgs.search&&(this.initialSearchTerm=void 0),this.args.outletArgs.search}get searchEnabled(){return this.args.outletArgs.type===l.SEARCH_TYPE_DEFAULT&&(0,c.isValidSearchTerm)(this.searchTerm,this.siteSettings)&&0===this.args.outletArgs.sortOrder}toggleAIResults(){this.showingAIResults?this.args.outletArgs.addSearchResults([],"topic_id"):this.args.outletArgs.addSearchResults(this.AIResults,"topic_id"),this.showingAIResults=!this.showingAIResults}static#f=(()=>dt7948.n(this.prototype,"toggleAIResults",[o.action]))()
resetAIResults(){this.AIResults=[],this.showingAIResults=!1,this.args.outletArgs.addSearchResults([],"topic_id")}static#y=(()=>dt7948.n(this.prototype,"resetAIResults",[o.action]))()
handleSearch(){if(this.searchEnabled)return this.initialSearchTerm&&!this.searching?this.performHyDESearch():void(0,d.withPluginApi)("1.15.0",(e=>{e.onAppEvent("full-page-search:trigger-search",(()=>{if(!this.searching)return this.resetAIResults(),this.performHyDESearch()}))}))}static#w=(()=>dt7948.n(this.prototype,"handleSearch",[o.action]))()
performHyDESearch(){this.searching=!0,this.resetAIResults(),(0,u.ajax)("/discourse-ai/embeddings/semantic-search",{data:{q:this.searchTerm}}).then((async e=>{const t=await(0,c.translateResults)(e)||{}
0!==t.posts?.length?(t.posts.forEach((e=>{e.generatedByAI=!0})),this.AIResults=t.posts):this.searching=!1})).finally((()=>this.searching=!1))}static#x=(()=>(0,h.setComponentTemplate)((0,g.createTemplateFactory)({id:"3cSLRgPA",block:'[[[1,"\\n"],[41,[30,0,["searchEnabled"]],[[[1,"      "],[10,0],[14,0,"semantic-search__container search-results"],[14,"role","region"],[12],[1,"\\n        "],[11,0],[24,0,"semantic-search__results"],[4,[32,0],[[30,0,["handleSearch"]]],null],[12],[1,"\\n          "],[10,0],[15,0,[29,["semantic-search__searching\\n              ",[52,[30,0,["searching"]],"in-progress"]]]],[12],[1,"\\n            "],[8,[32,1],[[16,"disabled",[30,0,["disableToggleSwitch"]]],[24,"title","AI search results hidden"],[24,0,"semantic-search__results-toggle"],[4,[32,2],["click",[30,0,["toggleAIResults"]]],null]],[["@state"],[[30,0,["showingAIResults"]]]],null],[1,"\\n\\n            "],[10,0],[14,0,"semantic-search__searching-text"],[12],[1,"\\n              "],[1,[28,[32,3],["discourse-sparkles"],null]],[1,"\\n              "],[1,[30,0,["searchStateText"]]],[1,"\\n            "],[13],[1,"\\n\\n"],[41,[30,0,["searching"]],[[[1,"              "],[10,1],[14,0,"semantic-search__indicator-wave"],[12],[1,"\\n                "],[10,1],[14,0,"semantic-search__indicator-dot"],[12],[1,"."],[13],[1,"\\n                "],[10,1],[14,0,"semantic-search__indicator-dot"],[12],[1,"."],[13],[1,"\\n                "],[10,1],[14,0,"semantic-search__indicator-dot"],[12],[1,"."],[13],[1,"\\n              "],[13],[1,"\\n"]],[]],null],[1,"          "],[13],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/full-page-search-below-search-header/semantic-search.js",scope:()=>[n.default,r.default,i.on,p.default],isStrictMode:!0}),this))()}e.default=_})),define("discourse/plugins/discourse-ai/discourse/connectors/post-text-buttons/ai-helper-options-menu",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/will-destroy","@ember/service","discourse/components/cook-text","discourse/components/d-button","discourse/components/fast-edit","discourse/components/modal/fast-edit","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/text","discourse/lib/utilities","discourse-common/utils/decorators","discourse-i18n","truth-helpers/helpers/eq","discourse/plugins/discourse-ai/discourse/components/ai-helper-custom-prompt","discourse/plugins/discourse-ai/discourse/components/ai-helper-loading","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,u,d,c,p,m,h,g,_,f,b,y,v,w,x,S){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class k extends t.default{static shouldRender(e,t){return(0,w.showPostAIHelper)(e,t)}static#e=(()=>dt7948.g(this.prototype,"messageBus",[r.inject]))()
#Te=(()=>{dt7948.i(this,"messageBus")})()
static#i=(()=>dt7948.g(this.prototype,"site",[r.inject]))()
#X=(()=>{dt7948.i(this,"site")})()
static#n=(()=>dt7948.g(this.prototype,"modal",[r.inject]))()
#ue=(()=>{dt7948.i(this,"modal")})()
static#r=(()=>dt7948.g(this.prototype,"siteSettings",[r.inject]))()
#o=(()=>{dt7948.i(this,"siteSettings")})()
static#l=(()=>dt7948.g(this.prototype,"currentUser",[r.inject]))()
#s=(()=>{dt7948.i(this,"currentUser")})()
static#g=(()=>dt7948.g(this.prototype,"menu",[r.inject]))()
#Y=(()=>{dt7948.i(this,"menu")})()
static#f=(()=>dt7948.g(this.prototype,"menuState",[s.tracked],(function(){return this.MENU_STATES.triggers})))()
#vt=(()=>{dt7948.i(this,"menuState")})()
static#y=(()=>dt7948.g(this.prototype,"loading",[s.tracked],(function(){return!1})))()
#Q=(()=>{dt7948.i(this,"loading")})()
static#w=(()=>dt7948.g(this.prototype,"suggestion",[s.tracked],(function(){return""})))()
#gt=(()=>{dt7948.i(this,"suggestion")})()
static#x=(()=>dt7948.g(this.prototype,"showMainButtons",[s.tracked],(function(){return!0})))()
#wt=(()=>{dt7948.i(this,"showMainButtons")})()
static#S=(()=>dt7948.g(this.prototype,"customPromptValue",[s.tracked],(function(){return""})))()
#De=(()=>{dt7948.i(this,"customPromptValue")})()
static#k=(()=>dt7948.g(this.prototype,"copyButtonIcon",[s.tracked],(function(){return"copy"})))()
#xt=(()=>{dt7948.i(this,"copyButtonIcon")})()
static#T=(()=>dt7948.g(this.prototype,"copyButtonLabel",[s.tracked],(function(){return"discourse_ai.ai_helper.post_options_menu.copy"})))()
#St=(()=>{dt7948.i(this,"copyButtonLabel")})()
static#P=(()=>dt7948.g(this.prototype,"showFastEdit",[s.tracked],(function(){return!1})))()
#kt=(()=>{dt7948.i(this,"showFastEdit")})()
static#M=(()=>dt7948.g(this.prototype,"showAiButtons",[s.tracked],(function(){return!0})))()
#Tt=(()=>{dt7948.i(this,"showAiButtons")})()
static#j=(()=>dt7948.g(this.prototype,"originalPostHTML",[s.tracked],(function(){return null})))()
#Pt=(()=>{dt7948.i(this,"originalPostHTML")})()
static#L=(()=>dt7948.g(this.prototype,"postHighlighted",[s.tracked],(function(){return!1})))()
#Mt=(()=>{dt7948.i(this,"postHighlighted")})()
static#F=(()=>dt7948.g(this.prototype,"streaming",[s.tracked],(function(){return!1})))()
#jt=(()=>{dt7948.i(this,"streaming")})()
static#B=(()=>dt7948.g(this.prototype,"lastSelectedOption",[s.tracked],(function(){return null})))()
#Ct=(()=>{dt7948.i(this,"lastSelectedOption")})()
static#V=(()=>dt7948.g(this.prototype,"isSavingFootnote",[s.tracked],(function(){return!1})))()
#Et=(()=>{dt7948.i(this,"isSavingFootnote")})()
MENU_STATES={triggers:"TRIGGERS",options:"OPTIONS",loading:"LOADING",result:"RESULT"}
static#D=(()=>dt7948.g(this.prototype,"_activeAIRequest",[s.tracked],(function(){return null})))()
#Qe=(()=>{dt7948.i(this,"_activeAIRequest")})()
highlightSelectedText(){const e=this.args.outletArgs.data.quoteState.postId,t=document.querySelector(`article[data-post-id='${e}'] .cooked`)
if(!t)return
this.originalPostHTML=t.innerHTML,this.selectedText=this.args.outletArgs.data.quoteState.buffer
const s=window.getSelection()
if(!s.rangeCount)return
const i=s.getRangeAt(0)
if(i.startContainer.nodeType===Node.TEXT_NODE&&i.startOffset>0){const e=i.startContainer.splitText(i.startOffset)
i.setStart(e,0)}i.endContainer.nodeType===Node.TEXT_NODE&&i.endOffset<i.endContainer.length&&i.endContainer.splitText(i.endOffset)
const o=document.createTreeWalker(i.commonAncestorContainer,NodeFilter.SHOW_TEXT,{acceptNode:e=>i.intersectsNode(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}),n=[]
if(o.currentNode?.nodeType===Node.TEXT_NODE)n.push(o.currentNode)
else for(;o.nextNode();)n.push(o.currentNode)
for(let a of n){const e=document.createElement("span")
e.classList.add("ai-helper-highlighted-selection")
const t=a.cloneNode(!0)
e.appendChild(t),a.parentNode.replaceChild(e,a)}s.removeAllRanges(),this.postHighlighted=!0}removeHighlightedText(){if(!this.postHighlighted)return
const e=this.args.outletArgs.data.quoteState.postId,t=document.querySelector(`article[data-post-id='${e}'] .cooked`)
t&&(t.innerHTML=this.originalPostHTML,this.postHighlighted=!1)}willDestroy(){super.willDestroy(...arguments),this.removeHighlightedText()}async showAIHelperOptions(){this.highlightSelectedText(),this.showMainButtons=!1,this.menuState=this.MENU_STATES.options}static#G=(()=>dt7948.n(this.prototype,"showAIHelperOptions",[o.action]))()
subscribe(){const e=`/discourse-ai/ai-helper/explain/${this.args.outletArgs.data.quoteState.postId}`
this.messageBus.subscribe(e,this._updateResult)}static#H=(()=>dt7948.n(this.prototype,"subscribe",[_.bind]))()
unsubscribe(){this.messageBus.unsubscribe("/discourse-ai/ai-helper/explain/*",this._updateResult)}static#$=(()=>dt7948.n(this.prototype,"unsubscribe",[_.bind]))()
_updateResult(e){this.streaming=!e.done,this.suggestion=e.result}static#z=(()=>dt7948.n(this.prototype,"_updateResult",[_.bind]))()
get highlightedTextToggleIcon(){return this.showHighlightedText?"angle-double-left":"angle-double-right"}toggleHighlightedTextPreview(){this.showHighlightedText=!this.showHighlightedText}static#K=(()=>dt7948.n(this.prototype,"toggleHighlightedTextPreview",[o.action]))()
async performAISuggestion(e){if(this.menuState=this.MENU_STATES.loading,this.lastSelectedOption=e,"explain"===e.name){this.menuState=this.MENU_STATES.result
const t=this.menu.getByIdentifier("post-text-selection-toolbar")
t&&(t.options.placement="bottom")
const s="/discourse-ai/ai-helper/explain"
this._activeAIRequest=(0,p.ajax)(s,{method:"POST",data:{mode:e.value,text:this.args.outletArgs.data.quoteState.buffer,post_id:this.args.outletArgs.data.quoteState.postId}})}else this._activeAIRequest=(0,p.ajax)("/discourse-ai/ai-helper/suggest",{method:"POST",data:{mode:e.id,text:this.args.outletArgs.data.quoteState.buffer,custom_prompt:this.customPromptValue}})
return"explain"!==e.name&&this._activeAIRequest.then((t=>{let{suggestions:s}=t
if(this.suggestion=s[0].trim(),"proofread"===e.name)return this.showAiButtons=!1,this.site.desktopView?void(this.showFastEdit=!0):this.modal.show(c.default,{model:{initialValue:this.args.outletArgs.data.quoteState.buffer,newValue:this.suggestion,post:this.args.outletArgs.post,close:this.closeFastEdit}})})).catch(m.popupAjaxError).finally((()=>{this.loading=!1,this.menuState=this.MENU_STATES.result})),this._activeAIRequest}static#Je=(()=>dt7948.n(this.prototype,"performAISuggestion",[o.action]))()
cancelAIAction(){this._activeAIRequest&&(this._activeAIRequest.abort(),this._activeAIRequest=null,this.loading=!1,this.menuState=this.MENU_STATES.options)}static#Ze=(()=>dt7948.n(this.prototype,"cancelAIAction",[o.action]))()
copySuggestion(){this.suggestion?.length>0&&((0,g.clipboardCopy)(this.suggestion),this.copyButtonIcon="check",this.copyButtonLabel="discourse_ai.ai_helper.post_options_menu.copied",setTimeout((()=>{this.copyButtonIcon="copy",this.copyButtonLabel="discourse_ai.ai_helper.post_options_menu.copy"}),3500))}static#et=(()=>dt7948.n(this.prototype,"copySuggestion",[o.action]))()
get helperOptions(){let e=this.currentUser?.ai_helper_prompts
e=e.filter((e=>e.location.includes("post")))
const t=e.findIndex((e=>"custom_prompt"===e.name))
if(-1!==t){const s=e.splice(t,1)[0]
e.unshift(s)}return this._showUserCustomPrompts()||(e=e.filter((e=>"custom_prompt"!==e.name))),this.args.outletArgs.data.canEditPost||(e=e.filter((e=>"proofread"!==e.name))),e}_showUserCustomPrompts(){return this.currentUser?.can_use_custom_prompts}async closeFastEdit(){this.showFastEdit=!1,await this.args.outletArgs.data.hideToolbar()}static#tt=(()=>dt7948.n(this.prototype,"closeFastEdit",[o.action]))()
sanitizeForFootnote(e){return e=(e=(e=e.replace(/[\r\n]+/g," ")).replace(/^(#+)\s+/gm,"")).trim(),(0,h.sanitize)(e)}async insertFootnote(){if(this.isSavingFootnote=!0,this.allowInsertFootnote)try{const e=await(0,p.ajax)(`/posts/${this.args.outletArgs.post.id}`),t=this.sanitizeForFootnote(this.suggestion),s=f.default.t("discourse_ai.ai_helper.post_options_menu.footnote_credits"),i=`${this.selectedText} ^[${t} (${s})]`,o=e.raw.replace(this.selectedText,i)
await this.args.outletArgs.post.save({raw:o})}catch(e){(0,m.popupAjaxError)(e)}finally{this.isSavingFootnote=!1,this.menu.close()}}static#st=(()=>dt7948.n(this.prototype,"insertFootnote",[o.action]))()
get allowInsertFootnote(){const e=this.siteSettings,t=this.args.outletArgs.data.canEditPost
return!!(e?.enable_markdown_footnotes&&e?.display_footnotes_inline&&t)&&"explain"===this.lastSelectedOption?.name}static#it=(()=>(0,x.setComponentTemplate)((0,S.createTemplateFactory)({id:"kG8Uplse",block:'[[[1,"\\n"],[41,[30,0,["showMainButtons"]],[[[1,"      "],[18,3,null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["showAiButtons"]],[[[1,"      "],[10,0],[14,0,"ai-post-helper"],[12],[1,"\\n"],[41,[28,[32,0],[[30,0,["menuState"]],[30,0,["MENU_STATES","triggers"]]],null],[[[1,"          "],[8,[32,1],[[24,0,"btn-flat ai-post-helper__trigger"]],[["@icon","@title","@label","@action"],["discourse-sparkles","discourse_ai.ai_helper.post_options_menu.title","discourse_ai.ai_helper.post_options_menu.trigger",[30,0,["showAIHelperOptions"]]]],null],[1,"\\n\\n"]],[]],[[[41,[28,[32,0],[[30,0,["menuState"]],[30,0,["MENU_STATES","options"]]],null],[[[1,"          "],[10,0],[14,0,"ai-post-helper__options"],[12],[1,"\\n"],[42,[28,[31,3],[[28,[31,3],[[30,0,["helperOptions"]]],null]],null],null,[[[41,[28,[32,0],[[30,1,["name"]],"custom_prompt"],null],[[[1,"                "],[8,[32,2],null,[["@value","@promptArgs","@submit"],[[30,0,["customPromptValue"]],[30,1],[30,0,["performAISuggestion"]]]],null],[1,"\\n"]],[]],[[[1,"                "],[8,[32,1],[[16,"data-name",[30,1,["name"]]],[16,"data-value",[30,1,["id"]]],[24,0,"btn-flat ai-post-helper__options-button"]],[["@icon","@translatedLabel","@action"],[[30,1,["icon"]],[30,1,["translated_name"]],[28,[32,3],[[30,0,["performAISuggestion"]],[30,1]],null]]],null],[1,"\\n"]],[]]]],[1]],null],[1,"          "],[13],[1,"\\n\\n"]],[]],[[[41,[28,[32,0],[[30,0,["menuState"]],[30,0,["MENU_STATES","loading"]]],null],[[[1,"          "],[8,[32,4],null,[["@cancel"],[[30,0,["cancelAIAction"]]]],null],[1,"\\n"]],[]],[[[41,[28,[32,0],[[30,0,["menuState"]],[30,0,["MENU_STATES","result"]]],null],[[[1,"          "],[11,0],[24,0,"ai-post-helper__suggestion"],[4,[32,5],[[30,0,["subscribe"]]],null],[4,[32,6],[[30,0,["unsubscribe"]]],null],[12],[1,"\\n"],[41,[30,0,["suggestion"]],[[[1,"              "],[10,0],[14,0,"ai-post-helper__suggestion__text"],[14,"dir","auto"],[12],[1,"\\n                "],[8,[32,7],null,[["@rawText"],[[30,0,["suggestion"]]]],null],[1,"\\n              "],[13],[1,"\\n              "],[10,0],[14,0,"ai-post-helper__suggestion__buttons"],[12],[1,"\\n                "],[8,[32,1],[[24,0,"btn-flat ai-post-helper__suggestion__cancel"]],[["@icon","@label","@action"],["times","discourse_ai.ai_helper.post_options_menu.cancel",[30,0,["cancelAIAction"]]]],null],[1,"\\n                "],[8,[32,1],[[24,0,"btn-flat ai-post-helper__suggestion__copy"]],[["@icon","@label","@action","@disabled"],[[30,0,["copyButtonIcon"]],[30,0,["copyButtonLabel"]],[30,0,["copySuggestion"]],[30,0,["streaming"]]]],null],[1,"\\n"],[41,[30,0,["allowInsertFootnote"]],[[[1,"                  "],[8,[32,1],[[24,0,"btn-flat ai-post-helper__suggestion__insert-footnote"]],[["@icon","@label","@action","@isLoading","@disabled"],["asterisk","discourse_ai.ai_helper.post_options_menu.insert_footnote",[30,0,["insertFootnote"]],[30,0,["isSavingFootnote"]],[30,0,["streaming"]]]],null],[1,"\\n"]],[]],null],[1,"              "],[13],[1,"\\n"]],[]],[[[1,"              "],[8,[32,4],null,[["@cancel"],[[30,0,["cancelAIAction"]]]],null],[1,"\\n"]],[]]],[1,"          "],[13],[1,"\\n        "]],[]],null]],[]]]],[]]]],[]]],[1,"      "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["showFastEdit"]],[[[1,"      "],[10,0],[14,0,"ai-post-helper__fast-edit"],[12],[1,"\\n        "],[8,[32,8],null,[["@initialValue","@newValue","@post","@close"],[[30,2,["data","quoteState","buffer"]],[30,0,["suggestion"]],[30,2,["post"]],[30,0,["closeFastEdit"]]]],null],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],["option","@outletArgs","&default"],false,["if","yield","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/post-text-buttons/ai-helper-options-menu.js",scope:()=>[b.default,u.default,y.default,i.fn,v.default,n.default,a.default,l.default,d.default],isStrictMode:!0}),this))()}e.default=k})),define("discourse/plugins/discourse-ai/discourse/connectors/search-menu-before-advanced-search/ai-quick-search-loader",["exports","@glimmer/component","@ember/service","discourse/helpers/loading-spinner","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static#e=(()=>dt7948.g(this.prototype,"quickSearch",[s.inject]))()
#At=(()=>{dt7948.i(this,"quickSearch")})()
static#i=(()=>(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"apo2cAJf",block:'[[[1,"\\n"],[41,[30,0,["quickSearch","loading"]],[[[1,"      "],[10,0],[14,0,"ai-quick-search-spinner"],[12],[1,"\\n        "],[1,[32,0]],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/search-menu-before-advanced-search/ai-quick-search-loader.js",scope:()=>[i.default],isStrictMode:!0}),this))()}e.default=a})),define("discourse/plugins/discourse-ai/discourse/connectors/search-menu-initial-options/ai-quick-semantic-search",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/search-menu/results/assistant-item","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/search","discourse-common/helpers/i18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,u,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static shouldRender(e,t){let{siteSettings:s}=t
return s.ai_embeddings_semantic_quick_search_enabled}static#e=(()=>dt7948.g(this.prototype,"search",[i.inject]))()
#It=(()=>{dt7948.i(this,"search")})()
static#i=(()=>dt7948.g(this.prototype,"quickSearch",[i.inject]))()
#At=(()=>{dt7948.i(this,"quickSearch")})()
static#n=(()=>dt7948.g(this.prototype,"siteSettings",[i.inject]))()
#o=(()=>{dt7948.i(this,"siteSettings")})()
async searchTermChanged(){if(this.search.activeGlobalSearchTerm){if(!(0,r.isValidSearchTerm)(this.search.activeGlobalSearchTerm,this.siteSettings))return this.search.noResults=!0,this.search.results={},this.quickSearch.loading=!1,void(this.quickSearch.invalidTerm=!0)
await this.performSearch()}else this.search.noResults=!1,this.search.results={},this.quickSearch.loading=!1,this.quickSearch.invalidTerm=!1}static#r=(()=>dt7948.n(this.prototype,"searchTermChanged",[s.action]))()
async performSearch(){this.quickSearch.loading=!0,this.quickSearch.invalidTerm=!1
try{const e=await(0,n.ajax)("/discourse-ai/embeddings/quick-search",{data:{q:this.search.activeGlobalSearchTerm}}),t=await(0,r.translateResults)(e)
t&&(this.search.noResults=0===e.resultTypes.length,this.search.results=t)}catch(e){(0,a.popupAjaxError)(e)}finally{this.quickSearch.loading=!1}}static#l=(()=>(0,u.setComponentTemplate)((0,d.createTemplateFactory)({id:"xqHDbd5x",block:'[[[1,"\\n    "],[18,3,null],[1,"\\n\\n"],[41,[30,0,["search","activeGlobalSearchTerm"]],[[[1,"      "],[8,[32,0],null,[["@suffix","@icon","@closeSearchMenu","@searchTermChanged","@suggestionKeyword"],[[28,[32,1],["discourse_ai.embeddings.quick_search.suffix"],null],"discourse-sparkles",[30,1],[30,0,["searchTermChanged"]],[30,2]]],null],[1,"\\n"]],[]],null],[1,"  "]],["@closeSearchMenu","@suggestionKeyword","&default"],false,["yield","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/search-menu-initial-options/ai-quick-semantic-search.js",scope:()=>[o.default,l.default],isStrictMode:!0}),this))()}e.default=c})),define("discourse/plugins/discourse-ai/discourse/connectors/search-menu-results-top/ai-quick-search-info",["exports","@glimmer/component","@ember/service","discourse/lib/search","discourse-common/helpers/i18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static#e=(()=>dt7948.g(this.prototype,"search",[s.inject]))()
#It=(()=>{dt7948.i(this,"search")})()
static#i=(()=>dt7948.g(this.prototype,"siteSettings",[s.inject]))()
#o=(()=>{dt7948.i(this,"siteSettings")})()
static#n=(()=>dt7948.g(this.prototype,"quickSearch",[s.inject]))()
#At=(()=>{dt7948.i(this,"quickSearch")})()
get termTooShort(){return!(0,i.isValidSearchTerm)(this.search.activeGlobalSearchTerm,this.siteSettings)&&this.quickSearch.invalidTerm&&this.search.activeGlobalSearchTerm?.length>0}static#r=(()=>(0,n.setComponentTemplate)((0,a.createTemplateFactory)({id:"k6uzZwr4",block:'[[[1,"\\n"],[41,[30,0,["termTooShort"]],[[[1,"      "],[10,0],[14,0,"no-results"],[12],[1,[28,[32,0],["search.too_short"],null]],[13],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/search-menu-results-top/ai-quick-search-info.js",scope:()=>[o.default],isStrictMode:!0}),this))()}e.default=r})),define("discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-category-after/ai-category-suggestion",["exports","@glimmer/component","@ember/service","discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static shouldRender(e,t){return(0,o.showPostAIHelper)(e,t)}static#e=(()=>dt7948.g(this.prototype,"siteSettings",[s.inject]))()
#o=(()=>{dt7948.i(this,"siteSettings")})()
static#i=(()=>(0,n.setComponentTemplate)((0,a.createTemplateFactory)({id:"4O7HJkah",block:'[[[1,"\\n"],[41,[30,0,["siteSettings","ai_embeddings_enabled"]],[[[1,"      "],[8,[32,0],null,[["@selectedPosts","@mode","@updateAction"],[[30,1,["selectedPosts"]],"suggest_category",[30,1,["updateCategoryId"]]]],null],[1,"\\n"]],[]],null],[1,"  "]],["@outletArgs"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-category-after/ai-category-suggestion.js",scope:()=>[i.default],isStrictMode:!0}),this))()}e.default=r})),define("discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-tag-after/ai-tag-suggestion",["exports","@glimmer/component","@ember/service","discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static shouldRender(e,t){return(0,o.showPostAIHelper)(e,t)}static#e=(()=>dt7948.g(this.prototype,"siteSettings",[s.inject]))()
#o=(()=>{dt7948.i(this,"siteSettings")})()
static#i=(()=>(0,n.setComponentTemplate)((0,a.createTemplateFactory)({id:"jo6+zYZR",block:'[[[1,"\\n"],[41,[30,0,["siteSettings","ai_embeddings_enabled"]],[[[1,"      "],[8,[32,0],null,[["@selectedPosts","@mode","@updateAction","@currentValue"],[[30,1,["selectedPosts"]],"suggest_tags",[30,1,["updateTags"]],[30,1,["tags"]]]],null],[1,"\\n"]],[]],null],[1,"  "]],["@outletArgs"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-tag-after/ai-tag-suggestion.js",scope:()=>[i.default],isStrictMode:!0}),this))()}e.default=r})),define("discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-title-after/ai-title-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,t){return(0,i.showPostAIHelper)(e,t)}static#e=(()=>(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"obhR2Q8M",block:'[[[1,"\\n    "],[8,[32,0],null,[["@selectedPosts","@mode","@updateAction"],[[30,1,["selectedPosts"]],"suggest_title",[30,1,["updateTopicName"]]]],null],[1,"\\n  "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-title-after/ai-title-suggestion.js",scope:()=>[s.default],isStrictMode:!0}),this))()}e.default=a})),define("discourse/plugins/discourse-ai/discourse/connectors/topic-more-content/related-topics",["exports","@glimmer/component","@ember/object","@ember/service","I18n"],(function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends t.default{static shouldRender(e){return(e.model.related_topics?.length||0)>0}static#e=(()=>dt7948.g(this.prototype,"store",[i.inject]))()
#E=(()=>{dt7948.i(this,"store")})()
static#i=(()=>dt7948.g(this.prototype,"site",[i.inject]))()
#X=(()=>{dt7948.i(this,"site")})()
static#n=(()=>dt7948.g(this.prototype,"moreTopicsPreferenceTracking",[i.inject]))()
#Ot=(()=>{dt7948.i(this,"moreTopicsPreferenceTracking")})()
listId="related-topics"
get hidden(){return this.moreTopicsPreferenceTracking.selectedTab!==this.listId}static#r=(()=>dt7948.n(this.prototype,"hidden",[(0,s.computed)("moreTopicsPreferenceTracking.selectedTab")]))()
get relatedTopics(){return this.args.outletArgs.model.related_topics.map((e=>this.store.createRecord("topic",e)))}registerList(){this.moreTopicsPreferenceTracking.registerTopicList({name:o.default.t("discourse_ai.related_topics.pill"),id:this.listId,icon:"discourse-sparkles"})}static#l=(()=>dt7948.n(this.prototype,"registerList",[s.action]))()
removeList(){this.moreTopicsPreferenceTracking.removeTopicList(this.listId)}static#g=(()=>dt7948.n(this.prototype,"removeList",[s.action]))()}e.default=n})),define("discourse/plugins/discourse-ai/discourse/connectors/user-preferences-nav/ai-preferences",["exports","@glimmer/component","@ember/routing","discourse-common/helpers/d-icon","discourse-common/helpers/i18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static shouldRender(e,t){return t.siteSettings.discourse_ai_enabled&&(s=e.model,s?.user_allowed_ai_auto_image_captions)
var s}static#e=(()=>(0,n.setComponentTemplate)((0,a.createTemplateFactory)({id:"/y5E1bgJ",block:'[[[1,"\\n    "],[10,"li"],[14,0,"user-nav__preferences-ai"],[12],[1,"\\n      "],[8,[32,0],null,[["@route"],["preferences.ai"]],[["default"],[[[[1,"\\n        "],[1,[28,[32,1],["discourse-sparkles"],null]],[1,"\\n        "],[10,1],[12],[1,[28,[32,2],["discourse_ai.title"],null]],[13],[1,"\\n      "]],[]]]]],[1,"\\n    "],[13],[1,"\\n  "]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/user-preferences-nav/ai-preferences.js",scope:()=>[s.LinkTo,i.default,o.default],isStrictMode:!0}),this))()}e.default=r})),define("discourse/plugins/discourse-ai/discourse/controllers/admin-dashboard-sentiment",["exports","@ember/object","admin/controllers/admin-dashboard-tab"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{get filters(){return{startDate:this.startDate,endDate:this.endDate}}static#e=(()=>dt7948.n(this.prototype,"filters",[(0,t.computed)("startDate","endDate")]))()}e.default=i})),define("discourse/plugins/discourse-ai/discourse/controllers/preferences-ai",["exports","@glimmer/tracking","@ember/controller","@ember/object","@ember/service","discourse/lib/ajax-error","discourse-common/config/environment"],(function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const r=["auto_image_caption"]
class l extends s.default{static#e=(()=>dt7948.g(this.prototype,"siteSettings",[o.service]))()
#o=(()=>{dt7948.i(this,"siteSettings")})()
static#i=(()=>dt7948.g(this.prototype,"saved",[t.tracked],(function(){return!1})))()
#Rt=(()=>{dt7948.i(this,"saved")})()
save(){return this.saved=!1,this.model.save(r).then((()=>{this.saved=!0,(0,a.isTesting)()||location.reload()})).catch(n.popupAjaxError)}static#n=(()=>dt7948.n(this.prototype,"save",[i.action]))()}e.default=l}))
define("discourse/plugins/discourse-ai/discourse/discourse-ai-shared-conversation-show-route-map",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){this.route("discourse-ai-shared-conversation-show",{path:"/discourse-ai/ai-bot/shared-ai-conversations/:share_key"})}})),define("discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper",["exports","discourse/lib/ajax","discourse/lib/ajax-error","discourse/models/composer","I18n","discourse/plugins/discourse-ai/discourse/components/modal/share-full-topic-modal"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.composeAiBotMessage=function(e,t){let s=t.currentUser.ai_enabled_chat_bots.find((t=>t.model_name===e)).username
t.focusComposer({fallbackToNewTopic:!0,openOpts:{action:i.default.PRIVATE_MESSAGE,recipients:s,topicTitle:o.default.t("discourse_ai.ai_bot.default_pm_prefix"),archetypeId:"private_message",draftKey:"private_message_ai",hasGroups:!1,warningsDisabled:!0,skipDraftCheck:!0}})},e.showShareConversationModal=function(e,i){(0,t.ajax)(`/discourse-ai/ai-bot/shared-ai-conversations/preview/${i}.json`).then((t=>{e.show(n.default,{model:t})})).catch(s.popupAjaxError)}})),define("discourse/plugins/discourse-ai/discourse/lib/ai-streamer",["exports","@ember/runloop","discourse/lib/load-morphlex","discourse/lib/text"],(function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.MIN_LETTERS_PER_INTERVAL=void 0,e.addProgressDot=d,e.applyProgress=m,e.default=function(e,t){if(t.noop)return;(e.aiStreamingStatus=e.aiStreamingStatus||{})[t.post_id]=t,h(e)}
const o=40,n=6e4,a=e.MIN_LETTERS_PER_INTERVAL=6,r=800
let l=null
function u(e){let t=e.lastChild
for(;t&&t.nodeType===Node.TEXT_NODE&&!/\S/.test(t.textContent);)t=t.previousSibling
return t}function d(e){let t=e
for(;;){let e=u(t)
if(!e)break
if(e.nodeType!==Node.ELEMENT_NODE)break
t=e}const s=document.createElement("span")
s.classList.add("progress-dot"),t.appendChild(s)}class c{set streaming(e){throw"not implemented"}async setCooked(){throw"not implemented"}async setRaw(){throw"not implemented"}get element(){throw"not implemented"}get raw(){throw"not implemented"}}class p extends c{constructor(e,t){super(),this.postStream=e,this.postId=t,this.post=e.findLoadedPost(t),this.post&&(this.postElement=document.querySelector(`#post_${this.post.post_number}`))}get element(){return this.postElement}set streaming(e){this.postElement&&(e?this.postElement.classList.add("streaming"):this.postElement.classList.remove("streaming"))}async setRaw(e,t){this.post.set("raw",e)
const s=await(0,i.cook)(e)
this.element.classList.remove("streaming"),this.element.offsetWidth,this.element.classList.add("streaming")
const o=document.createElement("div")
o.innerHTML=s,t||d(o),await this.setCooked(o.innerHTML)}async setCooked(e){this.post.set("cooked",e)
const t=this.postElement.querySelector(".cooked"),i=t.cloneNode(!1)
i.innerHTML=e,(await(0,s.default)()).morph(t,i)}get raw(){return this.post.get("raw")||""}}async function m(e,t){if(e.startTime=e.startTime||Date.now(),Date.now()-e.startTime>n)return t.streaming=!1,!0
if(!t.element)return!1
const s=t.raw
if(e.raw===s&&!e.done){if(t.element.querySelector(".progress-dot"))return!1}if(void 0!==e.raw){let i=e.raw
if(!e.done)if(0===s.length&&-1!==i.indexOf("</details>"))i=e.raw
else{const t=i.length-s.length
let n=Math.floor(t/(r/o))
n<a&&(n=a),i=e.raw.substring(0,s.length+n)}await t.setRaw(i,e.done)}return e.done&&(e.cooked&&await t.setCooked(e.cooked),t.streaming=!1),e.done}function h(e){l||(l=(0,t.later)((async()=>{const t=await async function(e){const t=e.aiStreamingStatus
let s=!1
const i=Object.keys(t).map((async i=>{let o=t[i]
const n=new p(e,o.post_id)
await m(o,n)?delete t[i]:s=!0}))
return await Promise.all(i),s}(e)
l=null,t&&h(e)}),o))}})),define("discourse/plugins/discourse-ai/discourse/lib/copy-conversation",["exports","discourse/lib/ajax","discourse/lib/utilities","discourse-i18n"],(function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=async function(e,o,n){await(0,s.clipboardCopyAsync)((async()=>{const s=await async function(e,s,o){const n=e.get("postStream")
let a=[]
for(let t=s;t<=o;t++)a.push(t)
const r=a.map((e=>n.findPostIdForPostNumber(e))),l=`/t/${e.id}/posts.json`,u={post_ids:r,include_raw:!0},d=await(0,t.ajax)(l,{data:u})
let c=[]
c.push("<details class='ai-quote'>"),c.push("<summary>"),c.push(`<span>${e.title}</span>`),c.push(`<span title='${i.default.t("discourse_ai.ai_bot.ai_title")}'>${i.default.t("discourse_ai.ai_bot.ai_label")}</span>`),c.push("</summary>"),d.post_stream.posts.forEach((e=>{c.push(""),c.push(`**${e.username}:**`),c.push(""),c.push(e.raw)})),c.push("</details>")
const p=c.join("\n")
return p}(e,o,n)
return new Blob([s],{type:"text/plain"})}))}})),define("discourse/plugins/discourse-ai/discourse/lib/show-ai-helper",["exports"],(function(e){"use strict"
function t(e){return e.discourse_ai_enabled&&e.composer_ai_helper_enabled}Object.defineProperty(e,"__esModule",{value:!0}),e.showComposerAIHelper=function(e,s,i){const o=t(s.siteSettings),n=s.currentUser.can_use_assistant,a=s.siteSettings.ai_helper_allowed_in_pm,r=s.siteSettings.ai_helper_enabled_features.includes(i)
if(e?.composer?.privateMessage)return o&&n&&a&&r
return o&&n&&r},e.showPostAIHelper=function(e,s){return t(s.siteSettings)&&s.currentUser?.can_use_assistant_in_post}})),define("discourse/plugins/discourse-ai/discourse/lib/utilities",["exports","@ember/template","discourse/lib/utilities"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.IMAGE_MARKDOWN_REGEX=void 0,e.jsonToHtml=function e(i){if("object"!=typeof i)return(0,s.escapeExpression)(i)
let o="<ul>"
for(let[t,n]of Object.entries(i))o+="<li>",t=(0,s.escapeExpression)(t),"object"==typeof n&&Array.isArray(n)?o+=`<strong>${t}:</strong> ${e(n)}`:"object"==typeof n?o+=`<strong>${t}:</strong> <ul><li>${e(n)}</li></ul>`:("string"==typeof n&&(n=(0,s.escapeExpression)(n).replace(/\n/g,"<br>")),o+=`<strong>${t}:</strong> ${n}`),o+="</li>"
return o+="</ul>",(0,t.htmlSafe)(o)}
e.IMAGE_MARKDOWN_REGEX=/!\[(.*?)\|(\d{1,4}x\d{1,4})(,\s*\d{1,3}%)?(.*?)\]\((upload:\/\/.*?)\)(?!(.*`))/g})),define("discourse/plugins/discourse-ai/discourse/preferences-ai-route-map",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={resource:"user.preferences",map(){this.route("ai")}}})),define("discourse/plugins/discourse-ai/discourse/routes/discourse-ai-shared-conversation-show",["exports","@ember/service","discourse/routes/discourse"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{static#e=(()=>dt7948.g(this.prototype,"currentUser",[t.service]))()
#s=(()=>{dt7948.i(this,"currentUser")})()
beforeModel(e){this.currentUser?.user_option?.external_links_in_new_tab?window.open(e.intent.url,"_blank"):this.redirect(e.intent.url),e.abort()}redirect(e){window.location=e}}e.default=i})),define("discourse/plugins/discourse-ai/discourse/routes/preferences-ai",["exports","@ember/service","discourse/lib/utilities","discourse/routes/restricted-user"],(function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends i.default{static#e=(()=>dt7948.g(this.prototype,"siteSettings",[t.service]))()
#o=(()=>{dt7948.i(this,"siteSettings")})()
setupController(e,t){if(!this.siteSettings.discourse_ai_enabled)return this.router.transitionTo(`discovery.${(0,s.defaultHomepage)()}`)
e.set("model",t)}}e.default=o})),define("discourse/plugins/discourse-ai/discourse/services/image-caption-popup",["exports","@glimmer/tracking","@ember/service","discourse/plugins/discourse-ai/discourse/lib/utilities"],(function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends s.default{static#e=(()=>dt7948.g(this.prototype,"composer",[s.inject]))()
#a=(()=>{dt7948.i(this,"composer")})()
static#i=(()=>dt7948.g(this.prototype,"appEvents",[s.inject]))()
#we=(()=>{dt7948.i(this,"appEvents")})()
static#n=(()=>dt7948.g(this.prototype,"showPopup",[t.tracked],(function(){return!1})))()
#Nt=(()=>{dt7948.i(this,"showPopup")})()
static#r=(()=>dt7948.g(this.prototype,"imageIndex",[t.tracked],(function(){return null})))()
#Ut=(()=>{dt7948.i(this,"imageIndex")})()
static#l=(()=>dt7948.g(this.prototype,"imageSrc",[t.tracked],(function(){return null})))()
#qt=(()=>{dt7948.i(this,"imageSrc")})()
static#g=(()=>dt7948.g(this.prototype,"newCaption",[t.tracked],(function(){return null})))()
#Lt=(()=>{dt7948.i(this,"newCaption")})()
static#f=(()=>dt7948.g(this.prototype,"loading",[t.tracked],(function(){return!1})))()
#Q=(()=>{dt7948.i(this,"loading")})()
static#y=(()=>dt7948.g(this.prototype,"popupTrigger",[t.tracked],(function(){return null})))()
#Ft=(()=>{dt7948.i(this,"popupTrigger")})()
static#w=(()=>dt7948.g(this.prototype,"showAutoCaptionLoader",[t.tracked],(function(){return!1})))()
#Bt=(()=>{dt7948.i(this,"showAutoCaptionLoader")})()
static#x=(()=>dt7948.g(this.prototype,"_request",[t.tracked],(function(){return null})))()
#Vt=(()=>{dt7948.i(this,"_request")})()
updateCaption(){const e=this.composer.model.reply.match(i.IMAGE_MARKDOWN_REGEX)
if(e){const t=e[this.imageIndex],s=t.replace(i.IMAGE_MARKDOWN_REGEX,`![${this.newCaption}|$2$3$4]($5)`)
t&&this.appEvents.trigger("composer:replace-text",t,s)}}toggleLoadingState(e){return e?(this.popupTrigger?.classList.add("disabled"),this.loading=!0):(this.popupTrigger?.classList.remove("disabled"),this.loading=!1)}}e.default=o})),define("discourse/plugins/discourse-ai/discourse/services/quick-search",["exports","@glimmer/tracking","@ember/service"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{static#e=(()=>dt7948.g(this.prototype,"loading",[t.tracked],(function(){return!1})))()
#Q=(()=>{dt7948.i(this,"loading")})()
static#i=(()=>dt7948.g(this.prototype,"invalidTerm",[t.tracked],(function(){return!1})))()
#Dt=(()=>{dt7948.i(this,"invalidTerm")})()}e.default=i})),define("discourse/plugins/discourse-ai/discourse/templates/admin-dashboard-sentiment",["exports","@ember/template-factory"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"nGq01/Xy",block:'[[[10,0],[14,0,"sentiment section"],[12],[1,"\\n  "],[10,0],[14,0,"period-section"],[12],[1,"\\n    "],[10,0],[14,0,"section-title"],[12],[1,"\\n      "],[10,"h2"],[12],[1,"\\n        "],[1,[28,[35,0],["discourse_ai.sentiments.dashboard.title"],null]],[1,"\\n      "],[13],[1,"\\n\\n      "],[8,[39,1],null,[["@period","@setPeriod","@startDate","@endDate","@setCustomDateRange"],[[30,0,["period"]],[30,0,["setPeriod"]],[30,0,["startDate"]],[30,0,["endDate"]],[30,0,["setCustomDateRange"]]]],null],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n\\n  "],[10,0],[14,0,"section-body"],[12],[1,"\\n    "],[10,0],[14,0,"charts"],[12],[1,"\\n      "],[8,[39,2],null,[["@dataSourceName","@filters","@showHeader"],["overall_sentiment",[30,0,["filters"]],true]],null],[1,"\\n\\n      "],[8,[39,2],null,[["@dataSourceName","@filters","@showHeader"],["post_emotion",[30,0,["filters"]],true]],null],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n"],[13]],[],false,["i18n","dashboard-period-selector","admin-report"]]',moduleName:"discourse/plugins/discourse-ai/discourse/templates/admin-dashboard-sentiment.hbs",isStrictMode:!1})})),define("discourse/plugins/discourse-ai/discourse/templates/connectors/after-d-editor/ai-helper-context-menu",["exports","@ember/template-factory"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"9lPQdG4P",block:'[[[11,0],[4,[38,0],[[30,0,["setupContextMenu"]]],null],[12],[1,"\\n"],[41,[30,0,["showContextMenu"]],[[[1,"    "],[10,0],[14,0,"ai-helper-context-menu"],[12],[1,"\\n"],[41,[28,[37,2],[[30,0,["menuState"]],[30,0,["CONTEXT_MENU_STATES","triggers"]]],null],[[[1,"        "],[10,"ul"],[14,0,"ai-helper-context-menu__trigger"],[12],[1,"\\n          "],[10,"li"],[12],[1,"\\n            "],[8,[39,3],[[24,0,"btn-flat"]],[["@icon","@action","@label"],["discourse-sparkles",[30,0,["toggleAiHelperOptions"]],"discourse_ai.ai_helper.context_menu.trigger"]],null],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n\\n"]],[]],[[[41,[28,[37,2],[[30,0,["menuState"]],[30,0,["CONTEXT_MENU_STATES","options"]]],null],[[[1,"        "],[10,"ul"],[14,0,"ai-helper-context-menu__options"],[12],[1,"\\n"],[42,[28,[37,5],[[28,[37,5],[[30,0,["helperOptions"]]],null]],null],null,[[[41,[28,[37,2],[[30,1,["name"]],"custom_prompt"],null],[[[1,"              "],[8,[39,6],null,[["@value","@promptArgs","@submit"],[[30,0,["customPromptValue"]],[30,1],[30,0,["updateSelected"]]]],null],[1,"\\n"]],[]],[[[1,"              "],[10,"li"],[15,"data-name",[30,1,["translated_name"]]],[15,"data-value",[30,1,["id"]]],[12],[1,"\\n                "],[8,[39,3],[[24,0,"btn-flat"]],[["@icon","@translatedLabel","@action"],[[30,1,["icon"]],[30,1,["translated_name"]],[28,[37,7],[[30,0,["updateSelected"]],[30,1]],null]]],null],[1,"\\n              "],[13],[1,"\\n"]],[]]]],[1]],null],[1,"        "],[13],[1,"\\n\\n"]],[]],[[[41,[28,[37,2],[[30,0,["menuState"]],[30,0,["CONTEXT_MENU_STATES","loading"]]],null],[[[1,"        "],[8,[39,8],null,[["@cancel"],[[30,0,["cancelAIAction"]]]],null],[1,"\\n\\n"]],[]],[[[41,[28,[37,2],[[30,0,["menuState"]],[30,0,["CONTEXT_MENU_STATES","review"]]],null],[[[1,"        "],[10,"ul"],[14,0,"ai-helper-context-menu__review"],[12],[1,"\\n          "],[10,"li"],[12],[1,"\\n            "],[8,[39,3],[[24,0,"btn-flat view-changes"]],[["@icon","@label","@action"],["exchange-alt","discourse_ai.ai_helper.context_menu.view_changes",[30,0,["viewChanges"]]]],null],[1,"\\n          "],[13],[1,"\\n          "],[10,"li"],[12],[1,"\\n            "],[8,[39,3],[[24,0,"btn-flat revert"]],[["@icon","@label","@action"],["undo","discourse_ai.ai_helper.context_menu.revert",[30,0,["undoAIAction"]]]],null],[1,"\\n          "],[13],[1,"\\n          "],[10,"li"],[12],[1,"\\n            "],[8,[39,3],[[24,0,"btn-flat confirm"]],[["@icon","@label","@action"],["check","discourse_ai.ai_helper.context_menu.confirm",[30,0,["confirmChanges"]]]],null],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n\\n"]],[]],[[[41,[28,[37,2],[[30,0,["menuState"]],[30,0,["CONTEXT_MENU_STATES","resets"]]],null],[[[1,"        "],[10,"ul"],[14,0,"ai-helper-context-menu__resets"],[12],[1,"\\n          "],[10,"li"],[12],[1,"\\n            "],[8,[39,3],[[24,0,"btn-flat undo"]],[["@icon","@label","@action"],["undo","discourse_ai.ai_helper.context_menu.undo",[30,0,["undoAIAction"]]]],null],[1,"\\n          "],[13],[1,"\\n          "],[10,"li"],[12],[1,"\\n            "],[8,[39,3],[[24,0,"btn-flat"]],[["@icon","@label","@action"],["discourse-sparkles","discourse_ai.ai_helper.context_menu.regen",[28,[37,7],[[30,0,["updateSelected"]],[30,0,["lastUsedOption"]]],null]]],null],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n      "]],[]],null]],[]]]],[]]]],[]]]],[]]],[1,"    "],[13],[1,"\\n"]],[]],null],[13],[1,"\\n\\n"],[41,[30,0,["showDiffModal"]],[[[1,"  "],[8,[39,9],null,[["@confirm","@diff","@oldValue","@newValue","@revert","@closeModal"],[[30,0,["confirmChanges"]],[30,0,["diff"]],[30,0,["initialValue"]],[30,0,["newSelectedText"]],[30,0,["undoAIAction"]],[28,[37,7],[[28,[37,10],[[30,0,["showDiffModal"]]],null],false],null]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["showThumbnailModal"]],[[[1,"  "],[8,[39,11],null,[["@thumbnails","@closeModal"],[[30,0,["thumbnailSuggestions"]],[28,[37,7],[[28,[37,10],[[30,0,["showThumbnailModal"]]],null],false],null]]],null],[1,"\\n"]],[]],null]],["option"],false,["did-insert","if","eq","d-button","each","-track-array","ai-helper-custom-prompt","fn","ai-helper-loading","modal/diff-modal","mut","modal/thumbnail-suggestions"]]',moduleName:"discourse/plugins/discourse-ai/discourse/templates/connectors/after-d-editor/ai-helper-context-menu.hbs",isStrictMode:!1})})),define("discourse/plugins/discourse-ai/discourse/templates/connectors/after-d-editor/composer-open",["exports","@ember/template-factory"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"+kLlck0i",block:'[[[41,[30,0,["isAiBotChat"]],[[[1,"  "],[8,[39,1],null,[["@bodyClass"],[[30,0,["aiBotClasses"]]]],null],[1,"\\n"],[41,[30,0,["renderChatWarning"]],[[[1,"    "],[10,0],[14,0,"ai-bot-chat-warning"],[12],[1,[28,[35,2],["discourse_ai.ai_bot.pm_warning"],null]],[13],[1,"\\n"]],[]],null]],[]],null]],[],false,["if","d-section","i18n"]]',moduleName:"discourse/plugins/discourse-ai/discourse/templates/connectors/after-d-editor/composer-open.hbs",isStrictMode:!1})})),define("discourse/plugins/discourse-ai/discourse/templates/connectors/topic-more-content/related-topics",["exports","@ember/template-factory"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"6Oz8VQA3",block:'[[[11,0],[24,1,"related-topics"],[16,0,[29,["more-topics__list ",[52,[30,0,["hidden"]],"hidden"]]]],[24,"role","complementary"],[24,"aria-labelledby","related-topics-title"],[4,[38,1],[[30,0,["registerList"]]],null],[4,[38,2],[[30,0,["removeList"]]],null],[12],[1,"\\n  "],[10,"h3"],[14,1,"related-topics-title"],[14,0,"more-topics__list-title"],[12],[1,"\\n    "],[1,[28,[35,3],["discourse_ai.related_topics.title"],null]],[1,"\\n  "],[13],[1,"\\n  "],[10,0],[14,0,"topics"],[12],[1,"\\n    "],[8,[39,4],null,[["@topics"],[[30,0,["relatedTopics"]]]],null],[1,"\\n  "],[13],[1,"\\n"],[13]],[],false,["if","did-insert","will-destroy","i18n","basic-topic-list"]]',moduleName:"discourse/plugins/discourse-ai/discourse/templates/connectors/topic-more-content/related-topics.hbs",isStrictMode:!1})})),define("discourse/plugins/discourse-ai/discourse/templates/preferences/ai",["exports","@ember/template-factory"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"wSbgol0u",block:'[[[10,"label"],[14,0,"control-label"],[12],[1,[28,[35,0],["discourse_ai.title"],null]],[13],[1,"\\n\\n"],[10,0],[14,0,"control-group ai-setting"],[12],[1,"\\n  "],[8,[39,1],[[24,"data-setting-name","auto-image-caption"],[24,0,"pref-auto-image-caption"]],[["@labelKey","@checked"],["discourse_ai.ai_helper.image_caption.automatic_caption_setting",[30,0,["model","user_option","auto_image_caption"]]]],null],[1,"\\n"],[13],[1,"\\n\\n"],[8,[39,2],null,[["@id","@model","@action","@saved"],["user_ai_preference_save",[30,0,["model"]],[30,0,["save"]],[30,0,["saved"]]]],null]],[],false,["i18n","preference-checkbox","save-controls"]]',moduleName:"discourse/plugins/discourse-ai/discourse/templates/preferences/ai.hbs",isStrictMode:!1})})),define("discourse/plugins/discourse-ai/initializers/admin-plugin-configuration-nav",["exports","discourse/lib/admin-plugin-config-nav","discourse/lib/plugin-api"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={name:"discourse-ai-admin-plugin-configuration-nav",initialize(e){const i=e.lookup("service:current-user")
i&&i.admin&&(0,s.withPluginApi)("1.1.0",(e=>{e.addAdminPluginConfigurationNav("discourse-ai",t.PLUGIN_NAV_MODE_TOP,[{label:"discourse_ai.llms.short_title",route:"adminPlugins.show.discourse-ai-llms"},{label:"discourse_ai.ai_persona.short_title",route:"adminPlugins.show.discourse-ai-personas"},{label:"discourse_ai.tools.short_title",route:"adminPlugins.show.discourse-ai-tools"}])}))}}})),define("discourse/plugins/discourse-ai/initializers/ai-bot-replies",["exports","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/plugin-api","discourse/widgets/render-glimmer","discourse/plugins/discourse-ai/discourse/components/modal/debug-ai-modal","discourse/plugins/discourse-ai/discourse/components/modal/share-modal","discourse/plugins/discourse-ai/discourse/lib/ai-streamer","discourse/plugins/discourse-ai/discourse/lib/copy-conversation","discourse/plugins/discourse-ai/discourse/components/ai-bot-header-icon","discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,u,d,c){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
let p=[],m=!1
function h(e){return e&&p.includes(e.id)}function g(e){e.headerIcons.add("ai",u.default)}function _(e){e.addPostMenuButton("cancel-gpt",(e=>{if(h(e.user))return{icon:"pause",action:"cancelStreaming",title:"discourse_ai.ai_bot.cancel_streaming",className:"btn btn-default cancel-streaming",position:"first"}})),e.attachWidgetAction("post","cancelStreaming",(function(){(0,t.ajax)(`/discourse-ai/ai-bot/post/${this.model.id}/stop-streaming`,{type:"POST"}).then((()=>{document.querySelector(`#post_${this.model.post_number}`).classList.remove("streaming")})).catch(s.popupAjaxError)})),e.modifyClass("controller:topic",{pluginId:"discourse-ai",onAIBotStreamedReply:function(e){(0,r.default)(this.model.postStream,e)},subscribe:function(){this._super(),this.model.isPrivateMessage&&this.model.details.allowed_users&&this.model.details.allowed_users.filter(h).length>=1&&this.messageBus.subscribe(`discourse-ai/ai-bot/topic/${this.model.id}`,this.onAIBotStreamedReply.bind(this),-2)},unsubscribe:function(){this.messageBus.unsubscribe("discourse-ai/ai-bot/topic/*"),this._super()}})}function f(e){let t=null
e.decorateWidget("poster-name:after",(s=>{if(h(s.attrs.user))return t=t||e.container.lookup("controller:topic"),s.widget.attach("persona-flair",{topicController:t})})),(0,o.registerWidgetShim)("persona-flair","span.persona-flair",(0,c.createTemplateFactory)({id:"9jYzNJdM",block:'[[[1,[30,1,["topicController","model","ai_persona_name"]]]],["@data"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/initializers/ai-bot-replies.js",isStrictMode:!1}))}e.default={name:"discourse-ai-bot-replies",initialize(e){const t=e.lookup("service:current-user")
t?.ai_enabled_chat_bots&&(p=t.ai_enabled_chat_bots.map((e=>e.id)),m=t.can_debug_ai_bot_conversations,(0,i.withPluginApi)("1.6.0",g),(0,i.withPluginApi)("1.6.0",_),(0,i.withPluginApi)("1.6.0",f),(0,i.withPluginApi)("1.22.0",(e=>function(e){const t=e.getCurrentUser()
if(!t||!t.ai_enabled_chat_bots||!m)return
let s=async function(t){let{post:s}=t
e.container.lookup("service:modal").show(n.default,{model:s})}
e.addPostMenuButton("debugAi",(e=>{if("private_message"===e.topic?.archetype&&(t.ai_enabled_chat_bots.any((t=>e.username===t.username))||!(e.user_id>-1200)))return{action:s,icon:"info",className:"post-action-menu__debug-ai",title:"discourse_ai.ai_bot.debug_ai",position:"first"}}))}(e))),(0,i.withPluginApi)("1.22.0",(e=>function(e){const t=e.getCurrentUser()
if(!t||!t.ai_enabled_chat_bots)return
let s=async function(t){let{post:s,showFeedback:i}=t
s.post_number<=4?(await(0,l.default)(s.topic,1,s.post_number),i("discourse_ai.ai_bot.conversation_shared")):e.container.lookup("service:modal").show(a.default,{model:s})}
e.addPostMenuButton("share",(e=>{if("private_message"===e.topic?.archetype&&(t.ai_enabled_chat_bots.any((t=>e.username===t.username))||!(e.user_id>-1200)))return{action:s,icon:"share",className:"post-action-menu__share",title:"discourse_ai.ai_bot.share",position:"first"}}))}(e))),(0,i.withPluginApi)("1.22.0",(e=>function(e){const t=e.container.lookup("service:modal"),s=e.container.lookup("current-user:main")
e.registerTopicFooterButton({id:"share-ai-conversation",icon:"share-alt",label:"discourse_ai.ai_bot.share_ai_conversation.name",title:"discourse_ai.ai_bot.share_ai_conversation.title",action(){(0,d.showShareConversationModal)(t,this.topic.id)},classNames:["share-ai-conversation-button"],dependentKeys:["topic.ai_persona_name"],displayed(){return s?.can_share_ai_bot_conversations&&this.topic.ai_persona_name}})}(e))))}}})),define("discourse/plugins/discourse-ai/initializers/ai-image-caption",["exports","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/api","discourse/lib/uploads","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/utilities"],(function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,i.apiInitializer)("1.25.0",(e=>{const i={label:n.default.t("discourse_ai.ai_helper.image_caption.button_label"),icon:"discourse-sparkles",class:"generate-caption"},r=e.container.lookup("service:site-settings"),l=e.getCurrentUser()
if(!r.ai_helper_enabled_features.includes("image_caption")||!l?.can_use_assistant)return
function u(e){return e.length<20||1===e.split(" ").length}async function d(e,i){try{return(await(0,t.ajax)("/discourse-ai/ai-helper/caption_image",{method:"POST",data:{image_url:e,image_url_type:i}})).caption}catch(o){(0,s.popupAjaxError)(o)}}e.addSaveableUserOptionField("auto_image_caption"),e.addComposerImageWrapperButton(i.label,i.class,i.icon,(i=>{const o=e.container.lookup("service:imageCaptionPopup")
if(o.popupTrigger=i.target,o.popupTrigger.classList.contains("generate-caption")){const n=i.target.closest(".button-wrapper"),a=parseInt(n.getAttribute("data-image-index"),10),r=i.target.closest(".image-wrapper").querySelector("img").getAttribute("src")
o.toggleLoadingState(!0)
const l=e.container.lookup("site:main")
l.mobileView||(o.showPopup=!o.showPopup),o._request=(0,t.ajax)("/discourse-ai/ai-helper/caption_image",{method:"POST",data:{image_url:r,image_url_type:"long_url"}}),o._request.then((e=>{let{caption:t}=e
o.imageSrc=r,o.imageIndex=a,o.newCaption=t,l.mobileView&&o.updateCaption()})).catch(s.popupAjaxError).finally((()=>{o.toggleLoadingState(!1)}))}}))
const c=r?.ai_auto_image_caption_allowed_groups.split("|").map((e=>parseInt(e,10)))
l.groups.map((e=>e.id)).some((e=>c.includes(e)))&&(e.addComposerUploadMarkdownResolver((async e=>{if(!l.get("user_option.auto_image_caption")||!(0,o.isImage)(e.url)||!u(e.original_filename)||(t=e.width,s=e.height,t*s/1e6<=.4))return(0,o.getUploadMarkdown)(e)
var t,s
return`![${await d(e.url,"long_url")}|${e.thumbnail_width}x${e.thumbnail_height}](${e.short_url})`})),e.composerBeforeSave((()=>new Promise(((t,s)=>{const i=e.container.lookup("service:dialog"),o=e.container.lookup("service:composer"),r="discourse_ai.ai_helper.image_caption.automatic_caption_dialog",c=l.get("user_option.auto_image_caption"),p=o.model.reply.match(a.IMAGE_MARKDOWN_REGEX)
p?.length>0||t()
const m=p.filter((e=>u(e.substring(e.indexOf("[")+1,e.indexOf("]")).split("|")[0]))),h=m?.length>0,g=e.container.lookup("service:key-value-store"),_=e.container.lookup("service:imageCaptionPopup"),f="ai-auto-caption-seen",b=g.getItem(f)
if(c||!h||b)return t()
g.setItem(f,!0),i.confirm({message:n.default.t(`${r}.prompt`),confirmButtonLabel:`${r}.confirm`,cancelButtonLabel:`${r}.cancel`,class:"ai-image-caption-prompt-dialog",didConfirm:async()=>{try{l.set("user_option.auto_image_caption",!0),await l.save(["auto_image_caption"]),m.forEach((async e=>{const s=function(e){const t=e.match(/\(upload:\/\/([^)]+)\)/)
return t?`upload://${t[1]}`:null}(e)
_.showAutoCaptionLoader=!0
const i=await d(s,"short_url"),n=new RegExp(`(!\\[)[^|]+(\\|[^\\]]+\\]\\(${s}\\))`),a=o.model.reply.replace(n,`$1${i}$2`)
o.model.set("reply",a),_.showAutoCaptionLoader=!1,t()}))}catch(e){s(e)}},didCancel:()=>{t()}})})))))}))})),define("discourse/plugins/discourse-ai/initializers/ai-semantic-search",["exports","discourse/lib/api"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.apiInitializer)("1.15.0",(e=>{e.modifyClass("component:search-result-entry",{pluginId:"discourse-ai",classNameBindings:["bulkSelectEnabled","post.generatedByAI:ai-result"]})}))})),define("discourse/plugins/discourse-ai/initializers/related-topics",["exports","discourse/lib/plugin-api"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={name:"discourse-ai-related-topics",initialize(e){const s=e.lookup("service:site-settings")
s.ai_embeddings_enabled&&s.ai_embeddings_semantic_related_topics_enabled&&(0,t.withPluginApi)("1.1.0",(e=>{e.modifyClass("model:post-stream",{pluginId:"discourse-ai",_setSuggestedTopics(e){this._super(...arguments),e.related_topics&&this.topic.setProperties({related_topics:e.related_topics})}})}))}}})),define("discourse/plugins/discourse-ai/lib/discourse-markdown/ai-tags",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.setup=function(e){e.allowList(["details[class=ai-quote]"])}}))

//# sourceMappingURL=discourse-ai-79a2cd96b78593dd66eca5bef629d31ee8c41e8fb1317a0af7e8ca323dc0aafc.map
//!

;
